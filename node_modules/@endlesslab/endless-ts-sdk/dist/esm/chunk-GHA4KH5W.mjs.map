{"version":3,"sources":["../../src/api/utils.ts"],"sourcesContent":["import { sha3_256 } from \"@noble/hashes/sha3\";\nimport { waitForIndexer } from \"../internal/transaction\";\nimport { ProcessorType } from \"../utils\";\nimport { EndlessConfig } from \"./endlessConfig\";\nimport { AnyNumber, UserTransactionResponse } from \"../types\";\nimport { Serializer } from \"../bcs\";\nimport { AccountAddress } from \"../core\";\n\n/**\n * Utility function to handle optional waiting on indexer for APIs\n *\n * This is purposely placed here to not expose this internal function.\n * @param args\n */\nexport async function waitForIndexerOnVersion(args: {\n  config: EndlessConfig;\n  minimumLedgerVersion?: AnyNumber;\n  processorType: ProcessorType;\n}) {\n  if (args.minimumLedgerVersion !== undefined) {\n    await waitForIndexer({\n      endlessConfig: args.config,\n      minimumLedgerVersion: args.minimumLedgerVersion,\n      processorType: args.processorType,\n    });\n  }\n}\n\nexport function getPaymentChecksum(simulateResult: UserTransactionResponse): Uint8Array {\n  const { sender, events } = simulateResult;\n  const withdrawEvents = events.filter(evt => (\n    evt.type === \"0x1::fungible_asset::Withdraw\"\n    && evt.data.owner === sender\n  )).map(evt => {\n    const { amount, store } = evt.data;\n    const serializer = new Serializer(32 + 16);\n    AccountAddress.from(store).serialize(serializer);\n    serializer.serializeU128(BigInt(amount));\n    return serializer.toUint8Array();\n  });\n  const serializer = new Serializer();\n  serializer.serializeU32AsUleb128(withdrawEvents.length);\n  withdrawEvents.forEach(withdrawEvent => serializer.serializeFixedBytes(withdrawEvent));\n  return sha3_256(serializer.toUint8Array());\n}\n"],"mappings":"2HAAA,OAAS,YAAAA,MAAgB,qBAczB,eAAsBC,EAAwBC,EAI3C,CACGA,EAAK,uBAAyB,QAChC,MAAMC,EAAe,CACnB,cAAeD,EAAK,OACpB,qBAAsBA,EAAK,qBAC3B,cAAeA,EAAK,aACtB,CAAC,CAEL,CAEO,SAASE,EAAmBC,EAAqD,CACtF,GAAM,CAAE,OAAAC,EAAQ,OAAAC,CAAO,EAAIF,EACrBG,EAAiBD,EAAO,OAAOE,GACnCA,EAAI,OAAS,iCACVA,EAAI,KAAK,QAAUH,CACvB,EAAE,IAAIG,GAAO,CACZ,GAAM,CAAE,OAAAC,EAAQ,MAAAC,CAAM,EAAIF,EAAI,KACxBG,EAAa,IAAIC,EAAW,EAAO,EACzC,OAAAC,EAAe,KAAKH,CAAK,EAAE,UAAUC,CAAU,EAC/CA,EAAW,cAAc,OAAOF,CAAM,CAAC,EAChCE,EAAW,aAAa,CACjC,CAAC,EACKA,EAAa,IAAIC,EACvB,OAAAD,EAAW,sBAAsBJ,EAAe,MAAM,EACtDA,EAAe,QAAQO,GAAiBH,EAAW,oBAAoBG,CAAa,CAAC,EAC9EC,EAASJ,EAAW,aAAa,CAAC,CAC3C","names":["sha3_256","waitForIndexerOnVersion","args","waitForIndexer","getPaymentChecksum","simulateResult","sender","events","withdrawEvents","evt","amount","store","serializer","Serializer","AccountAddress","withdrawEvent","sha3_256"]}