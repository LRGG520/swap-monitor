import{spawn as a}from"child_process";import{platform as c}from"os";var i=class{async init(e){let{network:t,profile:s}=e,r=["endless","init",`--network=${t??"local"}`,`--profile=${s??"default"}`];return this.runCommand(r)}async compile(e){let{packageDirectoryPath:t,namedAddresses:s}=e,r=["endless","move","compile","--package-dir",t,"--skip-fetch-latest-git-deps"],o=this.parseNamedAddresses(s);return r.push(...this.prepareNamedAddresses(o)),this.runCommand(r)}async test(e){let{packageDirectoryPath:t,namedAddresses:s}=e,r=["endless","move","test","--package-dir",t,"--skip-fetch-latest-git-deps"],o=this.parseNamedAddresses(s);return r.push(...this.prepareNamedAddresses(o)),this.runCommand(r)}async publish(e){let{packageDirectoryPath:t,namedAddresses:s,profile:r}=e,o=["endless","move","publish","--package-dir",t,"--skip-fetch-latest-git-deps",`--profile=${r??"default"}`],d=this.parseNamedAddresses(s);return o.push(...this.prepareNamedAddresses(d)),this.runCommand(o)}async runCommand(e){return new Promise((t,s)=>{let r=c(),o;r==="win32"?o=a("npx",e,{shell:!0}):o=a("npx",e),o.stdout.pipe(process.stdout),o.stderr.pipe(process.stderr),process.stdin.pipe(o.stdin),o.on("close",d=>{d===0?t(!0):s(new Error(`Child process exited with code ${d}`))})})}prepareNamedAddresses(e){let t=e.size,s=[];if(t===0)return s;s.push("--named-addresses");let r=0;return e.forEach((o,d)=>{r+=1;let n=`${d}=${o.toString()}`;r<t-1&&(n+=","),s.push(n)}),s}parseNamedAddresses(e){let t=new Map;return Object.keys(e).forEach(s=>{let r=e[s];t.set(s,r)}),t}};export{i as a};
//# sourceMappingURL=chunk-36T74C63.mjs.map