import{a as S,c as on,d as sn,e as W}from"./chunk-BGSINN43.mjs";import{q as an,t as g}from"./chunk-NDFXPSUK.mjs";import{a as en}from"./chunk-DSILH5UU.mjs";import{b as rn}from"./chunk-AADPBGL3.mjs";import{a as tn}from"./chunk-YPRVBJBD.mjs";import{a as d}from"./chunk-EACOSGMU.mjs";import{a as Y}from"./chunk-IQD4DV4A.mjs";import{b as U,d as T,e as P,f as I}from"./chunk-CFMGG54C.mjs";import{a as O,b as h,d as m,h as f}from"./chunk-T2NK4HOP.mjs";import{a as nn}from"./chunk-2Y6GETDV.mjs";import{a as Q,c as $,d as N}from"./chunk-CR74RISD.mjs";import{c as L,d as X,e as z,f as M,g as Z,h as j,i as J}from"./chunk-REP4Z3MG.mjs";import{a as H}from"./chunk-YAZ76FZM.mjs";import{a as R,b as w}from"./chunk-4NCTUR2D.mjs";import{a as v,c as K}from"./chunk-OLRL3QZY.mjs";import{i as V,j as q}from"./chunk-BVS7ECHS.mjs";import{a as B,c as F}from"./chunk-LQF2EBCE.mjs";import{a as k}from"./chunk-ZMWKA46Z.mjs";import{a as C}from"./chunk-RSKPHKJG.mjs";import{b as u}from"./chunk-R7AH4Q5E.mjs";import{b as x}from"./chunk-H24X6T4W.mjs";import{g as D}from"./chunk-V2ND42XG.mjs";import{b as G,c as _}from"./chunk-LWKCWJBC.mjs";import{sha3_256 as mn}from"@noble/hashes/sha3";async function vn(n){if(an(n))return ln(n);let{moduleAddress:t,moduleName:r,functionName:i}=g(n.function),e=await un({key:"entry-function",moduleAddress:t,moduleName:r,functionName:i,endlessConfig:n.endlessConfig,abi:n.abi,fetch:on});return fn({...n,abi:e})}function fn(n){let t=n.abi,{moduleAddress:r,moduleName:i,functionName:e}=g(n.function),a=S(n.typeArguments);if(a.length!==t.typeParameters.length)throw new Error(`Type argument count mismatch, expected ${t.typeParameters.length}, received ${a.length}`);let o=n.functionArguments.map((s,A)=>W(n.function,t,s,A,a));if(o.length!==t.parameters.length)throw new Error(`Too few arguments for '${r}::${i}::${e}', expected ${t.parameters.length} but got ${o.length}`);let c=M.build(`${r}::${i}`,e,a,o);if("multisigAddress"in n){let s=u.from(n.multisigAddress);return new z(new j(s,new J(c)))}return new X(c)}async function Kn(n){let{moduleAddress:t,moduleName:r,functionName:i}=g(n.function),e=await un({key:"view-function",moduleAddress:t,moduleName:r,functionName:i,endlessConfig:n.endlessConfig,abi:n.abi,fetch:sn});return gn({abi:e,...n})}function gn(n){let t=n.abi,{moduleAddress:r,moduleName:i,functionName:e}=g(n.function),a=S(n.typeArguments);if(a.length!==t.typeParameters.length)throw new Error(`Type argument count mismatch, expected ${t.typeParameters.length}, received ${a.length}`);let o=n?.functionArguments?.map((c,s)=>W(n.function,t,c,s,a))??[];if(o.length!==t.parameters.length)throw new Error(`Too few arguments for '${r}::${i}::${e}', expected ${t.parameters.length} but got ${o.length}`);return M.build(`${r}::${i}`,e,a,o)}function ln(n){return new L(new Z(x.fromHexInput(n.bytecode).toUint8Array(),S(n.typeArguments),n.functionArguments))}async function pn(n){let{endlessConfig:t,sender:r,payload:i,options:e,feePayerAddress:a}=n,o=async()=>D[t.network]?{chainId:D[t.network]}:{chainId:(await tn({endlessConfig:t})).chain_id},c=async()=>e?.gasUnitPrice?{gasEstimate:e.gasUnitPrice}:{gasEstimate:(await rn({endlessConfig:t})).gas_estimate},s=async()=>{let l=async()=>{if(e?.accountSequenceNumber!==void 0)return e.accountSequenceNumber;try{return(await en({endlessConfig:t,accountAddress:r})).sequence_number}catch(p){if("status"in p&&p.status===404)return 0;throw p}};if(a&&u.from(a).equals(u.ZERO))try{return await l()}catch{return 0}else return l()},[{chainId:A},{gasEstimate:y},E]=await Promise.all([o(),c(),s()]),{maxGasAmount:dn,gasUnitPrice:An,expireTimestamp:yn}={maxGasAmount:e?.maxGasAmount?BigInt(e.maxGasAmount):BigInt(2e5),gasUnitPrice:e?.gasUnitPrice??BigInt(y),expireTimestamp:e?.expireTimestamp??BigInt(Math.floor(Date.now()/1e3)+20)};return new Q(u.from(r),BigInt(E),i,BigInt(dn),BigInt(An),BigInt(yn),new H(A))}async function On(n){let{endlessConfig:t,sender:r,payload:i,options:e,feePayerAddress:a}=n,o=await pn({endlessConfig:t,sender:r,payload:i,options:e,feePayerAddress:a});if("secondarySignerAddresses"in n){let c=n.secondarySignerAddresses?.map(s=>u.from(s))??[];return new nn(o,c,n.feePayerAddress?u.from(n.feePayerAddress):void 0)}return new Y(o,n.feePayerAddress?u.from(n.feePayerAddress):void 0)}function Hn(n){let{signerPublicKey:t,transaction:r,secondarySignersPublicKeys:i,feePayerPublicKey:e}=n,a=b(t);if(r.feePayerAddress){let c=new N(r.rawTransaction,r.secondarySignerAddresses??[],r.feePayerAddress),s=[];i&&(s=i.map(E=>b(E)));let A=b(e),y=new P(a,r.secondarySignerAddresses??[],s,{address:r.feePayerAddress,authenticator:A});return new d(c.raw_txn,y).bcsToBytes()}if(r.secondarySignerAddresses){let c=new $(r.rawTransaction,r.secondarySignerAddresses),s=[];s=i.map(y=>b(y));let A=new T(a,r.secondarySignerAddresses,s);return new d(c.raw_txn,A).bcsToBytes()}let o;if(a instanceof h)o=new U(a.public_key,a.signature);else if(a instanceof m)o=new I(a);else throw new Error("Invalid public key");return new d(r.rawTransaction,o).bcsToBytes()}function Ln(n){let t=new f(n.rawTransaction.sender);if(n.feePayerAddress){let i=new N(n.rawTransaction,n.secondarySignerAddresses??[],n.feePayerAddress),e=[];n.secondarySignerAddresses&&(e=n.secondarySignerAddresses.map(c=>new f(c)));let a=new f(n.feePayerAddress),o=new P(t,n.secondarySignerAddresses??[],e,{address:n.feePayerAddress,authenticator:a});return new d(i.raw_txn,o).bcsToBytes()}if(n.secondarySignerAddresses){let i=new $(n.rawTransaction,n.secondarySignerAddresses),e=[];e=n.secondarySignerAddresses.map(o=>new f(o));let a=new T(t,n.secondarySignerAddresses,e);return new d(i.raw_txn,a).bcsToBytes()}let r=new I(t);return new d(n.rawTransaction,r).bcsToBytes()}function b(n){if(n instanceof R){if(n.publicKey instanceof B)return new m(n,new w(new F(new Uint8Array(64))));if(n.publicKey instanceof v)return new m(n,new w(new K(new Uint8Array(64))))}return n instanceof V?new m(new R(n),new w(q.getSimulationSignature())):new h(new B(n.toUint8Array()),new F(new Uint8Array(64)))}function wn(n){let{transaction:t,feePayerAuthenticator:r,additionalSignersAuthenticators:i}=n,e=C(O,n.senderAuthenticator),a;if(t.feePayerAddress){if(!r)throw new Error("Must provide a feePayerAuthenticator argument to generate a signed fee payer transaction");a=new P(e,t.secondarySignerAddresses??[],i??[],{address:t.feePayerAddress,authenticator:r})}else if(t.secondarySignerAddresses){if(!i)throw new Error("Must provide a additionalSignersAuthenticators argument to generate a signed multi agent transaction");a=new T(e,t.secondarySignerAddresses,i)}else e instanceof h?a=new U(e.public_key,e.signature):a=new I(e);return new d(t.rawTransaction,a).bcsToBytes()}function cn(n){let t=mn.create();for(let r of n)t.update(r);return t.digest()}var hn=cn(["ENDLESS::Transaction"]);function Xn(n){let t=wn(n);return new x(cn([hn,new Uint8Array([0]),t])).toString()}async function un({key:n,moduleAddress:t,moduleName:r,functionName:i,endlessConfig:e,abi:a,fetch:o}){return a!==void 0?a:k(async()=>o(t,r,i,e),`${n}-${e.network}-${t}-${r}-${i}`,1e3*60*5)()}export{vn as a,fn as b,Kn as c,gn as d,pn as e,On as f,Hn as g,Ln as h,b as i,wn as j,cn as k,Xn as l};
//# sourceMappingURL=chunk-4VCBTKFR.mjs.map