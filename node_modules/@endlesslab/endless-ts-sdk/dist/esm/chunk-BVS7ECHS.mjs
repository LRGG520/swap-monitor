import{a as y,c as B,d as T,e as P}from"./chunk-IVVWQKCF.mjs";import{a as V}from"./chunk-C4Y2KADZ.mjs";import{a as w,b as p}from"./chunk-TACUSWEG.mjs";import{a as U,c as x}from"./chunk-LQF2EBCE.mjs";import{b as I}from"./chunk-I4NAVGRF.mjs";import{a as d}from"./chunk-KQGTQFQE.mjs";import{a as M}from"./chunk-ZMWKA46Z.mjs";import{b as A}from"./chunk-QIZBLM6W.mjs";import{a as C}from"./chunk-5IOCOOCF.mjs";import{b}from"./chunk-R7AH4Q5E.mjs";import{a as G}from"./chunk-2PISSJSZ.mjs";import{a as S,b as H}from"./chunk-Y3FIGVYP.mjs";import{b as u}from"./chunk-H24X6T4W.mjs";import{jwtDecode as R}from"jwt-decode";import{sha3_256 as L}from"@noble/hashes/sha3";var ge=1e7,N=120,F=30,O=330,he=120,fe=350,Se=300,be=93,o=class o extends I{constructor(e,t){super();let r=u.fromHexInput(t).toUint8Array();if(r.length!==o.ID_COMMITMENT_LENGTH)throw new Error(`Id Commitment length in bytes should be ${o.ID_COMMITMENT_LENGTH}`);this.iss=e,this.idCommitment=r}authKey(){let e=new H;return e.serializeU32AsUleb128(3),e.serializeFixedBytes(this.bcsToBytes()),C.fromSchemeAndBytes({scheme:2,input:e.toUint8Array()})}toUint8Array(){return this.bcsToBytes()}toString(){return u.fromHexInput(this.toUint8Array()).toString()}verifySignature(e){throw new Error("Not yet implemented")}serialize(e){e.serializeStr(this.iss),e.serializeBytes(this.idCommitment)}static deserialize(e){let t=e.deserializeStr(),r=e.deserializeBytes();return new o(t,r)}static load(e){let t=e.deserializeStr(),r=e.deserializeBytes();return new o(t,r)}static isPublicKey(e){return e instanceof o}static create(e){return _(e),new o(e.iss,_(e))}static fromJwtAndPepper(e){let{jwt:t,pepper:r,uidKey:n="sub"}=e,a=R(t),s=a.iss;if(typeof a.aud!="string")throw new Error("aud was not found or an array of values");let f=a.aud,D=a[n];return o.create({iss:s,uidKey:n,uidVal:D,aud:f,pepper:r})}static isInstance(e){return"iss"in e&&typeof e.iss=="string"&&"idCommitment"in e&&e.idCommitment instanceof Uint8Array}};o.ID_COMMITMENT_LENGTH=32;var z=o;function _(i){let{uidKey:e,uidVal:t,aud:r,pepper:n}=i,a=[B(u.fromHexInput(n).toUint8Array()),y(r,N),y(t,O),y(e,F)];return T(P(a),z.ID_COMMITMENT_LENGTH)}var v=class i extends d{constructor(e){super();let{jwtHeader:t,ephemeralCertificate:r,expiryDateSecs:n,ephemeralPublicKey:a,ephemeralSignature:s}=e;this.jwtHeader=t,this.ephemeralCertificate=r,this.expiryDateSecs=n,this.ephemeralPublicKey=a,this.ephemeralSignature=s}toUint8Array(){return this.bcsToBytes()}serialize(e){this.ephemeralCertificate.serialize(e),e.serializeStr(this.jwtHeader),e.serializeU64(this.expiryDateSecs),this.ephemeralPublicKey.serialize(e),this.ephemeralSignature.serialize(e)}static deserialize(e){let t=m.deserialize(e),r=e.deserializeStr(),n=e.deserializeU64(),a=w.deserialize(e),s=p.deserialize(e);return new i({jwtHeader:r,expiryDateSecs:Number(n),ephemeralCertificate:t,ephemeralPublicKey:a,ephemeralSignature:s})}static getSimulationSignature(){return new i({jwtHeader:"{}",ephemeralCertificate:new m(new h({proof:new g({a:new Uint8Array(32),b:new Uint8Array(64),c:new Uint8Array(32)}),nonMalleabilitySignature:new p(new x(new Uint8Array(64))),expHorizonSecs:0}),0),expiryDateSecs:0,ephemeralPublicKey:new w(new U(new Uint8Array(32))),ephemeralSignature:new p(new x(new Uint8Array(64)))})}static isSignature(e){return e instanceof i}},m=class i extends d{constructor(e,t){super(),this.signature=e,this.variant=t}toUint8Array(){return this.signature.toUint8Array()}serialize(e){e.serializeU32AsUleb128(this.variant),this.signature.serialize(e)}static deserialize(e){let t=e.deserializeUleb128AsU32();switch(t){case 0:return new i(h.deserialize(e),t);default:throw new Error(`Unknown variant index for EphemeralCertificate: ${t}`)}}},l=class i extends S{constructor(e){if(super(),this.data=u.fromHexInput(e).toUint8Array(),this.data.length!==32)throw new Error("Input needs to be 32 bytes")}serialize(e){e.serializeFixedBytes(this.data)}static deserialize(e){let t=e.deserializeFixedBytes(32);return new i(t)}},c=class i extends S{constructor(e){if(super(),this.data=u.fromHexInput(e).toUint8Array(),this.data.length!==64)throw new Error("Input needs to be 64 bytes")}serialize(e){e.serializeFixedBytes(this.data)}static deserialize(e){let t=e.deserializeFixedBytes(64);return new i(t)}},g=class i extends V{constructor(e){super();let{a:t,b:r,c:n}=e;this.a=new l(t),this.b=new c(r),this.c=new l(n)}serialize(e){this.a.serialize(e),this.b.serialize(e),this.c.serialize(e)}static deserialize(e){let t=l.deserialize(e).bcsToBytes(),r=c.deserialize(e).bcsToBytes(),n=l.deserialize(e).bcsToBytes();return new i({a:t,b:r,c:n})}hash(){let e=L.create();e.update("ENDLESS::Groth16Zkp");let t=e.digest(),r=this.bcsToBytes(),n=new Uint8Array(t.length+r.length);return n.set(t),n.set(r,t.length),n}},h=class i extends d{constructor(e){super();let{proof:t,expHorizonSecs:r,trainingWheelsSignature:n,extraField:a,overrideAudVal:s}=e;this.proof=t,this.nonMalleabilitySignature=e.nonMalleabilitySignature,this.expHorizonSecs=r,this.trainingWheelsSignature=n,this.extraField=a,this.overrideAudVal=s}toUint8Array(){return this.bcsToBytes()}static fromBytes(e){return i.deserialize(new G(e))}serialize(e){this.proof.serialize(e),this.nonMalleabilitySignature.serialize(e),e.serializeU64(this.expHorizonSecs),e.serializeOptionStr(this.extraField),e.serializeOptionStr(this.overrideAudVal),e.serializeOption(this.trainingWheelsSignature)}static deserialize(e){let t=g.deserialize(e),r=p.deserialize(e),n=Number(e.deserializeU64()),a=e.deserializeOptionStr(),s=e.deserializeOptionStr(),f=e.deserializeOption(p);return new i({proof:t,nonMalleabilitySignature:r,expHorizonSecs:n,trainingWheelsSignature:f,extraField:a,overrideAudVal:s})}},E=class i{constructor(e,t){this.verficationKey=e,this.maxExpHorizonSecs=t}static create(e,t){return new i(new K({alphaG1:e.alpha_g1,betaG2:e.beta_g2,deltaG2:e.delta_g2,gammaAbcG1:e.gamma_abc_g1,gammaG2:e.gamma_g2}),t)}},K=class i{constructor(e){let{alphaG1:t,betaG2:r,deltaG2:n,gammaAbcG1:a,gammaG2:s}=e;this.alphaG1=new l(t),this.betaG2=new c(r),this.deltaG2=new c(n),this.gammaAbcG1=[new l(a[0]),new l(a[1])],this.gammaG2=new c(s)}static fromGroth16VerificationKeyResponse(e){return new i({alphaG1:e.alpha_g1,betaG2:e.beta_g2,deltaG2:e.delta_g2,gammaAbcG1:e.gamma_abc_g1,gammaG2:e.gamma_g2})}};async function xe(i){let{endlessConfig:e}=i;return M(async()=>{let t=await j(i),r=await k(i);return E.create(r,Number(t.max_exp_horizon_secs))},`keyless-configuration-${e.network}`,1e3*60*5)()}async function j(i){let{endlessConfig:e,options:t}=i,r="0x1::openid_account::Configuration",{data:n}=await A({endlessConfig:e,originMethod:"getKeylessConfigurationResource",path:`accounts/${b.from("0x1").toString()}/resource/${r}`,params:{ledger_version:t?.ledgerVersion}});return n.data}async function k(i){let{endlessConfig:e,options:t}=i,r="0x1::openid_account::Groth16VerificationKey",{data:n}=await A({endlessConfig:e,originMethod:"getGroth16VerificationKeyResource",path:`accounts/${b.from("0x1").toString()}/resource/${r}`,params:{ledger_version:t?.ledgerVersion}});return n.data}export{ge as a,N as b,F as c,O as d,he as e,fe as f,Se as g,be as h,z as i,v as j,m as k,g as l,h as m,E as n,xe as o};
//# sourceMappingURL=chunk-BVS7ECHS.mjs.map