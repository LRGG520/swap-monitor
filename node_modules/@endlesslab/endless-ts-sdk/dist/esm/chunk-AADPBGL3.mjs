import{e as x,f as B}from"./chunk-YPRVBJBD.mjs";import{a as h}from"./chunk-QEQ3A6VM.mjs";import{a as k}from"./chunk-ZMWKA46Z.mjs";import{b as d,d as b}from"./chunk-QIZBLM6W.mjs";import{a as C}from"./chunk-Q43D55M4.mjs";import{d as E}from"./chunk-LWKCWJBC.mjs";async function H(t){let{endlessConfig:s,options:n}=t;return b({endlessConfig:s,originMethod:"getTransactions",path:"transactions",params:{start:n?.offset,limit:n?.limit}})}async function G(t){let{endlessConfig:s}=t;return k(async()=>{let{data:n}=await d({endlessConfig:s,originMethod:"getGasPriceEstimation",path:"estimate_gas_price"});return n},`gas-price-${s.network}`,1e3*60*5)()}async function W(t){let{endlessConfig:s,ledgerVersion:n}=t,{data:e}=await d({endlessConfig:s,originMethod:"getTransactionByVersion",path:`transactions/by_version/${n}`});return e}async function y(t){let{endlessConfig:s,transactionHash:n}=t,{data:e}=await d({endlessConfig:s,path:`transactions/by_hash/${n}`,originMethod:"getTransactionByHash"});return e}async function O(t){let{endlessConfig:s,transactionHash:n}=t;try{return(await y({endlessConfig:s,transactionHash:n})).type==="pending_transaction"}catch(e){if(e?.status===404)return!0;throw e}}async function R(t){let{endlessConfig:s,transactionHash:n}=t,{data:e}=await d({endlessConfig:s,path:`transactions/wait_by_hash/${n}`,originMethod:"longWaitForTransaction"});return e}async function q(t){let{endlessConfig:s,transactionHash:n,options:e}=t,r=e?.timeoutSecs??20,f=e?.checkSuccess??!0,i=!0,l=0,o,p,g=200,m=1.5;function c(a){if(!(a instanceof C)||(p=a,a.status!==404&&a.status>=400&&a.status<500))throw a}try{o=await y({endlessConfig:s,transactionHash:n}),i=o.type==="pending_transaction"}catch(a){c(a)}if(i){let a=Date.now();try{o=await R({endlessConfig:s,transactionHash:n}),i=o.type==="pending_transaction"}catch(w){c(w)}l=(Date.now()-a)/1e3}for(;i&&!(l>=r);){try{if(o=await y({endlessConfig:s,transactionHash:n}),i=o.type==="pending_transaction",!i)break}catch(a){c(a)}await h(g),l+=g/1e3,g*=m}if(o===void 0)throw p||new u(`Fetching transaction ${n} failed and timed out after ${r} seconds`,o);if(o.type==="pending_transaction")throw new u(`Transaction ${n} timed out in pending state after ${r} seconds`,o);if(!f)return o;if(!o.success)throw new T(`Transaction ${n} failed with an error: ${o.vm_status}`,o);return o}async function z(t){let{endlessConfig:s,processorType:n}=t,e=BigInt(t.minimumLedgerVersion),r=3e3,f=new Date().getTime(),i=BigInt(-1);for(;i<e;){if(new Date().getTime()-f>r)throw new Error("waitForLastSuccessIndexerVersionSync timeout");if(n===void 0?i=await x({endlessConfig:s}):i=(await B({endlessConfig:s,processorType:n})).last_success_version,i>=e)break;await h(200)}}var u=class extends Error{constructor(s,n){super(s),this.lastSubmittedTransaction=n}},T=class extends Error{constructor(s,n){super(s),this.transaction=n}};async function U(t){let{endlessConfig:s,ledgerVersion:n,options:e}=t,{data:r}=await d({endlessConfig:s,originMethod:"getBlockByVersion",path:`blocks/by_version/${n}`,params:{with_transactions:e?.withTransactions}});return P({block:r,...t})}async function X(t){let{endlessConfig:s,blockHeight:n,options:e}=t,{data:r}=await d({endlessConfig:s,originMethod:"getBlockByHeight",path:`blocks/by_height/${n}`,params:{with_transactions:e?.withTransactions}});return P({block:r,...t})}async function P(t){let{endlessConfig:s,block:n,options:e}=t;if(e?.withTransactions){n.transactions=n.transactions??[];let r=n.transactions[n.transactions.length-1],f=BigInt(n.first_version),i=BigInt(n.last_version),l=r?.version,o;if(l===void 0?o=f-1n:o=BigInt(l),o===i)return n;let p=[],g=100n;for(let c=o+1n;c<i;c+=BigInt(100))p.push(H({endlessConfig:s,options:{offset:c,limit:Math.min(Number(g),Number(i-c+1n))}}));let m=await Promise.all(p);for(let c of m)n.transactions.push(...c)}return n}export{H as a,G as b,W as c,y as d,O as e,R as f,q as g,z as h,u as i,T as j,U as k,X as l};
//# sourceMappingURL=chunk-AADPBGL3.mjs.map