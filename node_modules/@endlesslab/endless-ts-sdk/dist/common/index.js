"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { newObj[key] = obj[key]; } } } newObj.default = obj; return newObj; } } function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; } function _nullishCoalesce(lhs, rhsFn) { if (lhs != null) { return lhs; } else { return rhsFn(); } } async function _asyncNullishCoalesce(lhs, rhsFn) { if (lhs != null) { return lhs; } else { return await rhsFn(); } } function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; } function _optionalChainDelete(ops) { const result = _optionalChain(ops); return result == null ? true : result; }var oa=Object.defineProperty;var aa=Object.getOwnPropertyDescriptor;var L=(n,e,t,r)=>{for(var s=r>1?void 0:r?aa(e,t):e,i=n.length-1,o;i>=0;i--)(o=n[i])&&(s=(r?o(e,t,s):o(s))||s);return r&&s&&oa(e,t,s),s};var Pn=255,In=65535,Ie=4294967295,it=18446744073709551615n,Yt=340282366920938463463374607431768211455n,Un=115792089237316195423570985008687907853269984665640564039457584007913129639935n;var re=class{constructor(e){this.buffer=new ArrayBuffer(e.length),new Uint8Array(this.buffer).set(e,0),this.offset=0}read(e){if(this.offset+e>this.buffer.byteLength)throw new Error("Reached to the end of buffer");let t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}deserializeStr(){let e=this.deserializeBytes();return new TextDecoder().decode(e)}deserializeOptionStr(){return this.deserializeBool()?this.deserializeStr():void 0}deserializeOption(e){return this.deserializeBool()?this.deserialize(e):void 0}deserializeBytes(){let e=this.deserializeUleb128AsU32();return new Uint8Array(this.read(e))}deserializeFixedBytes(e){return new Uint8Array(this.read(e))}deserializeBool(){let e=new Uint8Array(this.read(1))[0];if(e!==1&&e!==0)throw new Error("Invalid boolean value");return e===1}deserializeU8(){return new DataView(this.read(1)).getUint8(0)}deserializeU16(){return new DataView(this.read(2)).getUint16(0,!0)}deserializeU32(){return new DataView(this.read(4)).getUint32(0,!0)}deserializeU64(){let e=this.deserializeU32(),t=this.deserializeU32();return BigInt(BigInt(t)<<BigInt(32)|BigInt(e))}deserializeU128(){let e=this.deserializeU64(),t=this.deserializeU64();return BigInt(t<<BigInt(64)|e)}deserializeU256(){let e=this.deserializeU128(),t=this.deserializeU128();return BigInt(t<<BigInt(128)|e)}deserializeUleb128AsU32(){let e=BigInt(0),t=0;for(;e<Ie;){let r=this.deserializeU8();if(e|=BigInt(r&127)<<BigInt(t),(r&128)===0)break;t+=7}if(e>Ie)throw new Error("Overflow while parsing uleb128-encoded uint32 value");return Number(e)}deserialize(e){return e.deserialize(this)}deserializeVector(e){let t=this.deserializeUleb128AsU32(),r=new Array;for(let s=0;s<t;s+=1)r.push(this.deserialize(e));return r}};var _utils = require('@noble/hashes/utils');var X=class extends Error{constructor(e,t){super(e),this.invalidReason=t}};var da=(r=>(r.TOO_SHORT="too_short",r.INVALID_LENGTH="invalid_length",r.INVALID_HEX_CHARS="invalid_hex_chars",r))(da||{}),p= exports.Hex =class n{constructor(e){this.data=e}toUint8Array(){return this.data}toStringWithoutPrefix(){return _utils.bytesToHex.call(void 0, this.data)}toString(){return`0x${this.toStringWithoutPrefix()}`}static fromHexString(e){let t=e;if(t.startsWith("0x")&&(t=t.slice(2)),t.length===0)throw new X("Hex string is too short, must be at least 1 char long, excluding the optional leading 0x.","too_short");if(t.length%2!==0)throw new X("Hex string must be an even number of hex characters.","invalid_length");try{return new n(_utils.hexToBytes.call(void 0, t))}catch(r){throw new X(`Hex string contains invalid hex characters: ${_optionalChain([r, 'optionalAccess', _2 => _2.message])}`,"invalid_hex_chars")}}static fromHexInput(e){return e instanceof Uint8Array?new n(e):n.fromHexString(e)}static isValid(e){try{return n.fromHexString(e),{valid:!0}}catch(t){return{valid:!1,invalidReason:_optionalChain([t, 'optionalAccess', _3 => _3.invalidReason]),invalidReasonMessage:_optionalChain([t, 'optionalAccess', _4 => _4.message])}}}equals(e){return this.data.length!==e.data.length?!1:this.data.every((t,r)=>t===e.data[r])}};var l=class{bcsToBytes(){let e=new F;return this.serialize(e),e.toUint8Array()}bcsToHex(){let e=this.bcsToBytes();return p.fromHexInput(e)}},F= exports.Serializer =class{constructor(e=64){if(e<=0)throw new Error("Length needs to be greater than 0");this.buffer=new ArrayBuffer(e),this.offset=0}ensureBufferWillHandleSize(e){for(;this.buffer.byteLength<this.offset+e;){let t=new ArrayBuffer(this.buffer.byteLength*2);new Uint8Array(t).set(new Uint8Array(this.buffer)),this.buffer=t}}appendToBuffer(e){this.ensureBufferWillHandleSize(e.length),new Uint8Array(this.buffer,this.offset).set(e),this.offset+=e.length}serializeWithFunction(e,t,r){this.ensureBufferWillHandleSize(t);let s=new DataView(this.buffer,this.offset);e.apply(s,[0,r,!0]),this.offset+=t}serializeStr(e){let t=new TextEncoder;this.serializeBytes(t.encode(e))}serializeBytes(e){this.serializeU32AsUleb128(e.length),this.appendToBuffer(e)}serializeFixedBytes(e){this.appendToBuffer(e)}serializeBool(e){wr(e);let t=e?1:0;this.appendToBuffer(new Uint8Array([t]))}serializeU8(e){this.appendToBuffer(new Uint8Array([e]))}serializeU16(e){this.serializeWithFunction(DataView.prototype.setUint16,2,e)}serializeU32(e){this.serializeWithFunction(DataView.prototype.setUint32,4,e)}serializeU64(e){let t=BigInt(e)&BigInt(Ie),r=BigInt(e)>>BigInt(32);this.serializeU32(Number(t)),this.serializeU32(Number(r))}serializeU128(e){let t=BigInt(e)&it,r=BigInt(e)>>BigInt(64);this.serializeU64(t),this.serializeU64(r)}serializeU256(e){let t=BigInt(e)&Yt,r=BigInt(e)>>BigInt(128);this.serializeU128(t),this.serializeU128(r)}serializeU32AsUleb128(e){let t=e,r=[];for(;t>>>7;)r.push(t&127|128),t>>>=7;r.push(t),this.appendToBuffer(new Uint8Array(r))}toUint8Array(){return new Uint8Array(this.buffer).slice(0,this.offset)}serialize(e){e.serialize(this)}serializeVector(e){this.serializeU32AsUleb128(e.length),e.forEach(t=>{t.serialize(this)})}serializeOption(e){let t=e!==void 0;this.serializeBool(t),t&&e.serialize(this)}serializeOptionStr(e){e===void 0?this.serializeU32AsUleb128(0):(this.serializeU32AsUleb128(1),this.serializeStr(e))}};L([ot(0,Pn)],F.prototype,"serializeU8",1),L([ot(0,In)],F.prototype,"serializeU16",1),L([ot(0,Ie)],F.prototype,"serializeU32",1),L([ot(BigInt(0),it)],F.prototype,"serializeU64",1),L([ot(BigInt(0),Yt)],F.prototype,"serializeU128",1),L([ot(BigInt(0),Un)],F.prototype,"serializeU256",1),L([ot(0,Ie)],F.prototype,"serializeU32AsUleb128",1);function wr(n){if(typeof n!="boolean")throw new Error(`${n} is not a boolean value`)}var la=(n,e,t)=>`${n} is out of range: [${e}, ${t}]`;function Fe(n,e,t){let r=BigInt(n);if(r>BigInt(t)||r<BigInt(e))throw new Error(la(n,e,t))}function ot(n,e){return(t,r,s)=>{let i=s.value;return s.value=function(a){return Fe(a,n,e),i.apply(this,[a])},s}}var at=class n extends l{constructor(e){super(),this.value=p.fromHexInput(e).toUint8Array()}serialize(e){e.serializeFixedBytes(this.value)}serializeForEntryFunction(e){e.serialize(this)}serializeForScriptFunction(e){e.serialize(this)}static deserialize(e,t){let r=e.deserializeFixedBytes(t);return new n(r)}};var Rn=class n extends l{constructor(e){super(),this.value=new at(e)}serialize(e){e.serialize(this.value)}serializeForEntryFunction(e){e.serializeU32AsUleb128(this.value.value.length),e.serialize(this)}static deserialize(e,t){let r=at.deserialize(e,t);return new n(r.value)}};var zn=(s=>(s.JSON="application/json",s.BCS="application/x-bcs",s.BCS_SIGNED_TRANSACTION="application/x.endless.signed_transaction+bcs",s.BCS_VIEW_FUNCTION="application/x.endless.view_function+bcs",s))(zn||{}),ms= exports.TypeTagVariants =(m=>(m[m.Bool=0]="Bool",m[m.U8=1]="U8",m[m.U64=2]="U64",m[m.U128=3]="U128",m[m.Address=4]="Address",m[m.Signer=5]="Signer",m[m.Vector=6]="Vector",m[m.Struct=7]="Struct",m[m.U16=8]="U16",m[m.U32=9]="U32",m[m.U256=10]="U256",m[m.Reference=254]="Reference",m[m.Generic=255]="Generic",m))(ms||{}),Zt= exports.ScriptTransactionArgumentVariants =(d=>(d[d.U8=0]="U8",d[d.U64=1]="U64",d[d.U128=2]="U128",d[d.Address=3]="Address",d[d.U8Vector=4]="U8Vector",d[d.Bool=5]="Bool",d[d.U16=6]="U16",d[d.U32=7]="U32",d[d.U256=8]="U256",d))(Zt||{}),ys= exports.TransactionPayloadVariants =(i=>(i[i.Script=0]="Script",i[i.EntryFunction=2]="EntryFunction",i[i.Multisig=3]="Multisig",i[i.SafeScript=4]="SafeScript",i[i.SafeEntryFunction=5]="SafeEntryFunction",i))(ys||{}),fs= exports.TransactionVariants =(t=>(t[t.MultiAgentTransaction=0]="MultiAgentTransaction",t[t.FeePayerTransaction=1]="FeePayerTransaction",t))(fs||{}),As= exports.TransactionAuthenticatorVariant =(i=>(i[i.Ed25519=0]="Ed25519",i[i.MultiEd25519=1]="MultiEd25519",i[i.MultiAgent=2]="MultiAgent",i[i.FeePayer=3]="FeePayer",i[i.SingleSender=4]="SingleSender",i))(As||{}),hs= exports.AccountAuthenticatorVariant =(a=>(a[a.Ed25519=0]="Ed25519",a[a.MultiEd25519=1]="MultiEd25519",a[a.SingleKey=2]="SingleKey",a[a.MultiKey=3]="MultiKey",a[a.MultiAuthKey=4]="MultiAuthKey",a[a.Bls12381=5]="Bls12381",a[a.Mock=6]="Mock",a))(hs||{}),Sr= exports.AnyPublicKeyVariant =(s=>(s[s.Ed25519=0]="Ed25519",s[s.Secp256k1=1]="Secp256k1",s[s.Keyless=3]="Keyless",s[s.Bls12381=4]="Bls12381",s))(Sr||{}),bs= exports.AnySignatureVariant =(s=>(s[s.Ed25519=0]="Ed25519",s[s.Secp256k1=1]="Secp256k1",s[s.Keyless=3]="Keyless",s[s.Bls12381=4]="Bls12381",s))(bs||{}),xr= exports.EphemeralPublicKeyVariant =(e=>(e[e.Ed25519=0]="Ed25519",e))(xr||{}),Ts= exports.EphemeralSignatureVariant =(e=>(e[e.Ed25519=0]="Ed25519",e))(Ts||{}),_r= exports.EphemeralCertificateVariant =(e=>(e[e.ZkProof=0]="ZkProof",e))(_r||{}),ws= exports.TransactionResponseType =(a=>(a.Pending="pending_transaction",a.User="user_transaction",a.Genesis="genesis_transaction",a.BlockMetadata="block_metadata_transaction",a.StateCheckpoint="state_checkpoint_transaction",a.Validator="validator_transaction",a.BlockEpilogue="block_epilogue_transaction",a))(ws||{});function Ku(n){return n.type==="pending_transaction"}function Bu(n){return n.type==="user_transaction"}function Du(n){return n.type==="genesis_transaction"}function ku(n){return n.type==="block_metadata_transaction"}function Gu(n){return n.type==="state_checkpoint_transaction"}function Nu(n){return n.type==="validator_transaction"}function Mu(n){return n.type==="block_epilogue_transaction"}function Ou(n){return"signature"in n&&n.signature==="ed25519_signature"}function Fu(n){return"signature"in n&&n.signature==="secp256k1_ecdsa_signature"}function qu(n){return n.type==="multi_agent_signature"}function Hu(n){return n.type==="fee_payer_signature"}function Lu(n){return n.type==="multi_ed25519_signature"}var pa=(r=>(r.PRIVATE="private",r.PUBLIC="public",r.FRIEND="friend",r))(pa||{}),Kn= exports.MoveAbility =(s=>(s.STORE="store",s.DROP="drop",s.KEY="key",s.COPY="copy",s))(Kn||{}),ga= exports.RoleType =(t=>(t.VALIDATOR="validator",t.FULL_NODE="full_node",t))(ga||{}),se= exports.SigningScheme =(o=>(o[o.Ed25519=0]="Ed25519",o[o.MultiEd25519=1]="MultiEd25519",o[o.SingleKey=2]="SingleKey",o[o.MultiKey=3]="MultiKey",o[o.MultiAuthKey=4]="MultiAuthKey",o[o.Bls12381=5]="Bls12381",o))(se||{}),Er= exports.SigningSchemeInput =(t=>(t[t.Ed25519=0]="Ed25519",t[t.Secp256k1Ecdsa=2]="Secp256k1Ecdsa",t))(Er||{}),ma= exports.DeriveScheme =(i=>(i[i.DeriveAuid=251]="DeriveAuid",i[i.DeriveObjectAddressFromObject=252]="DeriveObjectAddressFromObject",i[i.DeriveObjectAddressFromGuid=253]="DeriveObjectAddressFromGuid",i[i.DeriveObjectAddressFromSeed=254]="DeriveObjectAddressFromSeed",i[i.DeriveResourceAccountAddress=255]="DeriveResourceAccountAddress",i))(ma||{});var U=class n extends l{constructor(e){super(),wr(e),this.value=e}serialize(e){e.serializeBool(this.value)}serializeForEntryFunction(e){let t=this.bcsToBytes();e.serializeBytes(t)}serializeForScriptFunction(e){e.serializeU32AsUleb128(5),e.serialize(this)}static deserialize(e){return new n(e.deserializeBool())}},q= exports.U8 =class n extends l{constructor(e){super(),Fe(e,0,Pn),this.value=e}serialize(e){e.serializeU8(this.value)}serializeForEntryFunction(e){let t=this.bcsToBytes();e.serializeBytes(t)}serializeForScriptFunction(e){e.serializeU32AsUleb128(0),e.serialize(this)}static deserialize(e){return new n(e.deserializeU8())}},ie= exports.U16 =class n extends l{constructor(e){super(),Fe(e,0,In),this.value=e}serialize(e){e.serializeU16(this.value)}serializeForEntryFunction(e){let t=this.bcsToBytes();e.serializeBytes(t)}serializeForScriptFunction(e){e.serializeU32AsUleb128(6),e.serialize(this)}static deserialize(e){return new n(e.deserializeU16())}},oe= exports.U32 =class n extends l{constructor(e){super(),Fe(e,0,Ie),this.value=e}serialize(e){e.serializeU32(this.value)}serializeForEntryFunction(e){let t=this.bcsToBytes();e.serializeBytes(t)}serializeForScriptFunction(e){e.serializeU32AsUleb128(7),e.serialize(this)}static deserialize(e){return new n(e.deserializeU32())}},H= exports.U64 =class n extends l{constructor(e){super(),Fe(e,BigInt(0),it),this.value=BigInt(e)}serialize(e){e.serializeU64(this.value)}serializeForEntryFunction(e){let t=this.bcsToBytes();e.serializeBytes(t)}serializeForScriptFunction(e){e.serializeU32AsUleb128(1),e.serialize(this)}static deserialize(e){return new n(e.deserializeU64())}},me= exports.U128 =class n extends l{constructor(e){super(),Fe(e,BigInt(0),Yt),this.value=BigInt(e)}serialize(e){e.serializeU128(this.value)}serializeForEntryFunction(e){let t=this.bcsToBytes();e.serializeBytes(t)}serializeForScriptFunction(e){e.serializeU32AsUleb128(2),e.serialize(this)}static deserialize(e){return new n(e.deserializeU128())}},ye= exports.U256 =class n extends l{constructor(e){super(),Fe(e,BigInt(0),Un),this.value=BigInt(e)}serialize(e){e.serializeU256(this.value)}serializeForEntryFunction(e){let t=this.bcsToBytes();e.serializeBytes(t)}serializeForScriptFunction(e){e.serializeU32AsUleb128(8),e.serialize(this)}static deserialize(e){return new n(e.deserializeU256())}};var b=class n extends l{constructor(e){super(),this.values=e}serializeForEntryFunction(e){let t=this.bcsToBytes();e.serializeBytes(t)}serializeForScriptFunction(e){if(!(this.values[0]instanceof q)&&this.values[0]!==void 0)throw new Error("Script function arguments only accept u8 vectors");e.serializeU32AsUleb128(4),e.serialize(this)}static U8(e){let t;if(Array.isArray(e)&&typeof e[0]=="number")t=e;else if(typeof e=="string"){let r=p.fromHexInput(e);t=Array.from(r.toUint8Array())}else if(e instanceof Uint8Array)t=Array.from(e);else throw new Error("Invalid input type");return new n(t.map(r=>new q(r)))}static U16(e){return new n(e.map(t=>new ie(t)))}static U32(e){return new n(e.map(t=>new oe(t)))}static U64(e){return new n(e.map(t=>new H(t)))}static U128(e){return new n(e.map(t=>new me(t)))}static U256(e){return new n(e.map(t=>new ye(t)))}static Bool(e){return new n(e.map(t=>new U(t)))}static MoveString(e){return new n(e.map(t=>new x(t)))}serialize(e){e.serializeVector(this.values)}static deserialize(e,t){let r=e.deserializeUleb128AsU32(),s=new Array;for(let i=0;i<r;i+=1)s.push(t.deserialize(e));return new n(s)}},x= exports.MoveString =class n extends l{constructor(e){super(),this.value=e}serialize(e){e.serializeStr(this.value)}serializeForEntryFunction(e){let t=this.bcsToBytes();e.serializeBytes(t)}serializeForScriptFunction(e){let t=this.bcsToBytes().slice(1);b.U8(t).serializeForScriptFunction(e)}static deserialize(e){return new n(e.deserializeStr())}},qe= exports.MoveOption =class n extends l{constructor(e){super(),typeof e<"u"&&e!==null?this.vec=new b([e]):this.vec=new b([]),[this.value]=this.vec.values}serializeForEntryFunction(e){let t=this.bcsToBytes();e.serializeBytes(t)}unwrap(){if(this.isSome())return this.vec.values[0];throw new Error("Called unwrap on a MoveOption with no value")}isSome(){return this.vec.values.length===1}serialize(e){this.vec.serialize(e)}static U8(e){return new n(e!=null?new q(e):void 0)}static U16(e){return new n(e!=null?new ie(e):void 0)}static U32(e){return new n(e!=null?new oe(e):void 0)}static U64(e){return new n(e!=null?new H(e):void 0)}static U128(e){return new n(e!=null?new me(e):void 0)}static U256(e){return new n(e!=null?new ye(e):void 0)}static Bool(e){return new n(e!=null?new U(e):void 0)}static MoveString(e){return new n(e!=null?new x(e):void 0)}static deserialize(e,t){let r=b.deserialize(e,t);return new n(r.values[0])}};var _bs58 = require('bs58'); var _bs582 = _interopRequireDefault(_bs58);var fa=(a=>(a.INCORRECT_NUMBER_OF_BYTES="incorrect_number_of_bytes",a.INVALID_HEX_CHARS="invalid_hex_chars",a.TOO_SHORT="too_short",a.TOO_LONG="too_long",a.LEADING_ZERO_X_REQUIRED="leading_zero_x_required",a.LONG_FORM_REQUIRED_UNLESS_SPECIAL="long_form_required_unless_special",a.INVALID_PADDING_ZEROES="INVALID_PADDING_ZEROES",a))(fa||{}),T=class T extends l{constructor(e){if(super(),e.length!==T.LENGTH)throw new X("AccountAddress data should be exactly 32 bytes long","incorrect_number_of_bytes");this.data=e}isSpecial(){return this.data.slice(0,this.data.length-1).every(e=>e===0)&&this.data[this.data.length-1]<16}toString(){return`0x${this.toStringWithoutPrefix()}`}toBs58String(){return _bs582.default.encode(this.data)}toStringWithoutPrefix(){let e=_utils.bytesToHex.call(void 0, this.data);return this.isSpecial()&&(e=e[e.length-1]),e}toStringLong(){return`0x${this.toStringLongWithoutPrefix()}`}toStringLongWithoutPrefix(){return _utils.bytesToHex.call(void 0, this.data)}toUint8Array(){return this.data}serialize(e){e.serializeFixedBytes(this.data)}serializeForEntryFunction(e){let t=this.bcsToBytes();e.serializeBytes(t)}serializeForScriptFunction(e){e.serializeU32AsUleb128(3),e.serialize(this)}static deserialize(e){let t=e.deserializeFixedBytes(T.LENGTH);return new T(t)}static fromStringStrict(e){if(!e.startsWith("0x"))throw new X("Hex string must start with a leading 0x.","leading_zero_x_required");let t=T.fromString(e);if(e.length!==T.LONG_STRING_LENGTH+2)if(t.isSpecial()){if(e.length!==3)throw new X(`The given hex string ${e} is a special address not in LONG form, it must be 0x0 to 0xf without padding zeroes.`,"INVALID_PADDING_ZEROES")}else throw new X(`The given hex string ${e} is not a special address, it must be represented as 0x + 64 chars.`,"long_form_required_unless_special");return t}static fromString(e){let t=e;if(e.startsWith("0x"))t=e.slice(2);else try{let s=_bs582.default.decode(e);return new T(s)}catch (e2){}if(t.length===0)throw new X("Hex string is too short, must be 1 to 64 chars long, excluding the leading 0x.","too_short");if(t.length>64)throw new X(`Hex string is too long, must be 1 to 64 chars long, excluding the leading 0x. => ${t}`,"too_long");let r;try{r=_utils.hexToBytes.call(void 0, t.padStart(64,"0"))}catch(s){throw new X(`Hex characters are invalid: ${_optionalChain([s, 'optionalAccess', _5 => _5.message])}`,"invalid_hex_chars")}return new T(r)}static fromBs58String(e){let t=_bs582.default.decode(e);return new T(t)}static from(e){return e instanceof T?e:e instanceof Uint8Array?new T(e):T.fromString(e)}static fromStrict(e){return e instanceof T?e:e instanceof Uint8Array?new T(e):T.fromStringStrict(e)}static isValid(e){try{return e.strict?T.fromStrict(e.input):T.from(e.input),{valid:!0}}catch(t){return{valid:!1,invalidReason:_optionalChain([t, 'optionalAccess', _6 => _6.invalidReason]),invalidReasonMessage:_optionalChain([t, 'optionalAccess', _7 => _7.message])}}}equals(e){return this.data.length!==e.data.length?!1:this.data.every((t,r)=>t===e.data[r])}};T.LENGTH=32,T.LONG_STRING_LENGTH=64,T.ZERO=T.from("0x0"),T.ONE=T.from("0x1"),T.TWO=T.from("0x2"),T.THREE=T.from("0x3"),T.FOUR=T.from("0x4");var u=T;var _sha3 = require('@noble/hashes/sha3');var He=class He extends l{constructor(e){super();let{data:t}=e,r=p.fromHexInput(t);if(r.toUint8Array().length!==He.LENGTH)throw new Error(`Authentication Key length should be ${He.LENGTH}`);this.data=r}serialize(e){e.serializeFixedBytes(this.data.toUint8Array())}static deserialize(e){let t=e.deserializeFixedBytes(He.LENGTH);return new He({data:t})}toString(){return this.data.toString()}toUint8Array(){return this.data.toUint8Array()}static fromSchemeAndBytes(e){let{scheme:t,input:r}=e,s=p.fromHexInput(r).toUint8Array(),i=new Uint8Array([...s,t]),o=_sha3.sha3_256.create();o.update(i);let a=o.digest();return new He({data:a})}static fromPublicKeyAndScheme(e){let{publicKey:t}=e;return t.authKey()}static fromPublicKey(e){let{publicKey:t}=e;return t.authKey()}derivedAddress(){return new u(this.data.toUint8Array())}};He.LENGTH=32;var G=He;var _ed25519 = require('@noble/curves/ed25519');var _hmac = require('@noble/hashes/hmac');var _sha512 = require('@noble/hashes/sha512');var _bip39 = require('@scure/bip39'); var xs = _interopRequireWildcard(_bip39);var Ta=/^m\/44'\/637'\/[0-9]+'\/[0-9]+'\/[0-9]+'?$/,wa= exports.ENDLESS_BIP44_REGEX =/^m\/44'\/637'\/[0-9]+'\/[0-9]+\/[0-9]+$/,Sa= exports.KeyType =(e=>(e.ED25519="ed25519 seed",e))(Sa||{}),_s= exports.HARDENED_OFFSET =2147483648;function Es(n){return wa.test(n)}function vs(n){return Ta.test(n)}var Cr=(n,e)=>{let t=_hmac.hmac.create(_sha512.sha512,n).update(e).digest();return{key:t.slice(0,32),chainCode:t.slice(32)}},Cs= exports.CKDPriv =({key:n,chainCode:e},t)=>{let r=new ArrayBuffer(4);new DataView(r).setUint32(0,t);let s=new Uint8Array(r),i=new Uint8Array([0]),o=new Uint8Array([...i,...n,...s]);return Cr(e,o)},xa=n=>n.replace("'",""),Ps= exports.splitPath =n=>n.split("/").slice(1).map(xa),Bn= exports.mnemonicToSeed =n=>{let e=n.trim().split(/\s+/).map(t=>t.toLowerCase()).join(" ");return xs.mnemonicToSeedSync(e)};var ct=class extends l{toString(){let e=this.toUint8Array();return p.fromHexInput(e).toString()}},$= exports.AccountPublicKey =class extends ct{};var z=class extends l{toString(){let e=this.toUint8Array();return p.fromHexInput(e).toString()}};var Ue=n=>typeof n=="string"?p.isValid(n).valid?n:Buffer.from(n,"utf8"):n;var Is=[237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16],ut=class ut extends ${constructor(e){super();let t=p.fromHexInput(e);if(t.toUint8Array().length!==ut.LENGTH)throw new Error(`PublicKey length should be ${ut.LENGTH}`);this.key=t}verifySignature(e){let{message:t,signature:r}=e;if(!(r instanceof _))return!1;let s=Ue(t),i=p.fromHexInput(s).toUint8Array(),o=r.toUint8Array(),a=this.key.toUint8Array();return r.isCanonicalSignature()?_ed25519.ed25519.verify(o,i,a):!1}authKey(){return G.fromSchemeAndBytes({scheme:0,input:this.toUint8Array()})}toUint8Array(){return this.key.toUint8Array()}serialize(e){e.serializeBytes(this.key.toUint8Array())}static deserialize(e){let t=e.deserializeBytes();return new ut(t)}static isPublicKey(e){return e instanceof ut}};ut.LENGTH=32;var E=ut,ae=class ae extends l{constructor(e){super();let t=p.fromHexInput(e);if(t.toUint8Array().length!==ae.LENGTH)throw new Error(`PrivateKey length should be ${ae.LENGTH}`);this.signingKey=t}static generate(){let e=_ed25519.ed25519.utils.randomPrivateKey();return new ae(e)}static fromDerivationPath(e,t){if(!vs(e))throw new Error(`Invalid derivation path ${e}`);return ae.fromDerivationPathInner(e,Bn(t))}static fromDerivationPathInner(e,t,r=_s){let{key:s,chainCode:i}=Cr(ae.SLIP_0010_SEED,t),o=Ps(e).map(c=>parseInt(c,10)),{key:a}=o.reduce((c,d)=>Cs(c,d+r),{key:s,chainCode:i});return new ae(a)}publicKey(){let e=_ed25519.ed25519.getPublicKey(this.signingKey.toUint8Array());return new E(e)}sign(e){let t=Ue(e),r=p.fromHexInput(t).toUint8Array(),s=_ed25519.ed25519.sign(r,this.signingKey.toUint8Array());return new _(s)}toUint8Array(){return this.signingKey.toUint8Array()}toString(){return this.signingKey.toString()}serialize(e){e.serializeBytes(this.toUint8Array())}static deserialize(e){let t=e.deserializeBytes();return new ae(t)}static isPrivateKey(e){return e instanceof ae}};ae.LENGTH=32,ae.SLIP_0010_SEED="ed25519 seed";var W=ae,vt=class vt extends z{constructor(e){super();let t=p.fromHexInput(e);if(t.toUint8Array().length!==vt.LENGTH)throw new Error(`Signature length should be ${vt.LENGTH}`);this.data=t}toUint8Array(){return this.data.toUint8Array()}serialize(e){e.serializeBytes(this.data.toUint8Array())}static deserialize(e){let t=e.deserializeBytes();return new vt(t)}isCanonicalSignature(){let e=this.toUint8Array().slice(32);for(let t=e.length-1;t>=0;t-=1){if(e[t]<Is[t])return!0;if(e[t]>Is[t])return!1}return!1}};vt.LENGTH=64;var _=vt;var ce=class ce extends ${constructor(e){super();let{publicKeys:t,threshold:r}=e;if(t.length>ce.MAX_KEYS||t.length<ce.MIN_KEYS)throw new Error(`Must have between ${ce.MIN_KEYS} and ${ce.MAX_KEYS} public keys, inclusive`);if(r<ce.MIN_THRESHOLD||r>t.length)throw new Error(`Threshold must be between ${ce.MIN_THRESHOLD} and ${t.length}, inclusive`);this.publicKeys=t,this.threshold=r}verifySignature(e){let{message:t,signature:r}=e;if(!(r instanceof dt))return!1;let s=[];for(let i=0;i<4;i+=1)for(let o=0;o<8;o+=1)if((r.bitmap[i]&1<<7-o)!==0){let c=i*8+o;s.push(c)}if(s.length!==r.signatures.length)throw new Error("Bitmap and signatures length mismatch");if(s.length<this.threshold)throw new Error("Not enough signatures");for(let i=0;i<s.length;i+=1)if(!this.publicKeys[s[i]].verifySignature({message:t,signature:r.signatures[i]}))return!1;return!0}authKey(){return G.fromSchemeAndBytes({scheme:1,input:this.toUint8Array()})}toUint8Array(){let e=new Uint8Array(this.publicKeys.length*E.LENGTH+1);return this.publicKeys.forEach((t,r)=>{e.set(t.toUint8Array(),r*E.LENGTH)}),e[this.publicKeys.length*E.LENGTH]=this.threshold,e}serialize(e){e.serializeBytes(this.toUint8Array())}static deserialize(e){let t=e.deserializeBytes(),r=t[t.length-1],s=[];for(let i=0;i<t.length-1;i+=E.LENGTH){let o=i;s.push(new E(t.subarray(o,o+E.LENGTH)))}return new ce({publicKeys:s,threshold:r})}};ce.MAX_KEYS=32,ce.MIN_KEYS=2,ce.MIN_THRESHOLD=1;var Ct=ce,Y=class Y extends z{constructor(e){super();let{signatures:t,bitmap:r}=e;if(t.length>Y.MAX_SIGNATURES_SUPPORTED)throw new Error(`The number of signatures cannot be greater than ${Y.MAX_SIGNATURES_SUPPORTED}`);if(this.signatures=t,!(r instanceof Uint8Array))this.bitmap=Y.createBitmap({bits:r});else{if(r.length!==Y.BITMAP_LEN)throw new Error(`"bitmap" length should be ${Y.BITMAP_LEN}`);this.bitmap=r}}toUint8Array(){let e=new Uint8Array(this.signatures.length*_.LENGTH+Y.BITMAP_LEN);return this.signatures.forEach((t,r)=>{e.set(t.toUint8Array(),r*_.LENGTH)}),e.set(this.bitmap,this.signatures.length*_.LENGTH),e}serialize(e){e.serializeBytes(this.toUint8Array())}static deserialize(e){let t=e.deserializeBytes(),r=t.subarray(t.length-4),s=[];for(let i=0;i<t.length-r.length;i+=_.LENGTH){let o=i;s.push(new _(t.subarray(o,o+_.LENGTH)))}return new Y({signatures:s,bitmap:r})}static createBitmap(e){let{bits:t}=e,r=128,s=new Uint8Array([0,0,0,0]),i=new Set;return t.forEach((o,a)=>{if(o>=Y.MAX_SIGNATURES_SUPPORTED)throw new Error(`Cannot have a signature larger than ${Y.MAX_SIGNATURES_SUPPORTED-1}.`);if(i.has(o))throw new Error("Duplicate bits detected.");if(a>0&&o<=t[a-1])throw new Error("The bits need to be sorted in ascending order.");i.add(o);let c=Math.floor(o/8),d=s[c];d|=r>>o%8,s[c]=d}),s}};Y.MAX_SIGNATURES_SUPPORTED=32,Y.BITMAP_LEN=4;var dt=Y;var _jwtdecode = require('jwt-decode');var lt=class n extends ct{constructor(e){super();let t=e.constructor.name;switch(t){case E.name:this.publicKey=e,this.variant=0;break;default:throw new Error(`Unsupported key for EphemeralPublicKey - ${t}`)}}toUint8Array(){return this.bcsToBytes()}verifySignature(e){let{message:t,signature:r}=e;return this.publicKey.verifySignature({message:t,signature:r.signature})}serialize(e){if(this.publicKey instanceof E)e.serializeU32AsUleb128(0),this.publicKey.serialize(e);else throw new Error("Unknown public key type")}static deserialize(e){let t=e.deserializeUleb128AsU32();switch(t){case 0:return new n(E.deserialize(e));default:throw new Error(`Unknown variant index for EphemeralPublicKey: ${t}`)}}static isPublicKey(e){return e instanceof n}},ue= exports.EphemeralSignature =class n extends z{constructor(e){super();let t=e.constructor.name;switch(t){case _.name:this.signature=e;break;default:throw new Error(`Unsupported signature for EphemeralSignature - ${t}`)}}toUint8Array(){return this.bcsToBytes()}static fromHex(e){let t=p.fromHexInput(e),r=new re(t.toUint8Array());return n.deserialize(r)}serialize(e){if(this.signature instanceof _)e.serializeU32AsUleb128(0),this.signature.serialize(e);else throw new Error("Unknown signature type")}static deserialize(e){let t=e.deserializeUleb128AsU32();switch(t){case 0:return new n(_.deserialize(e));default:throw new Error(`Unknown variant index for EphemeralSignature: ${t}`)}}};var _poseidonlite = require('poseidon-lite');var Pr=[_poseidonlite.poseidon1,_poseidonlite.poseidon2,_poseidonlite.poseidon3,_poseidonlite.poseidon4,_poseidonlite.poseidon5,_poseidonlite.poseidon6,_poseidonlite.poseidon7,_poseidonlite.poseidon8,_poseidonlite.poseidon9,_poseidonlite.poseidon10,_poseidonlite.poseidon11,_poseidonlite.poseidon12,_poseidonlite.poseidon13,_poseidonlite.poseidon14,_poseidonlite.poseidon15,_poseidonlite.poseidon16],Rs=31,Oa=16,Us=(Oa-1)*Rs;function kn(n,e){let r=new TextEncoder().encode(n);return Fa(r,e)}function Fa(n,e){if(n.length>e)throw new Error(`Inputted bytes of length ${n} is longer than ${e}`);let t=Ir(n,e);return en(t)}function qa(n,e){if(n.length>e)throw new Error(`Input bytes of length ${n} is longer than ${e}`);let t=$a(n,e);return Ha(t)}function Ir(n,e){if(n.length>e)throw new Error(`Input bytes of length ${n} is longer than ${e}`);return qa(n,e).concat([BigInt(n.length)])}function Ha(n){if(n.length>Us)throw new Error(`Can't pack more than ${Us}.  Was given ${n.length} bytes`);return La(n,Rs).map(e=>Jt(e))}function La(n,e){let t=[];for(let r=0;r<n.length;r+=e)t.push(n.subarray(r,r+e));return t}function Jt(n){let e=BigInt(0);for(let t=n.length-1;t>=0;t-=1)e=e<<BigInt(8)|BigInt(n[t]);return e}function zs(n,e){let t=new Uint8Array(e);for(let r=0;r<e;r+=1)t[r]=Number(n&BigInt(255)),n>>=BigInt(8);return t}function $a(n,e){if(e<n.length)throw new Error("Padded size must be greater than or equal to the input array size.");let t=new Uint8Array(e);t.set(n);for(let r=n.length;r<e;r+=1)t[r]=0;return t}function en(n){if(n.length>Pr.length)throw new Error(`Unable to hash input of length ${n.length}.  Max input length is ${Pr.length}`);return Pr[n.length-1](n)}var Gn=class extends l{toString(){let e=this.bcsToBytes();return p.fromHexInput(e).toString()}};var he=class extends Error{constructor(e,t,r){super(r),this.name="EndlessApiError",this.url=t.url,this.status=t.status,this.statusText=t.statusText,this.data=t.data,this.request=e}};var Ks="1.0.5";var Bs={mainnet:"https://idx.endless.link/api/v1",testnet:"https://idx-test.endless.link/api/v1",devnet:"https://idx-testnet.endless.link/api/v1",local:"http://127.0.0.1:8090/v1/graphql"},Ds= exports.NetworkToIndexerAPIV2 ={mainnet:"https://idx.endless.com/v1/graphql",testnet:"https://idx-test.endless.link/api/v1",devnet:"https://idx-testnet.endless.link/api/v1",local:"http://127.0.0.1:8090/v1/graphql"},ks= exports.NetworkToNodeAPI ={mainnet:"https://rpc.endless.link/v1",testnet:"https://rpc-test.endless.link/v1",devnet:"https://rpc-testnet.endless.link/v1",local:"http://127.0.0.1:8080/v1"},El= exports.NetworkToFaucetAPI ={mainnet:"",testnet:"",devnet:"",local:"http://127.0.0.1:8081"},Gs= exports.NetworkToProverAPI ={mainnet:"https://wallet-zk.endless.link",testnet:"https://wallet-zk.endless.link",devnet:"https://wallet-zk.endless.link",local:"http://localhost:3001"},Ur= exports.Network =(i=>(i.MAINNET="mainnet",i.TESTNET="testnet",i.DEVNET="devnet",i.LOCAL="local",i.CUSTOM="custom",i))(Ur||{}),Rr= exports.NetworkToChainId ={mainnet:220,testnet:221,local:223,devnet:11},vl= exports.NetworkToNetworkName ={mainnet:"mainnet",testnet:"testnet",devnet:"devnet",local:"local",custom:"custom"};var tn=(o=>(o.FULLNODE="Fullnode",o.INDEXER="Indexer",o.FAUCET="Faucet",o.INDEXERV2="Indexer2",o.PEPPER="Pepper",o.PROVER="Prover",o))(tn||{}),Ns= exports.DEFAULT_MAX_GAS_AMOUNT =2e5,Ms= exports.DEFAULT_TXN_EXP_SEC_FROM_NOW =20,Os= exports.DEFAULT_TXN_TIMEOUT_SEC =20,Pl= exports.ENDLESS_COIN ="0x1::endless_coin::EndlessCoin",Fs= exports.ENDLESS_COIN_ID ="ENDLESSsssssssssssssssssssssssssssssssssssss",qs= exports.RAW_TRANSACTION_SALT ="ENDLESS::RawTransaction",zr= exports.RAW_TRANSACTION_WITH_DATA_SALT ="ENDLESS::RawTransactionWithData",pt= exports.ProcessorType =(a=>(a.ACCOUNT_TRANSACTION_PROCESSOR="account_transactions_processor",a.DEFAULT="default_processor",a.EVENTS_PROCESSOR="events_processor",a.FUNGIBLE_ASSET_PROCESSOR="fungible_asset_processor",a.STAKE_PROCESSOR="stake_processor",a.TOKEN_V2_PROCESSOR="token_v2_processor",a.USER_TRANSACTION_PROCESSOR="user_transaction_processor",a))(pt||{});function Hs(n,e){let t=e.bcsToBytes(),r=new re(t);return n.deserialize(r)}var Ls={400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",429:"Too Many Requests",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable"};async function Va(n,e){let{url:t,method:r,body:s,contentType:i,params:o,overrides:a,originMethod:c}=n,d={..._optionalChain([a, 'optionalAccess', _8 => _8.HEADERS]),"x-endless-client":`endless-typescript-sdk/${Ks}`,"content-type":_nullishCoalesce(i, () => ("application/json")),"x-endless-typescript-sdk-origin-method":c};return _optionalChain([a, 'optionalAccess', _9 => _9.API_KEY])&&(d.Authorization=`Bearer ${_optionalChain([a, 'optionalAccess', _10 => _10.API_KEY])}`),e.provider({url:t,method:r,body:s,params:o,headers:d,overrides:a})}async function Nn(n,e,t){let{url:r,path:s}=n,i=s?`${r}/${s}`:r,o=await Va({...n,url:i},e.client),a={status:o.status,statusText:o.statusText,data:o.data,headers:o.headers,config:o.config,request:o.request,url:i};if(a.status===401)throw new he(n,a,`Error: ${a.data}`);if(t==="Indexer"){let d=a.data;if(d.errors)throw new he(n,a,_optionalChain([d, 'access', _11 => _11.errors, 'optionalAccess', _12 => _12[0], 'optionalAccess', _13 => _13.message])?`Indexer error: ${d.errors[0].message}`:`Indexer unhandled Error ${o.status} : ${o.statusText}`);a.data=d}if(a.status>=200&&a.status<300)return a;let c;throw a&&a.data&&"message"in a.data&&"error_code"in a.data?c=JSON.stringify(a.data):a.status in Ls?c=Ls[a.status]:c=`Unhandled Error ${a.status} : ${a.statusText}`,new he(n,a,`${t} error: ${c}`)}async function Kr(n){let{endlessConfig:e,overrides:t,params:r,contentType:s,acceptType:i,path:o,originMethod:a,type:c}=n,d=e.getRequestUrl(c);return Nn({url:d,method:"GET",originMethod:a,path:o,contentType:s,acceptType:i,params:r,overrides:{...e.clientConfig,...t}},e,n.type)}async function V(n){let{endlessConfig:e}=n;return Kr({...n,type:"Fullnode",overrides:{...e.clientConfig,...e.fullnodeConfig,...n.overrides,HEADERS:{..._optionalChain([e, 'access', _14 => _14.clientConfig, 'optionalAccess', _15 => _15.HEADERS]),..._optionalChain([e, 'access', _16 => _16.fullnodeConfig, 'optionalAccess', _17 => _17.HEADERS])}}})}async function nn(n){let{endlessConfig:e}=n;return Kr({...n,type:"Indexer",overrides:{...e.clientConfig,...e.indexerConfig,HEADERS:{..._optionalChain([e, 'access', _18 => _18.clientConfig, 'optionalAccess', _19 => _19.HEADERS]),..._optionalChain([e, 'access', _20 => _20.indexerConfig, 'optionalAccess', _21 => _21.HEADERS])}}})}async function Pt(n){let e=[],t,r=n.params;do{let s=await Kr({type:"Fullnode",endlessConfig:n.endlessConfig,originMethod:n.originMethod,path:n.path,params:r,overrides:n.overrides});t=s.headers["x-endless-cursor"],delete s.headers,e.push(...s.data),r.start=t}while(t!=null);return e}async function rn(n){let{type:e,originMethod:t,path:r,body:s,acceptType:i,contentType:o,params:a,endlessConfig:c,overrides:d}=n,g=c.getRequestUrl(e);return Nn({url:g,method:"POST",originMethod:t,path:r,body:s,contentType:o,acceptType:i,params:a,overrides:d},c,n.type)}async function Le(n){let{endlessConfig:e}=n;return rn({...n,type:"Fullnode",overrides:{...e.clientConfig,...e.fullnodeConfig,...n.overrides,HEADERS:{..._optionalChain([e, 'access', _22 => _22.clientConfig, 'optionalAccess', _23 => _23.HEADERS]),..._optionalChain([e, 'access', _24 => _24.fullnodeConfig, 'optionalAccess', _25 => _25.HEADERS])}}})}async function It(n){let{endlessConfig:e}=n;return rn({...n,type:"Indexer",overrides:{...e.clientConfig,...e.indexerConfig,...n.overrides,HEADERS:{..._optionalChain([e, 'access', _26 => _26.clientConfig, 'optionalAccess', _27 => _27.HEADERS]),..._optionalChain([e, 'access', _28 => _28.indexerConfig, 'optionalAccess', _29 => _29.HEADERS])}}})}async function Jl(n){let{endlessConfig:e}=n,t={...e,clientConfig:{...e.clientConfig}};return  _optionalChainDelete([t, 'optionalAccess', _30 => _30.clientConfig, 'optionalAccess', _31 => delete _31.API_KEY]),rn({...n,type:"Faucet",overrides:{...t.clientConfig,...n.overrides,HEADERS:{..._optionalChain([t, 'access', _32 => _32.clientConfig, 'optionalAccess', _33 => _33.HEADERS])}}})}async function Qa(n){return rn({...n,type:"Pepper"})}async function $s(n){return rn({...n,type:"Prover"})}var Br=new Map;function $e(n,e,t){return async(...r)=>{if(Br.has(e)){let{value:i,timestamp:o}=Br.get(e);if(t===void 0||Date.now()-o<=t)return i}let s=await n(...r);return Br.set(e,{value:s,timestamp:Date.now()}),s}}var Cp=1e7,Xa= exports.MAX_AUD_VAL_BYTES =120,Ya= exports.MAX_UID_KEY_BYTES =30,Za= exports.MAX_UID_VAL_BYTES =330,Pp= exports.MAX_ISS_VAL_BYTES =120,Ip= exports.MAX_EXTRA_FIELD_BYTES =350,Up= exports.MAX_JWT_HEADER_B64_BYTES =300,Rp= exports.MAX_COMMITED_EPK_BYTES =93,be=class be extends ${constructor(e,t){super();let r=p.fromHexInput(t).toUint8Array();if(r.length!==be.ID_COMMITMENT_LENGTH)throw new Error(`Id Commitment length in bytes should be ${be.ID_COMMITMENT_LENGTH}`);this.iss=e,this.idCommitment=r}authKey(){let e=new F;return e.serializeU32AsUleb128(3),e.serializeFixedBytes(this.bcsToBytes()),G.fromSchemeAndBytes({scheme:2,input:e.toUint8Array()})}toUint8Array(){return this.bcsToBytes()}toString(){return p.fromHexInput(this.toUint8Array()).toString()}verifySignature(e){throw new Error("Not yet implemented")}serialize(e){e.serializeStr(this.iss),e.serializeBytes(this.idCommitment)}static deserialize(e){let t=e.deserializeStr(),r=e.deserializeBytes();return new be(t,r)}static load(e){let t=e.deserializeStr(),r=e.deserializeBytes();return new be(t,r)}static isPublicKey(e){return e instanceof be}static create(e){return Vs(e),new be(e.iss,Vs(e))}static fromJwtAndPepper(e){let{jwt:t,pepper:r,uidKey:s="sub"}=e,i=_jwtdecode.jwtDecode.call(void 0, t),o=i.iss;if(typeof i.aud!="string")throw new Error("aud was not found or an array of values");let a=i.aud,c=i[s];return be.create({iss:o,uidKey:s,uidVal:c,aud:a,pepper:r})}static isInstance(e){return"iss"in e&&typeof e.iss=="string"&&"idCommitment"in e&&e.idCommitment instanceof Uint8Array}};be.ID_COMMITMENT_LENGTH=32;var de=be;function Vs(n){let{uidKey:e,uidVal:t,aud:r,pepper:s}=n,i=[Jt(p.fromHexInput(s).toUint8Array()),kn(r,Xa),kn(t,Za),kn(e,Ya)];return zs(en(i),de.ID_COMMITMENT_LENGTH)}var ze=class n extends z{constructor(e){super();let{jwtHeader:t,ephemeralCertificate:r,expiryDateSecs:s,ephemeralPublicKey:i,ephemeralSignature:o}=e;this.jwtHeader=t,this.ephemeralCertificate=r,this.expiryDateSecs=s,this.ephemeralPublicKey=i,this.ephemeralSignature=o}toUint8Array(){return this.bcsToBytes()}serialize(e){this.ephemeralCertificate.serialize(e),e.serializeStr(this.jwtHeader),e.serializeU64(this.expiryDateSecs),this.ephemeralPublicKey.serialize(e),this.ephemeralSignature.serialize(e)}static deserialize(e){let t=Ut.deserialize(e),r=e.deserializeStr(),s=e.deserializeU64(),i=lt.deserialize(e),o=ue.deserialize(e);return new n({jwtHeader:r,expiryDateSecs:Number(s),ephemeralCertificate:t,ephemeralPublicKey:i,ephemeralSignature:o})}static getSimulationSignature(){return new n({jwtHeader:"{}",ephemeralCertificate:new Ut(new Ke({proof:new Rt({a:new Uint8Array(32),b:new Uint8Array(64),c:new Uint8Array(32)}),nonMalleabilitySignature:new ue(new _(new Uint8Array(64))),expHorizonSecs:0}),0),expiryDateSecs:0,ephemeralPublicKey:new lt(new E(new Uint8Array(32))),ephemeralSignature:new ue(new _(new Uint8Array(64)))})}static isSignature(e){return e instanceof n}},Ut= exports.EphemeralCertificate =class n extends z{constructor(e,t){super(),this.signature=e,this.variant=t}toUint8Array(){return this.signature.toUint8Array()}serialize(e){e.serializeU32AsUleb128(this.variant),this.signature.serialize(e)}static deserialize(e){let t=e.deserializeUleb128AsU32();switch(t){case 0:return new n(Ke.deserialize(e),t);default:throw new Error(`Unknown variant index for EphemeralCertificate: ${t}`)}}},Re=class n extends l{constructor(e){if(super(),this.data=p.fromHexInput(e).toUint8Array(),this.data.length!==32)throw new Error("Input needs to be 32 bytes")}serialize(e){e.serializeFixedBytes(this.data)}static deserialize(e){let t=e.deserializeFixedBytes(32);return new n(t)}},gt=class n extends l{constructor(e){if(super(),this.data=p.fromHexInput(e).toUint8Array(),this.data.length!==64)throw new Error("Input needs to be 64 bytes")}serialize(e){e.serializeFixedBytes(this.data)}static deserialize(e){let t=e.deserializeFixedBytes(64);return new n(t)}},Rt= exports.Groth16Zkp =class n extends Gn{constructor(e){super();let{a:t,b:r,c:s}=e;this.a=new Re(t),this.b=new gt(r),this.c=new Re(s)}serialize(e){this.a.serialize(e),this.b.serialize(e),this.c.serialize(e)}static deserialize(e){let t=Re.deserialize(e).bcsToBytes(),r=gt.deserialize(e).bcsToBytes(),s=Re.deserialize(e).bcsToBytes();return new n({a:t,b:r,c:s})}hash(){let e=_sha3.sha3_256.create();e.update("ENDLESS::Groth16Zkp");let t=e.digest(),r=this.bcsToBytes(),s=new Uint8Array(t.length+r.length);return s.set(t),s.set(r,t.length),s}},Ke= exports.ZeroKnowledgeSig =class n extends z{constructor(e){super();let{proof:t,expHorizonSecs:r,trainingWheelsSignature:s,extraField:i,overrideAudVal:o}=e;this.proof=t,this.nonMalleabilitySignature=e.nonMalleabilitySignature,this.expHorizonSecs=r,this.trainingWheelsSignature=s,this.extraField=i,this.overrideAudVal=o}toUint8Array(){return this.bcsToBytes()}static fromBytes(e){return n.deserialize(new re(e))}serialize(e){this.proof.serialize(e),this.nonMalleabilitySignature.serialize(e),e.serializeU64(this.expHorizonSecs),e.serializeOptionStr(this.extraField),e.serializeOptionStr(this.overrideAudVal),e.serializeOption(this.trainingWheelsSignature)}static deserialize(e){let t=Rt.deserialize(e),r=ue.deserialize(e),s=Number(e.deserializeU64()),i=e.deserializeOptionStr(),o=e.deserializeOptionStr(),a=e.deserializeOption(ue);return new n({proof:t,nonMalleabilitySignature:r,expHorizonSecs:s,trainingWheelsSignature:a,extraField:i,overrideAudVal:o})}},Dr= exports.KeylessConfiguration =class n{constructor(e,t){this.verficationKey=e,this.maxExpHorizonSecs=t}static create(e,t){return new n(new kr({alphaG1:e.alpha_g1,betaG2:e.beta_g2,deltaG2:e.delta_g2,gammaAbcG1:e.gamma_abc_g1,gammaG2:e.gamma_g2}),t)}},kr=class n{constructor(e){let{alphaG1:t,betaG2:r,deltaG2:s,gammaAbcG1:i,gammaG2:o}=e;this.alphaG1=new Re(t),this.betaG2=new gt(r),this.deltaG2=new gt(s),this.gammaAbcG1=[new Re(i[0]),new Re(i[1])],this.gammaG2=new gt(o)}static fromGroth16VerificationKeyResponse(e){return new n({alphaG1:e.alpha_g1,betaG2:e.beta_g2,deltaG2:e.delta_g2,gammaAbcG1:e.gamma_abc_g1,gammaG2:e.gamma_g2})}};async function Qs(n){let{endlessConfig:e}=n;return $e(async()=>{let t=await Ja(n),r=await ec(n);return Dr.create(r,Number(t.max_exp_horizon_secs))},`keyless-configuration-${e.network}`,1e3*60*5)()}async function Ja(n){let{endlessConfig:e,options:t}=n,r="0x1::openid_account::Configuration",{data:s}=await V({endlessConfig:e,originMethod:"getKeylessConfigurationResource",path:`accounts/${u.from("0x1").toString()}/resource/${r}`,params:{ledger_version:_optionalChain([t, 'optionalAccess', _34 => _34.ledgerVersion])}});return s.data}async function ec(n){let{endlessConfig:e,options:t}=n,r="0x1::openid_account::Groth16VerificationKey",{data:s}=await V({endlessConfig:e,originMethod:"getGroth16VerificationKeyResource",path:`accounts/${u.from("0x1").toString()}/resource/${r}`,params:{ledger_version:_optionalChain([t, 'optionalAccess', _35 => _35.ledgerVersion])}});return s.data}var _secp256k1 = require('@noble/curves/secp256k1');var _bip32 = require('@scure/bip32');var mt=class mt extends ct{constructor(e){super();let t=p.fromHexInput(e);if(t.toUint8Array().length!==mt.LENGTH)throw new Error(`PublicKey length should be ${mt.LENGTH}`);this.key=t}verifySignature(e){let{message:t,signature:r}=e;if(!(r instanceof De))return!1;let s=Ue(t),i=p.fromHexInput(s).toUint8Array(),o=_sha3.sha3_256.call(void 0, i),a=r.toUint8Array();return _secp256k1.secp256k1.verify(a,o,this.key.toUint8Array(),{lowS:!0})}toUint8Array(){return this.key.toUint8Array()}serialize(e){e.serializeBytes(this.key.toUint8Array())}static deserialize(e){let t=e.deserializeBytes();return new mt(t)}static isPublicKey(e){return e instanceof mt}};mt.LENGTH=65;var Be=mt,Te=class Te extends l{constructor(e){super();let t=p.fromHexInput(e);if(t.toUint8Array().length!==Te.LENGTH)throw new Error(`PrivateKey length should be ${Te.LENGTH}`);this.key=t}static generate(){let e=_secp256k1.secp256k1.utils.randomPrivateKey();return new Te(e)}static fromDerivationPath(e,t){if(!Es(e))throw new Error(`Invalid derivation path ${e}`);return Te.fromDerivationPathInner(e,Bn(t))}static fromDerivationPathInner(e,t){let{privateKey:r}=_bip32.HDKey.fromMasterSeed(t).derive(e);if(r===null)throw new Error("Invalid key");return new Te(r)}sign(e){let t=Ue(e),r=p.fromHexInput(t),s=_sha3.sha3_256.call(void 0, r.toUint8Array()),i=_secp256k1.secp256k1.sign(s,this.key.toUint8Array(),{lowS:!0});return new De(i.toCompactRawBytes())}publicKey(){let e=_secp256k1.secp256k1.getPublicKey(this.key.toUint8Array(),!1);return new Be(e)}toUint8Array(){return this.key.toUint8Array()}toString(){return this.key.toString()}serialize(e){e.serializeBytes(this.toUint8Array())}static deserialize(e){let t=e.deserializeBytes();return new Te(t)}static isPrivateKey(e){return e instanceof Te}};Te.LENGTH=32;var yt=Te,zt=class zt extends z{constructor(e){super();let t=p.fromHexInput(e);if(t.toUint8Array().length!==zt.LENGTH)throw new Error(`Signature length should be ${zt.LENGTH}, received ${t.toUint8Array().length}`);this.data=t}toUint8Array(){return this.data.toUint8Array()}serialize(e){e.serializeBytes(this.data.toUint8Array())}static deserialize(e){let t=e.deserializeBytes();return new zt(t)}};zt.LENGTH=64;var De=zt;var I=class n extends ${constructor(e){if(super(),this.publicKey=e,e instanceof E)this.variant=0;else if(e instanceof Be)this.variant=1;else if(e instanceof de)this.variant=3;else throw new Error("Unsupported public key type")}verifySignature(e){let{message:t,signature:r}=e;return r instanceof K?this.publicKey.verifySignature({message:t,signature:r.signature}):!1}authKey(){return G.fromSchemeAndBytes({scheme:2,input:this.toUint8Array()})}toUint8Array(){return this.bcsToBytes()}serialize(e){e.serializeU32AsUleb128(this.variant),this.publicKey.serialize(e)}static deserialize(e){let t=e.deserializeUleb128AsU32(),r;switch(t){case 0:r=E.deserialize(e);break;case 1:r=Be.deserialize(e);break;case 3:r=de.deserialize(e);break;default:throw new Error(`Unknown variant index for AnyPublicKey: ${t}`)}return new n(r)}static isPublicKey(e){return e instanceof n}isEd25519(){return this.publicKey instanceof E}isSecp256k1PublicKey(){return this.publicKey instanceof Be}},K= exports.AnySignature =class n extends z{constructor(e){if(super(),this.signature=e,e instanceof _)this.variant=0;else if(e instanceof De)this.variant=1;else if(e instanceof ze)this.variant=3;else throw new Error("Unsupported signature type")}toUint8Array(){return this.bcsToBytes()}serialize(e){e.serializeU32AsUleb128(this.variant),this.signature.serialize(e)}static deserialize(e){let t=e.deserializeUleb128AsU32(),r;switch(t){case 0:r=_.deserialize(e);break;case 1:r=De.deserialize(e);break;case 3:r=ze.deserialize(e);break;default:throw new Error(`Unknown variant index for AnySignature: ${t}`)}return new n(r)}};function nc(n){let e=n;return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>24}var Kt=class n extends ${constructor(e){super();let{publicKeys:t,signaturesRequired:r}=e;if(r<1)throw new Error("The number of required signatures needs to be greater than 0");if(t.length<r)throw new Error(`Provided ${t.length} public keys is smaller than the ${r} required signatures`);this.publicKeys=t.map(s=>s instanceof I?s:new I(s)),this.signaturesRequired=r}verifySignature(e){throw new Error("not implemented")}authKey(){return G.fromSchemeAndBytes({scheme:3,input:this.toUint8Array()})}toUint8Array(){return this.bcsToBytes()}serialize(e){e.serializeVector(this.publicKeys),e.serializeU8(this.signaturesRequired)}static deserialize(e){let t=e.deserializeVector(I),r=e.deserializeU8();return new n({publicKeys:t,signaturesRequired:r})}createBitmap(e){let{bits:t}=e,r=128,s=new Uint8Array([0,0,0,0]),i=new Set;return t.forEach((o,a)=>{if(a+1>this.publicKeys.length)throw new Error(`Signature index ${a+1} is out of public keys range, ${this.publicKeys.length}.`);if(i.has(o))throw new Error(`Duplicate bit ${o} detected.`);i.add(o);let c=Math.floor(o/8),d=s[c];d|=r>>o%8,s[c]=d}),s}getIndex(e){let t=e instanceof I?e:new I(e),r=this.publicKeys.findIndex(s=>s.toString()===t.toString());if(r!==-1)return r;throw new Error("Public key not found in MultiKey")}},Z=class Z extends z{constructor(e){super();let{signatures:t,bitmap:r}=e;if(t.length>Z.MAX_SIGNATURES_SUPPORTED)throw new Error(`The number of signatures cannot be greater than ${Z.MAX_SIGNATURES_SUPPORTED}`);if(this.signatures=t.map(i=>i instanceof K?i:new K(i)),!(r instanceof Uint8Array))this.bitmap=Z.createBitmap({bits:r});else{if(r.length!==Z.BITMAP_LEN)throw new Error(`"bitmap" length should be ${Z.BITMAP_LEN}`);this.bitmap=r}let s=this.bitmap.reduce((i,o)=>i+nc(o),0);if(s!==this.signatures.length)throw new Error(`Expecting ${s} signatures from the bitmap, but got ${this.signatures.length}`)}static createBitmap(e){let{bits:t}=e,r=128,s=new Uint8Array([0,0,0,0]),i=new Set;return t.forEach(o=>{if(o>=Z.MAX_SIGNATURES_SUPPORTED)throw new Error(`Cannot have a signature larger than ${Z.MAX_SIGNATURES_SUPPORTED-1}.`);if(i.has(o))throw new Error("Duplicate bits detected.");i.add(o);let a=Math.floor(o/8),c=s[a];c|=r>>o%8,s[a]=c}),s}toUint8Array(){return this.bcsToBytes()}serialize(e){e.serializeVector(this.signatures),e.serializeBytes(this.bitmap)}static deserialize(e){let t=e.deserializeVector(K),r=e.deserializeBytes();return new Z({signatures:t,bitmap:r})}};Z.BITMAP_LEN=4,Z.MAX_SIGNATURES_SUPPORTED=Z.BITMAP_LEN*8;var ft=Z;var _bls12381 = require('@noble/curves/bls12-381');var At=class At extends ${constructor(e){super();let t=p.fromHexInput(e);if(t.toUint8Array().length!==At.LENGTH)throw new Error(`PublicKey length should be ${At.LENGTH}`);this.key=t}verifySignature(e){let{message:t,signature:r}=e;if(!(r instanceof Dt))return!1;let s=Ue(t),i=p.fromHexInput(s).toUint8Array(),o=r.toUint8Array(),a=this.key.toUint8Array();return _bls12381.bls12_381.verify(o,i,a)}authKey(){return G.fromSchemeAndBytes({scheme:5,input:this.toUint8Array()})}toUint8Array(){return this.key.toUint8Array()}serialize(e){e.serializeBytes(this.key.toUint8Array())}static deserialize(e){let t=e.deserializeBytes();return new At(t)}static isPublicKey(e){return e instanceof At}};At.LENGTH=48;var sn=At,Ve=class Ve extends l{constructor(e){super();let t=p.fromHexInput(e);if(t.toUint8Array().length!==Ve.LENGTH)throw new Error(`PrivateKey length should be ${Ve.LENGTH}`);this.signingKey=t}static generate(){let e=_bls12381.bls12_381.utils.randomPrivateKey();return new Ve(e)}publicKey(){let e=_bls12381.bls12_381.getPublicKey(this.signingKey.toUint8Array());return new sn(e)}sign(e){let t=Ue(e),r=p.fromHexInput(t).toUint8Array(),s=_bls12381.bls12_381.sign(r,this.signingKey.toUint8Array());return new Dt(s)}toUint8Array(){return this.signingKey.toUint8Array()}toString(){return this.signingKey.toString()}serialize(e){e.serializeBytes(this.toUint8Array())}static deserialize(e){let t=e.deserializeBytes();return new Ve(t)}static isPrivateKey(e){return e instanceof Ve}};Ve.LENGTH=32;var js=Ve,Bt=class Bt extends z{constructor(e){super();let t=p.fromHexInput(e);if(t.toUint8Array().length!==Bt.LENGTH)throw new Error(`Signature length should be ${Bt.LENGTH}`);this.data=t}toUint8Array(){return this.data.toUint8Array()}serialize(e){e.serializeBytes(this.data.toUint8Array())}static deserialize(e){let t=e.deserializeBytes();return new Bt(t)}};Bt.LENGTH=96;var Dt=Bt;var Qe=class n extends ${constructor(e){super();let{publicKeys:t}=e;this.publicKeys=t.map(r=>r instanceof I?r:new I(r))}verifySignature(e){throw new Error("not implemented")}authKey(){throw new Error("not implemented")}toUint8Array(){return this.bcsToBytes()}serialize(e){e.serializeVector(this.publicKeys)}static deserialize(e){let t=e.deserializeVector(I);return new n({publicKeys:t})}},ke= exports.MultiAuthKeySignature =class n extends z{constructor(e){super();let{signatures:t}=e;this.signatures=t.map(r=>r instanceof K?r:new K(r))}toUint8Array(){return this.bcsToBytes()}serialize(e){e.serializeVector(this.signatures)}static deserialize(e){let t=e.deserializeVector(K);return new n({signatures:t})}};var N=class extends l{static deserialize(e){let t=e.deserializeUleb128AsU32();switch(t){case 0:return fe.load(e);case 1:return Fn.load(e);case 2:return j.load(e);case 3:return ht.load(e);case 4:return Ge.load(e);case 5:return Gr.load(e);case 6:return We.load(e);default:throw new Error(`Unknown variant index for AccountAuthenticator: ${t}`)}}isEd25519(){return this instanceof fe}isMultiEd25519(){return this instanceof Fn}isSingleKey(){return this instanceof j}isMultiKey(){return this instanceof ht}isMultAuthKey(){return this instanceof Ge}},fe= exports.AccountAuthenticatorEd25519 =class n extends N{constructor(e,t){super(),this.public_key=e,this.signature=t}serialize(e){e.serializeU32AsUleb128(0),this.public_key.serialize(e),this.signature.serialize(e)}static load(e){let t=E.deserialize(e),r=_.deserialize(e);return new n(t,r)}},Fn= exports.AccountAuthenticatorMultiEd25519 =class n extends N{constructor(e,t){super(),this.public_key=e,this.signature=t}serialize(e){e.serializeU32AsUleb128(1),this.public_key.serialize(e),this.signature.serialize(e)}static load(e){let t=Ct.deserialize(e),r=dt.deserialize(e);return new n(t,r)}},j= exports.AccountAuthenticatorSingleKey =class n extends N{constructor(e,t){super(),this.public_key=e,this.signature=t}serialize(e){e.serializeU32AsUleb128(2),this.public_key.serialize(e),this.signature.serialize(e)}static load(e){let t=I.deserialize(e),r=K.deserialize(e);return new n(t,r)}},ht= exports.AccountAuthenticatorMultiKey =class n extends N{constructor(e,t){super(),this.public_keys=e,this.signatures=t}serialize(e){e.serializeU32AsUleb128(3),this.public_keys.serialize(e),this.signatures.serialize(e)}static load(e){let t=Kt.deserialize(e),r=ft.deserialize(e);return new n(t,r)}},Ge= exports.AccountAuthenticatorMultiAuthKey =class n extends N{constructor(e,t){super(),this.public_key=e,this.signature=t}serialize(e){e.serializeU32AsUleb128(4),this.public_key.serialize(e),this.signature.serialize(e)}static load(e){let t=Qe.deserialize(e),r=ke.deserialize(e);return new n(t,r)}},Gr= exports.AccountAuthenticatorBls12381 =class n extends N{constructor(e,t){super(),this.public_key=e,this.signature=t}serialize(e){e.serializeU32AsUleb128(5),this.public_key.serialize(e),this.signature.serialize(e)}static load(e){let t=sn.deserialize(e),r=Dt.deserialize(e);return new n(t,r)}},We= exports.AccountAuthenticatorMock =class n extends N{constructor(e){super(),this.authenticator=e}serialize(e){e.serializeU32AsUleb128(6),this.authenticator.serialize(e)}static load(e){let t=u.deserialize(e);return new n(t)}};var kt=class n extends l{constructor(e){super(),this.chainId=e}serialize(e){e.serializeU8(this.chainId)}static deserialize(e){let t=e.deserializeU8();return new n(t)}};var B=class n extends l{constructor(e){super(),this.identifier=e}serialize(e){e.serializeStr(this.identifier)}static deserialize(e){let t=e.deserializeStr();return new n(t)}};var on=class n extends l{constructor(e,t){super(),this.address=e,this.name=t}static fromStr(e){let t=e.split("::");if(t.length!==2)throw new Error("Invalid module id.");return new n(u.fromString(t[0]),new B(t[1]))}serialize(e){this.address.serialize(e),this.name.serialize(e)}static deserialize(e){let t=u.deserialize(e),r=B.deserialize(e);return new n(t,r)}};var D=class extends l{static deserialize(e){let t=e.deserializeUleb128AsU32();switch(t){case 0:return Q.load(e);case 1:return we.load(e);case 2:return Se.load(e);case 3:return J.load(e);case 4:return M.load(e);case 5:return Ot.load(e);case 6:return C.load(e);case 7:return y.load(e);case 8:return Gt.load(e);case 9:return Nt.load(e);case 10:return Mt.load(e);case 255:return k.load(e);default:throw new Error(`Unknown variant index for TypeTag: ${t}`)}}isBool(){return this instanceof Q}isAddress(){return this instanceof M}isGeneric(){return this instanceof k}isSigner(){return this instanceof Ot}isVector(){return this instanceof C}isStruct(){return this instanceof y}isU8(){return this instanceof we}isU16(){return this instanceof Gt}isU32(){return this instanceof Nt}isU64(){return this instanceof Se}isU128(){return this instanceof J}isU256(){return this instanceof Mt}},Q= exports.TypeTagBool =class n extends D{toString(){return"bool"}serialize(e){e.serializeU32AsUleb128(0)}static load(e){return new n}},we= exports.TypeTagU8 =class n extends D{toString(){return"u8"}serialize(e){e.serializeU32AsUleb128(1)}static load(e){return new n}},Gt= exports.TypeTagU16 =class n extends D{toString(){return"u16"}serialize(e){e.serializeU32AsUleb128(8)}static load(e){return new n}},Nt= exports.TypeTagU32 =class n extends D{toString(){return"u32"}serialize(e){e.serializeU32AsUleb128(9)}static load(e){return new n}},Se= exports.TypeTagU64 =class n extends D{toString(){return"u64"}serialize(e){e.serializeU32AsUleb128(2)}static load(e){return new n}},J= exports.TypeTagU128 =class n extends D{toString(){return"u128"}serialize(e){e.serializeU32AsUleb128(3)}static load(e){return new n}},Mt= exports.TypeTagU256 =class n extends D{toString(){return"u256"}serialize(e){e.serializeU32AsUleb128(10)}static load(e){return new n}},M= exports.TypeTagAddress =class n extends D{toString(){return"address"}serialize(e){e.serializeU32AsUleb128(4)}static load(e){return new n}},Ot= exports.TypeTagSigner =class n extends D{toString(){return"signer"}serialize(e){e.serializeU32AsUleb128(5)}static load(e){return new n}},qn= exports.TypeTagReference =class n extends D{constructor(t){super();this.value=t}toString(){return`&${this.value.toString()}`}serialize(t){t.serializeU32AsUleb128(254)}static load(t){let r=D.deserialize(t);return new n(r)}},k= exports.TypeTagGeneric =class n extends D{constructor(t){super();this.value=t;if(t<0)throw new Error("Generic type parameter index cannot be negative")}toString(){return`T${this.value}`}serialize(t){t.serializeU32AsUleb128(255),t.serializeU32(this.value)}static load(t){let r=t.deserializeU32();return new n(r)}},C= exports.TypeTagVector =class n extends D{constructor(t){super();this.value=t}toString(){return`vector<${this.value.toString()}>`}static u8(){return new n(new we)}serialize(t){t.serializeU32AsUleb128(6),this.value.serialize(t)}static load(t){let r=D.deserialize(t);return new n(r)}},y= exports.TypeTagStruct =class n extends D{constructor(t){super();this.value=t}toString(){let t="";return this.value.typeArgs.length>0&&(t=`<${this.value.typeArgs.map(r=>r.toString()).join(", ")}>`),`${this.value.address.toString()}::${this.value.moduleName.identifier}::${this.value.name.identifier}${t}`}serialize(t){t.serializeU32AsUleb128(7),this.value.serialize(t)}static load(t){let r=Ne.deserialize(t);return new n(r)}isTypeTag(t,r,s){return this.value.moduleName.identifier===r&&this.value.name.identifier===s&&this.value.address.equals(t)}isString(){return this.isTypeTag(u.ONE,"string","String")}isOption(){return this.isTypeTag(u.ONE,"option","Option")}isObject(){return this.isTypeTag(u.ONE,"object","Object")}},Ne= exports.StructTag =class n extends l{constructor(e,t,r,s){super(),this.address=e,this.moduleName=t,this.name=r,this.typeArgs=s}serialize(e){e.serialize(this.address),e.serialize(this.moduleName),e.serialize(this.name),e.serializeVector(this.typeArgs)}static deserialize(e){let t=u.deserialize(e),r=B.deserialize(e),s=B.deserialize(e),i=e.deserializeVector(D);return new n(t,r,s,i)}};function Sm(){return new Ne(u.ONE,new B("endless_coin"),new B("EndlessCoin"),[])}function v(){return new Ne(u.ONE,new B("string"),new B("String"),[])}function xm(n){return new Ne(u.ONE,new B("option"),new B("Option"),[n])}function ee(n){return new Ne(u.ONE,new B("object"),new B("Object"),[n])}function rc(n){let e=n.deserializeUleb128AsU32();switch(e){case 0:return q.deserialize(n);case 1:return H.deserialize(n);case 2:return me.deserialize(n);case 3:return u.deserialize(n);case 4:return b.deserialize(n,q);case 5:return U.deserialize(n);case 6:return ie.deserialize(n);case 7:return oe.deserialize(n);case 8:return ye.deserialize(n);default:throw new Error(`Unknown variant index for ScriptTransactionArgument: ${e}`)}}var bt=class extends l{static deserialize(e){let t=e.deserializeUleb128AsU32();switch(t){case 0:return xe.load(e);case 2:return _e.load(e);case 3:return an.load(e);case 4:return xe.loadWithChecksum(e);case 5:return _e.loadWithChecksum(e);default:throw new Error(`Unknown variant index for TransactionPayload: ${t}`)}}},xe= exports.TransactionPayloadScript =class n extends bt{constructor(e){super(),this.script=e}serialize(e){if(this.paymentChecksum){e.serializeU32AsUleb128(4),this.script.serialize(e),e.serializeFixedBytes(this.paymentChecksum);return}e.serializeU32AsUleb128(0),this.script.serialize(e)}static load(e){let t=Ft.deserialize(e);return new n(t)}static loadWithChecksum(e){let t=Ft.deserialize(e),r=e.deserializeFixedBytes(32),s=new n(t);return s.paymentChecksum=r,s}},_e= exports.TransactionPayloadEntryFunction =class n extends bt{constructor(e){super(),this.entryFunction=e}serialize(e){if(this.paymentChecksum){e.serializeU32AsUleb128(5),this.entryFunction.serialize(e),e.serializeFixedBytes(this.paymentChecksum);return}e.serializeU32AsUleb128(2),this.entryFunction.serialize(e)}static load(e){let t=je.deserialize(e);return new n(t)}static loadWithChecksum(e){let t=je.deserialize(e),r=e.deserializeFixedBytes(32),s=new n(t);return s.paymentChecksum=r,s}},an= exports.TransactionPayloadMultiSig =class n extends bt{constructor(e){super(),this.multiSig=e}serialize(e){e.serializeU32AsUleb128(3),this.multiSig.serialize(e)}static load(e){let t=cn.deserialize(e);return new n(t)}},je= exports.EntryFunction =class n{constructor(e,t,r,s){this.module_name=e,this.function_name=t,this.type_args=r,this.args=s}static build(e,t,r,s){return new n(on.fromStr(e),new B(t),r,s)}serialize(e){this.module_name.serialize(e),this.function_name.serialize(e),e.serializeVector(this.type_args),e.serializeU32AsUleb128(this.args.length),this.args.forEach(t=>{t.serializeForEntryFunction(e)})}static deserialize(e){let t=on.deserialize(e),r=B.deserialize(e),s=e.deserializeVector(D),i=e.deserializeUleb128AsU32(),o=new Array;for(let a=0;a<i;a+=1){let c=e.deserializeUleb128AsU32(),d=Rn.deserialize(e,c);o.push(d)}return new n(t,r,s,o)}},Ft= exports.Script =class n{constructor(e,t,r){this.bytecode=e,this.type_args=t,this.args=r}serialize(e){e.serializeBytes(this.bytecode),e.serializeVector(this.type_args),e.serializeU32AsUleb128(this.args.length),this.args.forEach(t=>{t.serializeForScriptFunction(e)})}static deserialize(e){let t=e.deserializeBytes(),r=e.deserializeVector(D),s=e.deserializeUleb128AsU32(),i=new Array;for(let o=0;o<s;o+=1){let a=rc(e);i.push(a)}return new n(t,r,i)}},cn= exports.MultiSig =class n{constructor(e,t){this.multisig_address=e,this.transaction_payload=t}serialize(e){this.multisig_address.serialize(e),this.transaction_payload===void 0?e.serializeBool(!1):(e.serializeBool(!0),this.transaction_payload.serialize(e))}static deserialize(e){let t=u.deserialize(e),r=e.deserializeBool(),s;return r&&(s=un.deserialize(e)),new n(t,s)}},un= exports.MultiSigTransactionPayload =class n extends l{constructor(e){super(),this.transaction_payload=e}serialize(e){e.serializeU32AsUleb128(0),this.transaction_payload.serialize(e)}static deserialize(e){return e.deserializeUleb128AsU32(),new n(je.deserialize(e))}};var le=class n extends l{constructor(e,t,r,s,i,o,a){super(),this.sender=e,this.sequence_number=t,this.payload=r,this.max_gas_amount=s,this.gas_unit_price=i,this.expiration_timestamp_secs=o,this.chain_id=a}serialize(e){this.sender.serialize(e),e.serializeU64(this.sequence_number),this.payload.serialize(e),e.serializeU64(this.max_gas_amount),e.serializeU64(this.gas_unit_price),e.serializeU64(this.expiration_timestamp_secs),this.chain_id.serialize(e)}static deserialize(e){let t=u.deserialize(e),r=e.deserializeU64(),s=bt.deserialize(e),i=e.deserializeU64(),o=e.deserializeU64(),a=e.deserializeU64(),c=kt.deserialize(e);return new n(t,r,s,i,o,a,c)}},Hn= exports.RawTransactionWithData =class extends l{static deserialize(e){let t=e.deserializeUleb128AsU32();switch(t){case 0:return Xe.load(e);case 1:return Ye.load(e);default:throw new Error(`Unknown variant index for RawTransactionWithData: ${t}`)}}},Xe= exports.MultiAgentRawTransaction =class n extends Hn{constructor(e,t){super(),this.raw_txn=e,this.secondary_signer_addresses=t}serialize(e){e.serializeU32AsUleb128(0),this.raw_txn.serialize(e),e.serializeVector(this.secondary_signer_addresses)}static load(e){let t=le.deserialize(e),r=e.deserializeVector(u);return new n(t,r)}},Ye= exports.FeePayerRawTransaction =class n extends Hn{constructor(e,t,r){super(),this.raw_txn=e,this.secondary_signer_addresses=t,this.fee_payer_address=r}serialize(e){e.serializeU32AsUleb128(1),this.raw_txn.serialize(e),e.serializeVector(this.secondary_signer_addresses),this.fee_payer_address.serialize(e)}static load(e){let t=le.deserialize(e),r=e.deserializeVector(u),s=u.deserialize(e);return new n(t,r,s)}};var Ln=class extends l{constructor(t){super();this.accountAddress=u.ONE;this.moduleName=new x("account");this.structName=new x("RotationProofChallenge");this.sequenceNumber=new H(t.sequenceNumber),this.originator=t.originator,this.currentAuthKey=t.currentAuthKey,this.newPublicKey=b.U8(t.newPublicKey.toUint8Array())}serialize(t){t.serialize(this.accountAddress),t.serialize(this.moduleName),t.serialize(this.structName),t.serialize(this.sequenceNumber),t.serialize(this.originator),t.serialize(this.currentAuthKey),t.serialize(this.newPublicKey)}};var Me=class extends l{static deserialize(e){let t=e.deserializeUleb128AsU32();switch(t){case 0:return qt.load(e);case 1:return Nr.load(e);case 2:return Tt.load(e);case 3:return wt.load(e);case 4:return St.load(e);default:throw new Error(`Unknown variant index for TransactionAuthenticator: ${t}`)}}},qt= exports.TransactionAuthenticatorEd25519 =class n extends Me{constructor(e,t){super(),this.public_key=e,this.signature=t}serialize(e){e.serializeU32AsUleb128(0),this.public_key.serialize(e),this.signature.serialize(e)}static load(e){let t=E.deserialize(e),r=_.deserialize(e);return new n(t,r)}},Nr= exports.TransactionAuthenticatorMultiEd25519 =class n extends Me{constructor(e,t){super(),this.public_key=e,this.signature=t}serialize(e){e.serializeU32AsUleb128(1),this.public_key.serialize(e),this.signature.serialize(e)}static load(e){let t=Ct.deserialize(e),r=dt.deserialize(e);return new n(t,r)}},Tt= exports.TransactionAuthenticatorMultiAgent =class n extends Me{constructor(e,t,r){super(),this.sender=e,this.secondary_signer_addresses=t,this.secondary_signers=r}serialize(e){e.serializeU32AsUleb128(2),this.sender.serialize(e),e.serializeVector(this.secondary_signer_addresses),e.serializeVector(this.secondary_signers)}static load(e){let t=N.deserialize(e),r=e.deserializeVector(u),s=e.deserializeVector(N);return new n(t,r,s)}},wt= exports.TransactionAuthenticatorFeePayer =class n extends Me{constructor(e,t,r,s){super(),this.sender=e,this.secondary_signer_addresses=t,this.secondary_signers=r,this.fee_payer=s}serialize(e){e.serializeU32AsUleb128(3),this.sender.serialize(e),e.serializeVector(this.secondary_signer_addresses),e.serializeVector(this.secondary_signers),this.fee_payer.address.serialize(e),this.fee_payer.authenticator.serialize(e)}static load(e){let t=N.deserialize(e),r=e.deserializeVector(u),s=e.deserializeVector(N),i=u.deserialize(e),o=N.deserialize(e),a={address:i,authenticator:o};return new n(t,r,s,a)}},St= exports.TransactionAuthenticatorSingleSender =class n extends Me{constructor(e){super(),this.sender=e}serialize(e){e.serializeU32AsUleb128(4),this.sender.serialize(e)}static load(e){let t=N.deserialize(e);return new n(t)}};var Ee=class n extends l{constructor(e,t){super(),this.raw_txn=e,this.authenticator=t}serialize(e){this.raw_txn.serialize(e),this.authenticator.serialize(e)}static deserialize(e){let t=le.deserialize(e),r=Me.deserialize(e);return new n(t,r)}};var $n=class n extends l{constructor(e,t){super(),this.rawTransaction=e,this.feePayerAddress=t}serialize(e){this.rawTransaction.serialize(e),this.feePayerAddress===void 0?e.serializeBool(!1):(e.serializeBool(!0),this.feePayerAddress.serialize(e))}static deserialize(e){let t=le.deserialize(e),r=e.deserializeBool(),s;return r&&(s=u.deserialize(e)),new n(t,s)}upgradeToSafe(e){(this.rawTransaction.payload instanceof xe||this.rawTransaction.payload instanceof _e)&&(this.rawTransaction.payload.paymentChecksum=e)}};var Vn=class n extends l{constructor(e,t,r){super(),this.rawTransaction=e,this.feePayerAddress=r,this.secondarySignerAddresses=t}serialize(e){this.rawTransaction.serialize(e),e.serializeVector(this.secondarySignerAddresses),this.feePayerAddress===void 0?e.serializeBool(!1):(e.serializeBool(!0),this.feePayerAddress.serialize(e))}static deserialize(e){let t=le.deserialize(e),r=e.deserializeVector(u),s=e.deserializeBool(),i;return s&&(i=u.deserialize(e)),new n(t,r,i)}upgradeToSafe(e){(this.rawTransaction.payload instanceof xe||this.rawTransaction.payload instanceof _e)&&(this.rawTransaction.payload.paymentChecksum=e)}};function ic(n){return n.feePayerAddress?new Ye(n.rawTransaction,_nullishCoalesce(n.secondarySignerAddresses, () => ([])),n.feePayerAddress):n.secondarySignerAddresses?new Xe(n.rawTransaction,n.secondarySignerAddresses):n.rawTransaction}function Qn(n,e){let t=_sha3.sha3_256.create();if(!e.startsWith("ENDLESS::"))throw new Error(`Domain separator needs to start with 'ENDLESS::'.  Provided - ${e}`);t.update(e);let r=t.digest(),s=n,i=new Uint8Array(r.length+s.length);return i.set(r),i.set(s,r.length),i}function ky(n){return Qn(n.bcsToBytes(),`ENDLESS::${n.constructor.name}`)}function Ze(n){let e=ic(n);return n.feePayerAddress?Qn(e.bcsToBytes(),zr):n.secondarySignerAddresses?Qn(e.bcsToBytes(),zr):Qn(e.bcsToBytes(),qs)}var Ht=class n{constructor(e){this.signingScheme=0;let{privateKey:t,address:r}=e;this.privateKey=t,this.publicKey=t.publicKey(),this.accountAddress=r?u.from(r):this.publicKey.authKey().derivedAddress()}static generate(){let e=W.generate();return new n({privateKey:e})}static fromDerivationPath(e){let{path:t,mnemonic:r}=e,s=W.fromDerivationPath(t,r);return new n({privateKey:s})}verifySignature(e){return this.publicKey.verifySignature(e)}signWithAuthenticator(e){return new fe(this.publicKey,this.privateKey.sign(e))}signTransactionWithAuthenticator(e){return new fe(this.publicKey,this.signTransaction(e))}sign(e){return this.privateKey.sign(e)}signTransaction(e){return this.sign(Ze(e))}};var Lt=class n{constructor(e){this.signingScheme=2;let{privateKey:t,address:r}=e;this.privateKey=t,this.publicKey=new I(t.publicKey()),this.accountAddress=r?u.from(r):this.publicKey.authKey().derivedAddress()}static generate(e={}){let{scheme:t=0}=e,r;switch(t){case 0:r=W.generate();break;case 2:r=yt.generate();break;default:throw new Error(`Unsupported signature scheme ${t}`)}return new n({privateKey:r})}static fromDerivationPath(e){let{scheme:t=0,path:r,mnemonic:s}=e,i;switch(t){case 0:i=W.fromDerivationPath(r,s);break;case 2:i=yt.fromDerivationPath(r,s);break;default:throw new Error(`Unsupported signature scheme ${t}`)}return new n({privateKey:i})}verifySignature(e){return this.publicKey.verifySignature(e)}signWithAuthenticator(e){return new j(this.publicKey,this.sign(e))}signTransactionWithAuthenticator(e){return new j(this.publicKey,this.signTransaction(e))}sign(e){return new K(this.privateKey.sign(e))}signTransaction(e){return this.sign(Ze(e))}};var Je=class{static generate(e={}){let{scheme:t=0,legacy:r=!0}=e;return t===0&&r?Ht.generate():Lt.generate({scheme:t})}static fromPrivateKey(e){let{privateKey:t,address:r,legacy:s=!0}=e;return t instanceof W&&s?new Ht({privateKey:t,address:r}):new Lt({privateKey:t,address:r})}static fromPrivateKeyAndAddress(e){return this.fromPrivateKey(e)}static fromDerivationPath(e){let{scheme:t=0,mnemonic:r,path:s,legacy:i=!0}=e;return t===0&&i?Ht.fromDerivationPath({mnemonic:r,path:s}):Lt.fromDerivationPath({scheme:t,mnemonic:r,path:s})}static authKey(e){let{publicKey:t}=e;return t.authKey()}verifySignature(e){return this.publicKey.verifySignature(e)}};var _jsbase64 = require('js-base64');async function et(n){return new Promise(e=>{setTimeout(e,n)})}var Wn=()=>Math.floor(Date.now()/1e3);function Xs(n){let e=new Date(n*1e3);return e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),Math.floor(e.getTime()/1e3)}var ac=1209600,$t=class $t extends l{constructor(e){super();let{privateKey:t,expiryDateSecs:r,blinder:s}=e;this.privateKey=t,this.publicKey=new lt(t.publicKey()),this.expiryDateSecs=r||Xs(Wn()+ac),this.blinder=s!==void 0?p.fromHexInput(s).toUint8Array():cc();let i=Ir(this.publicKey.bcsToBytes(),93);i.push(BigInt(this.expiryDateSecs)),i.push(Jt(this.blinder));let o=en(i);this.nonce=o.toString()}getPublicKey(){return this.publicKey}isExpired(){return Math.floor(Date.now()/1e3)>this.expiryDateSecs}serialize(e){e.serializeU32AsUleb128(this.publicKey.variant),e.serializeBytes(this.privateKey.toUint8Array()),e.serializeU64(this.expiryDateSecs),e.serializeFixedBytes(this.blinder)}static deserialize(e){let t=e.deserializeUleb128AsU32(),r;switch(t){case 0:r=W.deserialize(e);break;default:throw new Error(`Unknown variant index for EphemeralPublicKey: ${t}`)}let s=e.deserializeU64(),i=e.deserializeFixedBytes(31);return new $t({privateKey:r,expiryDateSecs:Number(s),blinder:i})}static fromBytes(e){return $t.deserialize(new re(e))}static generate(e){let t;switch(_optionalChain([e, 'optionalAccess', _36 => _36.scheme])){case 0:default:t=W.generate()}return new $t({privateKey:t,expiryDateSecs:_optionalChain([e, 'optionalAccess', _37 => _37.expiryDateSecs])})}sign(e){if(this.isExpired())throw new Error("EphemeralKeyPair has expired");return new ue(this.privateKey.sign(e))}};$t.BLINDER_LENGTH=31;var dn=$t;function cc(){return _utils.randomBytes.call(void 0, dn.BLINDER_LENGTH)}var _eventemitter3 = require('eventemitter3'); var _eventemitter32 = _interopRequireDefault(_eventemitter3);var tt=class tt extends l{constructor(e){super();let{address:t,ephemeralKeyPair:r,uidKey:s,uidVal:i,aud:o,pepper:a,proof:c,proofFetchCallback:d,jwt:g}=e;if(this.ephemeralKeyPair=r,this.publicKey=de.create(e),this.accountAddress=t?u.from(t):this.publicKey.authKey().derivedAddress(),this.uidKey=s,this.uidVal=i,this.aud=o,this.jwt=g,this.emitter=new _eventemitter32.default,this.proofOrPromise=c,c instanceof Ke)this.proof=c;else{if(d===void 0)throw new Error("Must provide callback for async proof fetch");this.emitter.on("proofFetchFinish",async S=>{await d(S),this.emitter.removeAllListeners()}),this.init(c)}this.signingScheme=2;let w=p.fromHexInput(a).toUint8Array();if(w.length!==tt.PEPPER_LENGTH)throw new Error(`Pepper length in bytes should be ${tt.PEPPER_LENGTH}`);this.pepper=w}async init(e){try{this.proof=await e,this.emitter.emit("proofFetchFinish",{status:"Success"})}catch(t){t instanceof Error?this.emitter.emit("proofFetchFinish",{status:"Failed",error:t.toString()}):this.emitter.emit("proofFetchFinish",{status:"Failed",error:"Unknown"})}}serialize(e){if(e.serializeStr(this.jwt),e.serializeStr(this.uidKey),e.serializeFixedBytes(this.pepper),this.ephemeralKeyPair.serialize(e),this.proof===void 0)throw new Error("Connot serialize - proof undefined");this.proof.serialize(e)}static deserialize(e){let t=e.deserializeStr(),r=e.deserializeStr(),s=e.deserializeFixedBytes(31),i=dn.deserialize(e),o=Ke.deserialize(e);return tt.create({proof:o,pepper:s,uidKey:r,jwt:t,ephemeralKeyPair:i})}isExpired(){return this.ephemeralKeyPair.isExpired()}signWithAuthenticator(e){let t=new K(this.sign(e)),r=new I(this.publicKey);return new j(r,t)}signTransactionWithAuthenticator(e){let t=new K(this.signTransaction(e)),r=new I(this.publicKey);return new j(r,t)}async waitForProofFetch(){this.proofOrPromise instanceof Promise&&await this.proofOrPromise}sign(e){let{expiryDateSecs:t}=this.ephemeralKeyPair;if(this.isExpired())throw new Error("EphemeralKeyPair is expired");if(this.proof===void 0)throw new Error("Proof not defined");let r=this.ephemeralKeyPair.getPublicKey(),s=this.ephemeralKeyPair.sign(e);return new ze({jwtHeader:this.jwt.split(".")[0],ephemeralCertificate:new Ut(this.proof,0),expiryDateSecs:t,ephemeralPublicKey:r,ephemeralSignature:s})}signTransaction(e){if(this.proof===void 0)throw new Error("Proof not found");let t=Ze(e);return this.sign(t)}verifySignature(e){let{message:t,signature:r}=e;return!(this.isExpired()||!this.ephemeralKeyPair.getPublicKey().verifySignature({message:t,signature:r.ephemeralSignature}))}static fromBytes(e){return tt.deserialize(new re(e))}static create(e){let{address:t,proof:r,jwt:s,ephemeralKeyPair:i,pepper:o,uidKey:a="sub",proofFetchCallback:c}=e,d=_jwtdecode.jwtDecode.call(void 0, s),g=d.iss;if(typeof d.aud!="string")throw new Error("aud was not found or an array of values");let w=d.aud,S=d[a];return new tt({address:t,proof:r,ephemeralKeyPair:i,iss:g,uidKey:a,uidVal:S,aud:w,pepper:o,jwt:s,proofFetchCallback:c})}};tt.PEPPER_LENGTH=31;var pe=tt;var jn=class n{constructor(e){let{multiKey:t,signers:r}=e;this.publicKey=t,this.signingScheme=3,this.accountAddress=this.publicKey.authKey().derivedAddress();let s=[];for(let o of r)s.push(this.publicKey.getIndex(o.publicKey));let i=r.map((o,a)=>[o,s[a]]);i.sort((o,a)=>o[1]-a[1]),this.signers=i.map(o=>o[0]),this.signerIndicies=i.map(o=>o[1]),this.signaturesBitmap=this.publicKey.createBitmap({bits:s})}static fromPublicKeysAndSigners(e){let{publicKeys:t,signaturesRequired:r,signers:s}=e,i=new Kt({publicKeys:t,signaturesRequired:r});return new n({multiKey:i,signers:s})}static isMultiKeySigner(e){return e instanceof n}signWithAuthenticator(e){return new ht(this.publicKey,this.sign(e))}signTransactionWithAuthenticator(e){return new ht(this.publicKey,this.signTransaction(e))}async waitForProofFetch(){let t=this.signers.filter(r=>r instanceof pe).map(async r=>r.waitForProofFetch());await Promise.all(t)}sign(e){let t=[];for(let r of this.signers)t.push(r.sign(e));return new ft({signatures:t,bitmap:this.signaturesBitmap})}signTransaction(e){let t=[];for(let r of this.signers)t.push(r.signTransaction(e));return new ft({signatures:t,bitmap:this.signaturesBitmap})}verifySignature(e){let{message:t,signature:r}=e;if(!this.signerIndicies.every((i,o)=>o===0||i>=this.signerIndicies[o-1]))return!1;for(let i=0;i<r.signatures.length;i+=1){let o=r.signatures[i];if(!this.publicKey.publicKeys[this.signerIndicies[i]].verifySignature({message:t,signature:o}))return!1}return!0}};var Ys=class n{constructor(e){let{sender:t,signers:r}=e;this.accountAddress=t,this.signingScheme=4,this.publicKey=new Qe({publicKeys:r.map(s=>s.publicKey)}),this.signers=r}static isMultiKeySigner(e){return e instanceof n}signWithAuthenticator(e){return new Ge(this.publicKey,this.sign(e))}signTransactionWithAuthenticator(e){return new Ge(this.publicKey,this.signTransaction(e))}async waitForProofFetch(){let t=this.signers.filter(r=>r instanceof pe).map(async r=>r.waitForProofFetch());await Promise.all(t)}sign(e){let t=[];for(let r of this.signers)t.push(r.sign(e));return new ke({signatures:t})}signTransaction(e){let t=[];for(let r of this.signers)t.push(r.signTransaction(e));return new ke({signatures:t})}verifySignature(e){let{message:t,signature:r}=e;if(r.signatures.length!==this.publicKey.publicKeys.length)return!1;for(let s=0;s<r.signatures.length;s+=1){let i=r.signatures[s];if(!this.publicKey.publicKeys[s].verifySignature({message:t,signature:i}))return!1}return!0}};var lc=`
    fragment TokenActivitiesFields on token_activities_v2 {
  after_value
  before_value
  entry_function_id_str
  event_account_address
  event_index
  from_address
  is_fungible_v2
  property_version_v1
  to_address
  token_amount
  token_data_id
  token_standard
  transaction_timestamp
  transaction_version
  type
}
    `,pc=`
    fragment AnsTokenFragment on current_endless_names {
  domain
  expiration_timestamp
  registered_address
  subdomain
  token_standard
  is_primary
  owner_address
}
    `,Xn=`
    fragment CurrentTokenOwnershipFields on current_token_ownerships_v2 {
  token_standard
  token_properties_mutated_v1
  token_data_id
  table_type_v1
  storage_id
  property_version_v1
  owner_address
  last_transaction_version
  last_transaction_timestamp
  is_soulbound_v2
  is_fungible_v2
  amount
  current_token_data {
    collection_id
    description
    is_fungible_v2
    largest_property_version_v1
    last_transaction_timestamp
    last_transaction_version
    maximum
    supply
    token_data_id
    token_name
    token_properties
    token_standard
    token_uri
    decimals
    current_collection {
      collection_id
      collection_name
      creator_address
      current_supply
      description
      last_transaction_timestamp
      last_transaction_version
      max_supply
      mutable_description
      mutable_uri
      table_handle_v1
      token_standard
      total_minted_v2
      uri
    }
  }
}
    `,Zs=`
    query getAccountCoinsCount($address: String) {
  current_fungible_asset_balances_aggregate(
    where: {owner_address: {_eq: $address}}
  ) {
    aggregate {
      count
    }
  }
}
    `;var Js=`
    query getAccountCollectionsWithOwnedTokens($where_condition: current_collection_ownership_v2_view_bool_exp!, $offset: Int, $limit: Int, $order_by: [current_collection_ownership_v2_view_order_by!]) {
  current_collection_ownership_v2_view(
    where: $where_condition
    offset: $offset
    limit: $limit
    order_by: $order_by
  ) {
    current_collection {
      collection_id
      collection_name
      creator_address
      current_supply
      description
      last_transaction_timestamp
      last_transaction_version
      mutable_description
      max_supply
      mutable_uri
      table_handle_v1
      token_standard
      total_minted_v2
      uri
    }
    collection_id
    collection_name
    collection_uri
    creator_address
    distinct_tokens
    last_transaction_version
    owner_address
    single_token_uri
  }
}
    `,ei=`
    query getAccountOwnedObjects($where_condition: current_objects_bool_exp, $offset: Int, $limit: Int, $order_by: [current_objects_order_by!]) {
  current_objects(
    where: $where_condition
    offset: $offset
    limit: $limit
    order_by: $order_by
  ) {
    allow_ungated_transfer
    state_key_hash
    owner_address
    object_address
    last_transaction_version
    last_guid_creation_num
    is_deleted
  }
}
    `,ti=`
    query getAccountOwnedTokens($where_condition: current_token_ownerships_v2_bool_exp!, $offset: Int, $limit: Int, $order_by: [current_token_ownerships_v2_order_by!]) {
  current_token_ownerships_v2(
    where: $where_condition
    offset: $offset
    limit: $limit
    order_by: $order_by
  ) {
    ...CurrentTokenOwnershipFields
  }
}
    ${Xn}`,uA=`
    query getAccountOwnedTokensByTokenData($where_condition: current_token_ownerships_v2_bool_exp!, $offset: Int, $limit: Int, $order_by: [current_token_ownerships_v2_order_by!]) {
  current_token_ownerships_v2(
    where: $where_condition
    offset: $offset
    limit: $limit
    order_by: $order_by
  ) {
    ...CurrentTokenOwnershipFields
  }
}
    ${Xn}`,ni=`
    query getAccountOwnedTokensFromCollection($where_condition: current_token_ownerships_v2_bool_exp!, $offset: Int, $limit: Int, $order_by: [current_token_ownerships_v2_order_by!]) {
  current_token_ownerships_v2(
    where: $where_condition
    offset: $offset
    limit: $limit
    order_by: $order_by
  ) {
    ...CurrentTokenOwnershipFields
  }
}
    ${Xn}`,ri=`
    query getAccountTokensCount($where_condition: current_token_ownerships_v2_bool_exp, $offset: Int, $limit: Int) {
  current_token_ownerships_v2_aggregate(
    where: $where_condition
    offset: $offset
    limit: $limit
  ) {
    aggregate {
      count
    }
  }
}
    `,si=`
    query getAccountTransactionsCount($address: String) {
  account_transactions_aggregate(where: {account_address: {_eq: $address}}) {
    aggregate {
      count
    }
  }
}
    `,ii=`
    query getChainTopUserTransactions($limit: Int) {
  user_transactions(limit: $limit, order_by: {version: desc}) {
    version
  }
}
    `,Mr=`
    query getCollectionData($where_condition: current_collections_v2_bool_exp!) {
  current_collections_v2(where: $where_condition) {
    collection_id
    collection_name
    creator_address
    current_supply
    description
    last_transaction_timestamp
    last_transaction_version
    max_supply
    mutable_description
    mutable_uri
    table_handle_v1
    token_standard
    total_minted_v2
    uri
  }
}
    `,oi=`
    query getCurrentFungibleAssetBalances($where_condition: current_fungible_asset_balances_bool_exp, $offset: Int, $limit: Int) {
  current_fungible_asset_balances(
    where: $where_condition
    offset: $offset
    limit: $limit
  ) {
    amount
    asset_type
    is_frozen
    is_primary
    last_transaction_timestamp
    last_transaction_version
    owner_address
    storage_id
    token_standard
  }
}
    `,ai=`
    query getDelegatedStakingActivities($delegatorAddress: String, $poolAddress: String) {
  delegated_staking_activities(
    where: {delegator_address: {_eq: $delegatorAddress}, pool_address: {_eq: $poolAddress}}
  ) {
    amount
    delegator_address
    event_index
    event_type
    pool_address
    transaction_version
  }
}
    `,ci=`
    query getEvents($where_condition: events_bool_exp, $offset: Int, $limit: Int, $order_by: [events_order_by!]) {
  events(
    where: $where_condition
    offset: $offset
    limit: $limit
    order_by: $order_by
  ) {
    account_address
    creation_number
    data
    event_index
    sequence_number
    transaction_block_height
    transaction_version
    type
    indexed_type
  }
}
    `,ui=`
    query getFungibleAssetActivities($where_condition: fungible_asset_activities_bool_exp, $offset: Int, $limit: Int) {
  fungible_asset_activities(
    where: $where_condition
    offset: $offset
    limit: $limit
  ) {
    amount
    asset_type
    block_height
    entry_function_id_str
    event_index
    gas_fee_payer_address
    is_frozen
    is_gas_fee
    is_transaction_success
    owner_address
    storage_id
    storage_refund_amount
    token_standard
    transaction_timestamp
    transaction_version
    type
  }
}
    `,di=`
    query getFungibleAssetMetadata($where_condition: fungible_asset_metadata_bool_exp, $offset: Int, $limit: Int) {
  fungible_asset_metadata(where: $where_condition, offset: $offset, limit: $limit) {
    icon_uri
    project_uri
    supply_aggregator_table_handle_v1
    supply_aggregator_table_key_v1
    creator_address
    asset_type
    decimals
    last_transaction_timestamp
    last_transaction_version
    name
    symbol
    token_standard
  }
}
    `,Vt=`
    query getNames($offset: Int, $limit: Int, $where_condition: current_endless_names_bool_exp, $order_by: [current_endless_names_order_by!]) {
  current_endless_names(
    limit: $limit
    where: $where_condition
    order_by: $order_by
    offset: $offset
  ) {
    ...AnsTokenFragment
  }
}
    ${pc}`,Or=`
    query getNumberOfDelegators($where_condition: num_active_delegator_per_pool_bool_exp, $order_by: [num_active_delegator_per_pool_order_by!]) {
  num_active_delegator_per_pool(where: $where_condition, order_by: $order_by) {
    num_active_delegator
    pool_address
  }
}
    `,Fr=`
    query getProcessorStatus($where_condition: processor_status_bool_exp) {
  processor_status(where: $where_condition) {
    last_success_version
    processor
    last_updated
  }
}
    `,li=`
    query getTableItemsData($where_condition: table_items_bool_exp!, $offset: Int, $limit: Int, $order_by: [table_items_order_by!]) {
  table_items(
    where: $where_condition
    offset: $offset
    limit: $limit
    order_by: $order_by
  ) {
    decoded_key
    decoded_value
    key
    table_handle
    transaction_version
    write_set_change_index
  }
}
    `,pi=`
    query getTableItemsMetadata($where_condition: table_metadatas_bool_exp!, $offset: Int, $limit: Int, $order_by: [table_metadatas_order_by!]) {
  table_metadatas(
    where: $where_condition
    offset: $offset
    limit: $limit
    order_by: $order_by
  ) {
    handle
    key_type
    value_type
  }
}
    `,gi=`
    query getTokenActivity($where_condition: token_activities_v2_bool_exp!, $offset: Int, $limit: Int, $order_by: [token_activities_v2_order_by!]) {
  token_activities_v2(
    where: $where_condition
    order_by: $order_by
    offset: $offset
    limit: $limit
  ) {
    ...TokenActivitiesFields
  }
}
    ${lc}`,qr=`
    query getCurrentTokenOwnership($where_condition: current_token_ownerships_v2_bool_exp!, $offset: Int, $limit: Int, $order_by: [current_token_ownerships_v2_order_by!]) {
  current_token_ownerships_v2(
    where: $where_condition
    offset: $offset
    limit: $limit
    order_by: $order_by
  ) {
    ...CurrentTokenOwnershipFields
  }
}
    ${Xn}`,mi=`
    query getTokenData($where_condition: current_token_datas_v2_bool_exp, $offset: Int, $limit: Int, $order_by: [current_token_datas_v2_order_by!]) {
  current_token_datas_v2(
    where: $where_condition
    offset: $offset
    limit: $limit
    order_by: $order_by
  ) {
    collection_id
    description
    is_fungible_v2
    largest_property_version_v1
    last_transaction_timestamp
    last_transaction_version
    maximum
    supply
    token_data_id
    token_name
    token_properties
    token_standard
    token_uri
    decimals
    current_collection {
      collection_id
      collection_name
      creator_address
      current_supply
      description
      last_transaction_timestamp
      last_transaction_version
      max_supply
      mutable_description
      mutable_uri
      table_handle_v1
      token_standard
      total_minted_v2
      uri
    }
  }
}
    `;async function Yn(n){let{endlessConfig:e}=n,{data:t}=await V({endlessConfig:e,originMethod:"getLedgerInfo",path:""});return t}async function yi(n){let{endlessConfig:e,limit:t}=n;return(await f({endlessConfig:e,query:{query:ii,variables:{limit:t}},originMethod:"getChainTopUserTransactions"})).user_transactions}async function f(n){let{endlessConfig:e,query:t,originMethod:r}=n,{data:s}=await It({endlessConfig:e,originMethod:_nullishCoalesce(r, () => ("queryIndexer")),path:"",body:t,overrides:{WITH_CREDENTIALS:!1}});return s}async function gc(n){let{endlessConfig:e}=n;return(await f({endlessConfig:e,query:{query:Fr},originMethod:"getProcessorStatuses"})).processor_status}async function Zn(n){let e=await gc({endlessConfig:n.endlessConfig});return BigInt(e[0].last_success_version)}async function Jn(n){let{endlessConfig:e,processorType:t}=n;return(await f({endlessConfig:e,query:{query:Fr,variables:{where_condition:{processor:{_eq:t}}}},originMethod:"getProcessorStatus"})).processor_status[0]}async function er(n){let{endlessConfig:e,handle:t,data:r,options:s}=n;return(await Le({endlessConfig:e,originMethod:"getTableItem",path:`tables/${t}/item`,params:{ledger_version:_optionalChain([s, 'optionalAccess', _38 => _38.ledgerVersion])},body:r})).data}async function fi(n){let{endlessConfig:e,options:t}=n,r={query:li,variables:{where_condition:_optionalChain([t, 'optionalAccess', _39 => _39.where]),offset:_optionalChain([t, 'optionalAccess', _40 => _40.offset]),limit:_optionalChain([t, 'optionalAccess', _41 => _41.limit]),order_by:_optionalChain([t, 'optionalAccess', _42 => _42.orderBy])}};return(await f({endlessConfig:e,query:r,originMethod:"getTableItemsData"})).table_items}async function Ai(n){let{endlessConfig:e,options:t}=n,r={query:pi,variables:{where_condition:_optionalChain([t, 'optionalAccess', _43 => _43.where]),offset:_optionalChain([t, 'optionalAccess', _44 => _44.offset]),limit:_optionalChain([t, 'optionalAccess', _45 => _45.limit]),order_by:_optionalChain([t, 'optionalAccess', _46 => _46.orderBy])}};return(await f({endlessConfig:e,query:r,originMethod:"getTableItemsMetadata"})).table_metadatas}async function ve(n){let{endlessConfig:e,accountAddress:t}=n,{data:r}=await V({endlessConfig:e,originMethod:"getInfo",path:`accounts/${u.from(t).toString()}`});return r}async function Ti(n){let{endlessConfig:e,accountAddress:t,options:r}=n;return Pt({endlessConfig:e,originMethod:"getModules",path:`accounts/${u.from(t).toString()}/modules`,params:{ledger_version:_optionalChain([r, 'optionalAccess', _47 => _47.ledgerVersion]),start:_optionalChain([r, 'optionalAccess', _48 => _48.offset]),limit:_nullishCoalesce(_optionalChain([r, 'optionalAccess', _49 => _49.limit]), () => (1e3))}})}async function tr(n){return _optionalChain([n, 'access', _50 => _50.options, 'optionalAccess', _51 => _51.ledgerVersion])!==void 0?hi(n):$e(async()=>hi(n),`module-${n.accountAddress}-${n.moduleName}`,1e3*60*5)()}async function hi(n){let{endlessConfig:e,accountAddress:t,moduleName:r,options:s}=n,{data:i}=await V({endlessConfig:e,originMethod:"getModule",path:`accounts/${u.from(t).toString()}/module/${r}`,params:{ledger_version:_optionalChain([s, 'optionalAccess', _52 => _52.ledgerVersion])}});return i}async function wi(n){let{endlessConfig:e,accountAddress:t,options:r}=n;return Pt({endlessConfig:e,originMethod:"getTransactions",path:`accounts/${u.from(t).toString()}/transactions`,params:{start:_optionalChain([r, 'optionalAccess', _53 => _53.offset]),limit:_optionalChain([r, 'optionalAccess', _54 => _54.limit])}})}async function Si(n){let{endlessConfig:e,accountAddress:t,options:r}=n;return Pt({endlessConfig:e,originMethod:"getResources",path:`accounts/${u.from(t).toString()}/resources`,params:{ledger_version:_optionalChain([r, 'optionalAccess', _55 => _55.ledgerVersion]),start:_optionalChain([r, 'optionalAccess', _56 => _56.offset]),limit:_nullishCoalesce(_optionalChain([r, 'optionalAccess', _57 => _57.limit]), () => (999))}})}async function Hr(n){let{endlessConfig:e,accountAddress:t,resourceType:r,options:s}=n,{data:i}=await V({endlessConfig:e,originMethod:"getResource",path:`accounts/${u.from(t).toString()}/resource/${r}`,params:{ledger_version:_optionalChain([s, 'optionalAccess', _58 => _58.ledgerVersion])}});return i.data}async function Lr(n){let{endlessConfig:e,authenticationKey:t,options:r}=n,s=await Hr({endlessConfig:e,accountAddress:"0x1",resourceType:"0x1::account::OriginatingAddress",options:r}),{address_map:{handle:i}}=s,o=u.from(t);try{let a=await er({endlessConfig:e,handle:i,data:{key:o.toString(),key_type:"address",value_type:"address"},options:r});return u.from(a)}catch(a){if(a instanceof he&&a.data.error_code==="table_item_not_found")return o;throw a}}async function xi(n){let{endlessConfig:e,accountAddress:t}=n,s={owner_address:{_eq:u.from(t).toStringLong()},amount:{_gt:0}},o=await f({endlessConfig:e,query:{query:ri,variables:{where_condition:s}},originMethod:"getAccountTokensCount"});return o.current_token_ownerships_v2_aggregate.aggregate?o.current_token_ownerships_v2_aggregate.aggregate.count:0}async function _i(n){let{endlessConfig:e,accountAddress:t,options:r}=n,i={owner_address:{_eq:u.from(t).toStringLong()},amount:{_gt:0}};_optionalChain([r, 'optionalAccess', _59 => _59.tokenStandard])&&(i.token_standard={_eq:_optionalChain([r, 'optionalAccess', _60 => _60.tokenStandard])});let o={query:ti,variables:{where_condition:i,offset:_optionalChain([r, 'optionalAccess', _61 => _61.offset]),limit:_optionalChain([r, 'optionalAccess', _62 => _62.limit]),order_by:_optionalChain([r, 'optionalAccess', _63 => _63.orderBy])}};return(await f({endlessConfig:e,query:o,originMethod:"getAccountOwnedTokens"})).current_token_ownerships_v2}async function Ei(n){let{endlessConfig:e,accountAddress:t,collectionAddress:r,options:s}=n,i=u.from(t).toStringLong(),o=u.from(r).toStringLong(),a={owner_address:{_eq:i},current_token_data:{collection_id:{_eq:o}},amount:{_gt:0}};_optionalChain([s, 'optionalAccess', _64 => _64.tokenStandard])&&(a.token_standard={_eq:_optionalChain([s, 'optionalAccess', _65 => _65.tokenStandard])});let c={query:ni,variables:{where_condition:a,offset:_optionalChain([s, 'optionalAccess', _66 => _66.offset]),limit:_optionalChain([s, 'optionalAccess', _67 => _67.limit]),order_by:_optionalChain([s, 'optionalAccess', _68 => _68.orderBy])}};return(await f({endlessConfig:e,query:c,originMethod:"getAccountOwnedTokensFromCollectionAddress"})).current_token_ownerships_v2}async function vi(n){let{endlessConfig:e,accountAddress:t,options:r}=n,i={owner_address:{_eq:u.from(t).toStringLong()},amount:{_gt:0}};_optionalChain([r, 'optionalAccess', _69 => _69.tokenStandard])&&(i.current_collection={token_standard:{_eq:_optionalChain([r, 'optionalAccess', _70 => _70.tokenStandard])}});let o={query:Js,variables:{where_condition:i,offset:_optionalChain([r, 'optionalAccess', _71 => _71.offset]),limit:_optionalChain([r, 'optionalAccess', _72 => _72.limit]),order_by:_optionalChain([r, 'optionalAccess', _73 => _73.orderBy])}};return(await f({endlessConfig:e,query:o,originMethod:"getAccountCollectionsWithOwnedTokens"})).current_collection_ownership_v2_view}async function Ci(n){let{endlessConfig:e,accountAddress:t}=n,r=u.from(t).toStringLong(),i=await f({endlessConfig:e,query:{query:si,variables:{address:r}},originMethod:"getAccountTransactionsCount"});return i.account_transactions_aggregate.aggregate?i.account_transactions_aggregate.aggregate.count:0}async function Pi(n){let{endlessConfig:e,accountAddress:t,coinId:r}=n,s=u.from(t).toStringLong(),{data:i}=await $r({endlessConfig:e,accountAddress:s,options:{where:{coin_id:r}}});return i[0].balance&&i[0].metadata.decimals?parseInt(i[0].balance,10)/10**i[0].metadata.decimals:0}async function Ii(n){let{endlessConfig:e,accountAddress:t,options:r}=n,s=u.from(t).toStringLong(),{data:i}=await nn({endlessConfig:e,originMethod:"getCoinsDataCreatedBy",path:`coins/created_by/${s}`,params:{page:_optionalChain([r, 'optionalAccess', _74 => _74.page]),pageSize:_optionalChain([r, 'optionalAccess', _75 => _75.pageSize]),coin:_optionalChain([r, 'optionalAccess', _76 => _76.where, 'optionalAccess', _77 => _77.coin_id])}});return i}async function $r(n){let{endlessConfig:e,accountAddress:t,options:r}=n,s=u.from(t).toStringLong(),{data:i}=await nn({endlessConfig:e,originMethod:"getAccountCoinsData",path:`accounts/${s}/coins`,params:{page:_optionalChain([r, 'optionalAccess', _78 => _78.page]),pageSize:_optionalChain([r, 'optionalAccess', _79 => _79.pageSize]),coin:_optionalChain([r, 'optionalAccess', _80 => _80.where, 'optionalAccess', _81 => _81.coin_id])}});return i}async function Ui(n){let{endlessConfig:e,accountAddress:t}=n,r=u.from(t).toStringLong(),i=await f({endlessConfig:e,query:{query:Zs,variables:{address:r}},originMethod:"getAccountCoinsCount"});if(!i.current_fungible_asset_balances_aggregate.aggregate)throw Error("Failed to get the count of account coins");return i.current_fungible_asset_balances_aggregate.aggregate.count}async function Ri(n){let{endlessConfig:e,accountAddress:t,options:r}=n,i={owner_address:{_eq:u.from(t).toStringLong()}},o={query:ei,variables:{where_condition:i,offset:_optionalChain([r, 'optionalAccess', _82 => _82.offset]),limit:_optionalChain([r, 'optionalAccess', _83 => _83.limit]),order_by:_optionalChain([r, 'optionalAccess', _84 => _84.orderBy])}};return(await f({endlessConfig:e,query:o,originMethod:"getAccountOwnedObjects"})).current_objects}async function zi(n){let{endlessConfig:e,privateKey:t}=n,r=new I(t.publicKey());if(t instanceof yt){let i=G.fromPublicKey({publicKey:r}).derivedAddress();return Je.fromPrivateKey({privateKey:t,address:i})}if(t instanceof W){let s=G.fromPublicKey({publicKey:r});if(await bi({authKey:s,endlessConfig:e})){let c=s.derivedAddress();return Je.fromPrivateKey({privateKey:t,address:c,legacy:!1})}let o=G.fromPublicKey({publicKey:r.publicKey});if(await bi({authKey:o,endlessConfig:e})){let c=o.derivedAddress();return Je.fromPrivateKey({privateKey:t,address:c,legacy:!0})}}throw new Error(`Can't derive account from private key ${t}`)}async function bi(n){let{endlessConfig:e,authKey:t}=n,r=await Lr({endlessConfig:e,authenticationKey:t.derivedAddress()});try{return await ve({endlessConfig:e,accountAddress:r}),!0}catch(s){if(s.status===404)return!1;throw new Error(`Error while looking for an account info ${r.toString()}`)}}async function Ki(n){let{endlessConfig:e,accountAddress:t,coinAddress:r}=n,{data:s}=await It({endlessConfig:e,originMethod:"getAccountsCoinBalance",path:`accounts/coins/${r}`,body:t});return s}async function Qr(n){let{endlessConfig:e,options:t}=n;return Pt({endlessConfig:e,originMethod:"getTransactions",path:"transactions",params:{start:_optionalChain([t, 'optionalAccess', _85 => _85.offset]),limit:_optionalChain([t, 'optionalAccess', _86 => _86.limit])}})}async function rr(n){let{endlessConfig:e}=n;return $e(async()=>{let{data:t}=await V({endlessConfig:e,originMethod:"getGasPriceEstimation",path:"estimate_gas_price"});return t},`gas-price-${e.network}`,1e3*60*5)()}async function Bi(n){let{endlessConfig:e,ledgerVersion:t}=n,{data:r}=await V({endlessConfig:e,originMethod:"getTransactionByVersion",path:`transactions/by_version/${t}`});return r}async function ln(n){let{endlessConfig:e,transactionHash:t}=n,{data:r}=await V({endlessConfig:e,path:`transactions/by_hash/${t}`,originMethod:"getTransactionByHash"});return r}async function Di(n){let{endlessConfig:e,transactionHash:t}=n;try{return(await ln({endlessConfig:e,transactionHash:t})).type==="pending_transaction"}catch(r){if(_optionalChain([r, 'optionalAccess', _87 => _87.status])===404)return!0;throw r}}async function mc(n){let{endlessConfig:e,transactionHash:t}=n,{data:r}=await V({endlessConfig:e,path:`transactions/wait_by_hash/${t}`,originMethod:"longWaitForTransaction"});return r}async function sr(n){let{endlessConfig:e,transactionHash:t,options:r}=n,s=_nullishCoalesce(_optionalChain([r, 'optionalAccess', _88 => _88.timeoutSecs]), () => (20)),i=_nullishCoalesce(_optionalChain([r, 'optionalAccess', _89 => _89.checkSuccess]), () => (!0)),o=!0,a=0,c,d,g=200,w=1.5;function S(m){if(!(m instanceof he)||(d=m,m.status!==404&&m.status>=400&&m.status<500))throw m}try{c=await ln({endlessConfig:e,transactionHash:t}),o=c.type==="pending_transaction"}catch(m){S(m)}if(o){let m=Date.now();try{c=await mc({endlessConfig:e,transactionHash:t}),o=c.type==="pending_transaction"}catch(P){S(P)}a=(Date.now()-m)/1e3}for(;o&&!(a>=s);){try{if(c=await ln({endlessConfig:e,transactionHash:t}),o=c.type==="pending_transaction",!o)break}catch(m){S(m)}await et(g),a+=g/1e3,g*=w}if(c===void 0)throw d||new nr(`Fetching transaction ${t} failed and timed out after ${s} seconds`,c);if(c.type==="pending_transaction")throw new nr(`Transaction ${t} timed out in pending state after ${s} seconds`,c);if(!i)return c;if(!c.success)throw new Vr(`Transaction ${t} failed with an error: ${c.vm_status}`,c);return c}async function ki(n){let{endlessConfig:e,processorType:t}=n,r=BigInt(n.minimumLedgerVersion),s=3e3,i=new Date().getTime(),o=BigInt(-1);for(;o<r;){if(new Date().getTime()-i>s)throw new Error("waitForLastSuccessIndexerVersionSync timeout");if(t===void 0?o=await Zn({endlessConfig:e}):o=(await Jn({endlessConfig:e,processorType:t})).last_success_version,o>=r)break;await et(200)}}var nr=class extends Error{constructor(e,t){super(e),this.lastSubmittedTransaction=t}},Vr=class extends Error{constructor(e,t){super(e),this.transaction=t}};async function Gi(n){let{endlessConfig:e,ledgerVersion:t,options:r}=n,{data:s}=await V({endlessConfig:e,originMethod:"getBlockByVersion",path:`blocks/by_version/${t}`,params:{with_transactions:_optionalChain([r, 'optionalAccess', _90 => _90.withTransactions])}});return Mi({block:s,...n})}async function Ni(n){let{endlessConfig:e,blockHeight:t,options:r}=n,{data:s}=await V({endlessConfig:e,originMethod:"getBlockByHeight",path:`blocks/by_height/${t}`,params:{with_transactions:_optionalChain([r, 'optionalAccess', _91 => _91.withTransactions])}});return Mi({block:s,...n})}async function Mi(n){let{endlessConfig:e,block:t,options:r}=n;if(_optionalChain([r, 'optionalAccess', _92 => _92.withTransactions])){t.transactions=_nullishCoalesce(t.transactions, () => ([]));let s=t.transactions[t.transactions.length-1],i=BigInt(t.first_version),o=BigInt(t.last_version),a=_optionalChain([s, 'optionalAccess', _93 => _93.version]),c;if(a===void 0?c=i-1n:c=BigInt(a),c===o)return t;let d=[],g=100n;for(let S=c+1n;S<o;S+=BigInt(100))d.push(Qr({endlessConfig:e,options:{offset:S,limit:Math.min(Number(g),Number(o-S+1n))}}));let w=await Promise.all(d);for(let S of w)t.transactions.push(...S)}return t}async function h(n){n.minimumLedgerVersion!==void 0&&await ki({endlessConfig:n.config,minimumLedgerVersion:n.minimumLedgerVersion,processorType:n.processorType})}function fc(n){let{sender:e,events:t}=n,r=t.filter(i=>i.type==="0x1::fungible_asset::Withdraw"&&i.data.owner===e).map(i=>{let{amount:o,store:a}=i.data,c=new F(48);return u.from(a).serialize(c),c.serializeU128(BigInt(o)),c.toUint8Array()}),s=new F;return s.serializeU32AsUleb128(r.length),r.forEach(i=>s.serializeFixedBytes(i)),_sha3.sha3_256.call(void 0, s.toUint8Array())}var pn=class{constructor(e){this.config=e}async getAccountInfo(e){return ve({endlessConfig:this.config,...e})}async getAccountModules(e){return Ti({endlessConfig:this.config,...e})}async getAccountModule(e){return tr({endlessConfig:this.config,...e})}async getAccountTransactions(e){return wi({endlessConfig:this.config,...e})}async getAccountResources(e){return Si({endlessConfig:this.config,...e})}async getAccountResource(e){return Hr({endlessConfig:this.config,...e})}async lookupOriginalAccountAddress(e){return Lr({endlessConfig:this.config,...e})}async getAccountTokensCount(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"account_transactions_processor"}),xi({endlessConfig:this.config,...e})}async getAccountOwnedTokens(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"token_v2_processor"}),_i({endlessConfig:this.config,...e})}async getAccountOwnedTokensFromCollectionAddress(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"token_v2_processor"}),Ei({endlessConfig:this.config,...e})}async getAccountCollectionsWithOwnedTokens(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"token_v2_processor"}),vi({endlessConfig:this.config,...e})}async getAccountTransactionsCount(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"account_transactions_processor"}),Ci({endlessConfig:this.config,...e})}async getAccountCoinsData(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"fungible_asset_processor"}),$r({endlessConfig:this.config,...e})}async getCoinsDataCreatedBy(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"fungible_asset_processor"}),Ii({endlessConfig:this.config,...e})}async getAccountCoinsCount(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"fungible_asset_processor"}),Ui({endlessConfig:this.config,...e})}async getAccountEDSAmount(e){return this.getAccountCoinAmount({coinId:Fs,...e})}async getAccountCoinAmount(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"fungible_asset_processor"}),Pi({endlessConfig:this.config,...e})}async getAccountOwnedObjects(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"default_processor"}),Ri({endlessConfig:this.config,...e})}async deriveAccountFromPrivateKey(e){return zi({endlessConfig:this.config,...e})}async getAccountsCoinBalance(e){return Ki({endlessConfig:this.config,...e})}};var _endlessclient = require('@endlesslab/endless-client'); var _endlessclient2 = _interopRequireDefault(_endlessclient);function Wr(n){let{params:e,method:t,url:r,headers:s,body:i,overrides:o}=n,a={headers:s,method:t,url:r,data:_nullishCoalesce(i, () => (e)),withCredentials:_nullishCoalesce(_optionalChain([o, 'optionalAccess', _94 => _94.WITH_CREDENTIALS]), () => (!0))};return console.log("requestConfig: ",a),Object.keys(_nullishCoalesce(a.data, () => ({}))).forEach(c=>{a.data[c]===void 0&&delete a.data[c]}),new Promise((c,d)=>{try{wx.request({...a,success:g=>{console.log("response: ",g),c({status:g.statusCode,statusText:g.errMsg,data:g.data,headers:g.header,config:g})},fail:g=>{d(g)}})}catch(g){d(g)}})}var ir=class{constructor(e){this.network=_nullishCoalesce(_optionalChain([e, 'optionalAccess', _95 => _95.network]), () => ("devnet")),this.fullnode=_optionalChain([e, 'optionalAccess', _96 => _96.fullnode]),this.indexer=_optionalChain([e, 'optionalAccess', _97 => _97.indexer]),this.prover=_optionalChain([e, 'optionalAccess', _98 => _98.prover]),this.client=_nullishCoalesce(_optionalChain([e, 'optionalAccess', _99 => _99.client]), () => ({provider:_endlessclient2.default})),_optionalChain([e, 'optionalAccess', _100 => _100.miniprogram])&&(this.client=_nullishCoalesce(_optionalChain([e, 'optionalAccess', _101 => _101.client]), () => ({provider:Wr}))),this.clientConfig=_nullishCoalesce(_optionalChain([e, 'optionalAccess', _102 => _102.clientConfig]), () => ({})),this.fullnodeConfig=_nullishCoalesce(_optionalChain([e, 'optionalAccess', _103 => _103.fullnodeConfig]), () => ({})),this.indexerConfig=_nullishCoalesce(_optionalChain([e, 'optionalAccess', _104 => _104.indexerConfig]), () => ({})),this.maxExpHorizonSecs=_optionalChain([e, 'optionalAccess', _105 => _105.network])==="testnet"?1e7:void 0}getRequestUrl(e){switch(e){case"Fullnode":if(this.fullnode!==void 0)return this.fullnode;if(this.network==="custom")throw new Error("Please provide a custom full node url");return ks[this.network];case"Indexer":if(this.indexer!==void 0)return this.indexer;if(this.network==="custom")throw new Error("Please provide a custom indexer url");return Bs[this.network];case"Prover":if(this.prover!==void 0)return this.prover;if(this.network==="custom")throw new Error("Please provide a custom prover service url");return Gs[this.network];case"Indexer2":if(this.indexerV2!==void 0)return this.indexerV2;if(this.network==="custom")throw new Error("Please provide a custom indexerv2 url");return Ds[this.network];default:throw Error(`apiType ${e} is not supported`)}}};function Oi(n){return!!n.match(/^[_a-zA-Z0-9]+$/)}function Fi(n){return!!n.match(/\s/)}function hc(n){return!!n.match(/^T[0-9]+$/)}function bc(n){return!!n.match(/^&.+$/)}function Tc(n){switch(n){case"signer":case"address":case"bool":case"u8":case"u16":case"u32":case"u64":case"u128":case"u256":return!0;default:return!1}}function wc(n,e){let t=e;for(;t<n.length;t+=1){let r=n[t];if(!Fi(r))break}return t}var Sc=(P=>(P.InvalidTypeTag="unknown type",P.UnexpectedGenericType="unexpected generic type",P.UnexpectedTypeArgumentClose="unexpected '>'",P.UnexpectedWhitespaceCharacter="unexpected whitespace character",P.UnexpectedComma="unexpected ','",P.TypeArgumentCountMismatch="type argument count doesn't match expected amount",P.MissingTypeArgumentClose="no matching '>' for '<'",P.MissingTypeArgument="no type argument before ','",P.UnexpectedPrimitiveTypeArguments="primitive types not expected to have type arguments",P.UnexpectedVectorTypeArgumentCount="vector type expected to have exactly one type argument",P.UnexpectedStructFormat="unexpected struct format, must be of the form 0xaddress::module_name::struct_name",P.InvalidModuleNameCharacter="module name must only contain alphanumeric or '_' characters",P.InvalidStructNameCharacter="struct name must only contain alphanumeric or '_' characters",P.InvalidAddress="struct address must be valid",P))(Sc||{}),O= exports.TypeTagParserError =class extends Error{constructor(e,t){super(`Failed to parse typeTag '${e}', ${t}`)}};function te(n,e){let t=_nullishCoalesce(_optionalChain([e, 'optionalAccess', _106 => _106.allowGenerics]), () => (!1)),r=[],s=[],i=[],o=0,a="",c=1;for(;o<n.length;){let d=n[o];if(d==="<")r.push({savedExpectedTypes:c,savedStr:a,savedTypes:i}),a="",i=[],c=1;else if(d===">"){if(a!==""){let P=gn(a,s,t);i.push(P)}let g=r.pop();if(g===void 0)throw new O(n,"unexpected '>'");if(c!==i.length)throw new O(n,"type argument count doesn't match expected amount");let{savedStr:w,savedTypes:S,savedExpectedTypes:m}=g;s=i,i=S,a=w,c=m}else if(d===","){if(r.length===0)throw new O(n,"unexpected ','");if(a.length===0)throw new O(n,"no type argument before ','");let g=gn(a,s,t);s=[],i.push(g),a="",c+=1}else if(Fi(d)){let g=!1;if(a.length!==0){let S=gn(a,s,t);s=[],i.push(S),a="",g=!0}o=wc(n,o);let w=n[o];if(o<n.length&&g&&w!==","&&w!==">")throw new O(n,"unexpected whitespace character");continue}else a+=d;o+=1}if(r.length>0)throw new O(n,"no matching '>' for '<'");switch(i.length){case 0:return gn(a,s,t);case 1:if(a==="")return i[0];throw new O(n,"unexpected ','");default:throw new O(n,"unexpected whitespace character")}}function gn(n,e,t){let r=n.trim(),s=r.toLowerCase();if(Tc(s)&&e.length>0)throw new O(n,"primitive types not expected to have type arguments");switch(r.toLowerCase()){case"signer":return new Ot;case"bool":return new Q;case"address":return new M;case"u8":return new we;case"u16":return new Gt;case"u32":return new Nt;case"u64":return new Se;case"u128":return new J;case"u256":return new Mt;case"vector":if(e.length!==1)throw new O(n,"vector type expected to have exactly one type argument");return new C(e[0]);default:if(bc(r)){let a=r.substring(1);return new qn(gn(a,e,t))}if(hc(r)){if(t)return new k(Number(r.split("T")[1]));throw new O(n,"unexpected generic type")}if(!r.match(/:/))throw new O(n,"unknown type");let i=r.split("::");if(i.length!==3)throw new O(n,"unexpected struct format, must be of the form 0xaddress::module_name::struct_name");let o;try{o=u.fromString(i[0])}catch (e3){throw new O(n,"struct address must be valid")}if(!Oi(i[1]))throw new O(n,"module name must only contain alphanumeric or '_' characters");if(!Oi(i[2]))throw new O(n,"struct name must only contain alphanumeric or '_' characters");return new y(new Ne(o,new B(i[1]),new B(i[2]),e))}}function qi(n){return typeof n=="boolean"}function Ce(n){return typeof n=="string"}function or(n){return typeof n=="number"}function ar(n){return typeof n=="number"||typeof n=="bigint"||typeof n=="string"}function Hi(n){return n==null}function Li(n){return jr(n)||Yr(n)||Zr(n)||Jr(n)||es(n)||ts(n)||ns(n)||cr(n)||Xr(n)||xc(n)||n instanceof b||n instanceof qe}function jr(n){return n instanceof U}function cr(n){return n instanceof u}function Xr(n){return n instanceof x}function xc(n){return n instanceof at}function Yr(n){return n instanceof q}function Zr(n){return n instanceof ie}function Jr(n){return n instanceof oe}function es(n){return n instanceof H}function ts(n){return n instanceof me}function ns(n){return n instanceof ye}function $i(n){return"bytecode"in n}function R(n,e){throw new Error(`Type mismatch for argument ${e}, expected '${n}'`)}function Vi(n){let e=n.params.findIndex(t=>t!=="signer"&&t!=="&signer"&&t!=="vector<signer>"&&t!=="auth"&&t!=="&auth"&&t!=="vector<auth>");return e<0?n.params.length:e}function mn(n){let e=n.split("::");if(e.length!==3)throw new Error(`Invalid function ${n}`);let t=e[0],r=e[1],s=e[2];return{moduleAddress:t,moduleName:r,functionName:s}}var _c=new TextEncoder;function ur(n){return _nullishCoalesce(_optionalChain([n, 'optionalAccess', _107 => _107.map, 'call', _108 => _108(e=>Ce(e)?te(e):e)]), () => ([]))}async function Qi(n,e,t,r){let s=await tr({endlessConfig:r,accountAddress:n,moduleName:e});if(s.abi)return s.abi.exposed_functions.find(i=>i.name===t)}async function Wi(n,e,t,r){let s=await Qi(n,e,t,r);if(!s)throw new Error(`Could not find entry function ABI for '${n}::${e}::${t}'`);if(!s.is_entry)throw new Error(`'${n}::${e}::${t}' is not an entry function`);let i=Vi(s),o=[];for(let a=i;a<s.params.length;a+=1)o.push(te(s.params[a],{allowGenerics:!0}));return{signers:i,typeParameters:s.generic_type_params,parameters:o}}async function ji(n,e,t,r){let s=await Qi(n,e,t,r);if(!s)throw new Error(`Could not find view function ABI for '${n}::${e}::${t}'`);if(!s.is_view)throw new Error(`'${n}::${e}::${t}' is not an view function`);let i=[];for(let a=0;a<s.params.length;a+=1)i.push(te(s.params[a],{allowGenerics:!0}));let o=[];for(let a=0;a<s.return.length;a+=1)o.push(te(s.return[a],{allowGenerics:!0}));return{typeParameters:s.generic_type_params,parameters:i,returnTypes:o}}function ss(n,e,t,r,s){if(r>=e.parameters.length)throw new Error(`Too many arguments for '${n}', expected ${e.parameters.length}`);let i=e.parameters[r];return Qt(t,i,r,s)}function Qt(n,e,t,r){return Li(n)?(rs(e,n,t),n):Ec(n,e,t,r)}function Ec(n,e,t,r){if(e.isBool()){if(qi(n))return new U(n);if(Ce(n)){if(n==="true")return new U(!0);if(n==="false")return new U(!1)}R("boolean",t)}if(e.isAddress()){if(Ce(n))return u.fromString(n);R("string | AccountAddress",t)}if(e.isU8()){if(or(n))return new q(n);if(Ce(n))return new q(Number.parseInt(n,10));R("number",t)}if(e.isU16()){if(or(n))return new ie(n);if(Ce(n))return new ie(Number.parseInt(n,10));R("number",t)}if(e.isU32()){if(or(n))return new oe(n);if(Ce(n))return new oe(Number.parseInt(n,10));R("number",t)}if(e.isU64()){if(ar(n))return new H(BigInt(n));R("bigint | number | string",t)}if(e.isU128()){if(ar(n))return new me(BigInt(n));R("bigint | number | string",t)}if(e.isU256()){if(ar(n))return new ye(BigInt(n));R("bigint | number | string",t)}if(e.isGeneric()){let s=e.value;if(s<0||s>=r.length)throw new Error(`Generic argument ${e.toString()} is invalid for argument ${t}`);return Qt(n,r[s],t,r)}if(e.isVector()){if(e.value.isU8()){if(Ce(n))return b.U8(_c.encode(n));if(n instanceof Uint8Array)return b.U8(n);if(n instanceof ArrayBuffer)return b.U8(new Uint8Array(n))}if(Array.isArray(n))return new b(n.map(s=>Qt(s,e.value,t,r)));throw new Error(`Type mismatch for argument ${t}, type '${e.toString()}'`)}if(e.isStruct()){if(e.isString()){if(Ce(n))return new x(n);R("string",t)}if(e.isObject()){if(Ce(n))return u.fromString(n);R("string | AccountAddress",t)}if(e.isOption())return Hi(n)?new qe(null):new qe(Qt(n,e.value.typeArgs[0],t,r));throw new Error(`Unsupported struct input type for argument ${t}, type '${e.toString()}'`)}throw new Error(`Type mismatch for argument ${t}, type '${e.toString()}'`)}function rs(n,e,t){if(n.isBool()){if(jr(e))return;R("Bool",t)}if(n.isAddress()){if(cr(e))return;R("AccountAddress",t)}if(n.isU8()){if(Yr(e))return;R("U8",t)}if(n.isU16()){if(Zr(e))return;R("U16",t)}if(n.isU32()){if(Jr(e))return;R("U32",t)}if(n.isU64()){if(es(e))return;R("U64",t)}if(n.isU128()){if(ts(e))return;R("U128",t)}if(n.isU256()){if(ns(e))return;R("U256",t)}if(n.isVector()){if(e instanceof b){e.values.length>0&&rs(n.value,e.values[0],t);return}R("MoveVector",t)}if(n instanceof y){if(n.isString()){if(Xr(e))return;R("MoveString",t)}if(n.isObject()){if(cr(e))return;R("AccountAddress",t)}if(n.isOption()){if(e instanceof qe){e.value!==void 0&&rs(n.value.typeArgs[0],e.value,t);return}R("MoveOption",t)}}throw new Error(`Type mismatch for argument ${t}, expected '${n.toString()}'`)}async function lr(n){if($i(n))return Ic(n);let{moduleAddress:e,moduleName:t,functionName:r}=mn(n.function),s=await eo({key:"entry-function",moduleAddress:e,moduleName:t,functionName:r,endlessConfig:n.endlessConfig,abi:n.abi,fetch:Wi});return Cc({...n,abi:s})}function Cc(n){let e=n.abi,{moduleAddress:t,moduleName:r,functionName:s}=mn(n.function),i=ur(n.typeArguments);if(i.length!==e.typeParameters.length)throw new Error(`Type argument count mismatch, expected ${e.typeParameters.length}, received ${i.length}`);let o=n.functionArguments.map((c,d)=>ss(n.function,e,c,d,i));if(o.length!==e.parameters.length)throw new Error(`Too few arguments for '${t}::${r}::${s}', expected ${e.parameters.length} but got ${o.length}`);let a=je.build(`${t}::${r}`,s,i,o);if("multisigAddress"in n){let c=u.from(n.multisigAddress);return new an(new cn(c,new un(a)))}return new _e(a)}async function Xi(n){let{moduleAddress:e,moduleName:t,functionName:r}=mn(n.function),s=await eo({key:"view-function",moduleAddress:e,moduleName:t,functionName:r,endlessConfig:n.endlessConfig,abi:n.abi,fetch:ji});return Pc({abi:s,...n})}function Pc(n){let e=n.abi,{moduleAddress:t,moduleName:r,functionName:s}=mn(n.function),i=ur(n.typeArguments);if(i.length!==e.typeParameters.length)throw new Error(`Type argument count mismatch, expected ${e.typeParameters.length}, received ${i.length}`);let o=_nullishCoalesce(_optionalChain([n, 'optionalAccess', _109 => _109.functionArguments, 'optionalAccess', _110 => _110.map, 'call', _111 => _111((a,c)=>ss(n.function,e,a,c,i))]), () => ([]));if(o.length!==e.parameters.length)throw new Error(`Too few arguments for '${t}::${r}::${s}', expected ${e.parameters.length} but got ${o.length}`);return je.build(`${t}::${r}`,s,i,o)}function Ic(n){return new xe(new Ft(p.fromHexInput(n.bytecode).toUint8Array(),ur(n.typeArguments),n.functionArguments))}async function Uc(n){let{endlessConfig:e,sender:t,payload:r,options:s,feePayerAddress:i}=n,o=async()=>Rr[e.network]?{chainId:Rr[e.network]}:{chainId:(await Yn({endlessConfig:e})).chain_id},a=async()=>_optionalChain([s, 'optionalAccess', _112 => _112.gasUnitPrice])?{gasEstimate:s.gasUnitPrice}:{gasEstimate:(await rr({endlessConfig:e})).gas_estimate},c=async()=>{let Et=async()=>{if(_optionalChain([s, 'optionalAccess', _113 => _113.accountSequenceNumber])!==void 0)return s.accountSequenceNumber;try{return(await ve({endlessConfig:e,accountAddress:t})).sequence_number}catch(st){if("status"in st&&st.status===404)return 0;throw st}};if(i&&u.from(i).equals(u.ZERO))try{return await Et()}catch (e4){return 0}else return Et()},[{chainId:d},{gasEstimate:g},w]=await Promise.all([o(),a(),c()]),{maxGasAmount:S,gasUnitPrice:m,expireTimestamp:P}={maxGasAmount:_optionalChain([s, 'optionalAccess', _114 => _114.maxGasAmount])?BigInt(s.maxGasAmount):BigInt(2e5),gasUnitPrice:_nullishCoalesce(_optionalChain([s, 'optionalAccess', _115 => _115.gasUnitPrice]), () => (BigInt(g))),expireTimestamp:_nullishCoalesce(_optionalChain([s, 'optionalAccess', _116 => _116.expireTimestamp]), () => (BigInt(Math.floor(Date.now()/1e3)+20)))};return new le(u.from(t),BigInt(w),r,BigInt(S),BigInt(m),BigInt(P),new kt(d))}async function is(n){let{endlessConfig:e,sender:t,payload:r,options:s,feePayerAddress:i}=n,o=await Uc({endlessConfig:e,sender:t,payload:r,options:s,feePayerAddress:i});if("secondarySignerAddresses"in n){let a=_nullishCoalesce(_optionalChain([n, 'access', _117 => _117.secondarySignerAddresses, 'optionalAccess', _118 => _118.map, 'call', _119 => _119(c=>u.from(c))]), () => ([]));return new Vn(o,a,n.feePayerAddress?u.from(n.feePayerAddress):void 0)}return new $n(o,n.feePayerAddress?u.from(n.feePayerAddress):void 0)}function Yi(n){let{signerPublicKey:e,transaction:t,secondarySignersPublicKeys:r,feePayerPublicKey:s}=n,i=dr(e);if(t.feePayerAddress){let a=new Ye(t.rawTransaction,_nullishCoalesce(t.secondarySignerAddresses, () => ([])),t.feePayerAddress),c=[];r&&(c=r.map(w=>dr(w)));let d=dr(s),g=new wt(i,_nullishCoalesce(t.secondarySignerAddresses, () => ([])),c,{address:t.feePayerAddress,authenticator:d});return new Ee(a.raw_txn,g).bcsToBytes()}if(t.secondarySignerAddresses){let a=new Xe(t.rawTransaction,t.secondarySignerAddresses),c=[];c=r.map(g=>dr(g));let d=new Tt(i,t.secondarySignerAddresses,c);return new Ee(a.raw_txn,d).bcsToBytes()}let o;if(i instanceof fe)o=new qt(i.public_key,i.signature);else if(i instanceof j)o=new St(i);else throw new Error("Invalid public key");return new Ee(t.rawTransaction,o).bcsToBytes()}function Zi(n){let e=new We(n.rawTransaction.sender);if(n.feePayerAddress){let r=new Ye(n.rawTransaction,_nullishCoalesce(n.secondarySignerAddresses, () => ([])),n.feePayerAddress),s=[];n.secondarySignerAddresses&&(s=n.secondarySignerAddresses.map(a=>new We(a)));let i=new We(n.feePayerAddress),o=new wt(e,_nullishCoalesce(n.secondarySignerAddresses, () => ([])),s,{address:n.feePayerAddress,authenticator:i});return new Ee(r.raw_txn,o).bcsToBytes()}if(n.secondarySignerAddresses){let r=new Xe(n.rawTransaction,n.secondarySignerAddresses),s=[];s=n.secondarySignerAddresses.map(o=>new We(o));let i=new Tt(e,n.secondarySignerAddresses,s);return new Ee(r.raw_txn,i).bcsToBytes()}let t=new St(e);return new Ee(n.rawTransaction,t).bcsToBytes()}function dr(n){if(n instanceof I){if(n.publicKey instanceof E)return new j(n,new K(new _(new Uint8Array(64))));if(n.publicKey instanceof Be)return new j(n,new K(new De(new Uint8Array(64))))}return n instanceof de?new j(new I(n),new K(ze.getSimulationSignature())):new fe(new E(n.toUint8Array()),new _(new Uint8Array(64)))}function os(n){let{transaction:e,feePayerAuthenticator:t,additionalSignersAuthenticators:r}=n,s=Hs(N,n.senderAuthenticator),i;if(e.feePayerAddress){if(!t)throw new Error("Must provide a feePayerAuthenticator argument to generate a signed fee payer transaction");i=new wt(s,_nullishCoalesce(e.secondarySignerAddresses, () => ([])),_nullishCoalesce(r, () => ([])),{address:e.feePayerAddress,authenticator:t})}else if(e.secondarySignerAddresses){if(!r)throw new Error("Must provide a additionalSignersAuthenticators argument to generate a signed multi agent transaction");i=new Tt(s,e.secondarySignerAddresses,r)}else s instanceof fe?i=new qt(s.public_key,s.signature):i=new St(s);return new Ee(e.rawTransaction,i).bcsToBytes()}function Ji(n){let e=_sha3.sha3_256.create();for(let t of n)e.update(t);return e.digest()}var Rc=Ji(["ENDLESS::Transaction"]);function Fh(n){let e=os(n);return new p(Ji([Rc,new Uint8Array([0]),e])).toString()}async function eo({key:n,moduleAddress:e,moduleName:t,functionName:r,endlessConfig:s,abi:i,fetch:o}){return i!==void 0?i:$e(async()=>o(e,t,r,s),`${n}-${s.network}-${e}-${t}-${r}`,1e3*60*5)()}async function A(n){let e=await zc(n);return Kc(n,e)}async function zc(n){let{endlessConfig:e,data:t}=n,r,s;return"bytecode"in t?s=await lr(t):"multisigAddress"in t?(r={endlessConfig:e,multisigAddress:t.multisigAddress,function:t.function,functionArguments:t.functionArguments,typeArguments:t.typeArguments,abi:t.abi},s=await lr(r)):(r={endlessConfig:e,function:t.function,functionArguments:t.functionArguments,typeArguments:t.typeArguments,abi:t.abi},s=await lr(r)),s}async function Kc(n,e){let{endlessConfig:t,sender:r,options:s}=n,i;if(Bc(n)&&(i=u.ZERO.toString()),Dc(n)){let{secondarySignerAddresses:o}=n;return is({endlessConfig:t,sender:r,payload:e,options:s,secondarySignerAddresses:o,feePayerAddress:i})}return is({endlessConfig:t,sender:r,payload:e,options:s,feePayerAddress:i})}function Bc(n){return n.withFeePayer===!0}function Dc(n){return"secondarySignerAddresses"in n}function to(n){let{transaction:e}=n;return Ze(e)}function pr(n){let{signer:e,transaction:t}=n;return e.signTransactionWithAuthenticator(t)}async function as(n){let{endlessConfig:e,transaction:t,signerPublicKey:r,secondarySignersPublicKeys:s,feePayerPublicKey:i,options:o}=n,a=Yi({transaction:t,signerPublicKey:r,secondarySignersPublicKeys:s,feePayerPublicKey:i,options:o}),{data:c}=await Le({endlessConfig:e,body:a,path:"transactions/simulate",params:{estimate_gas_unit_price:_nullishCoalesce(_optionalChain([n, 'access', _120 => _120.options, 'optionalAccess', _121 => _121.estimateGasUnitPrice]), () => (!1)),estimate_max_gas_amount:_nullishCoalesce(_optionalChain([n, 'access', _122 => _122.options, 'optionalAccess', _123 => _123.estimateMaxGasAmount]), () => (!1)),estimate_prioritized_gas_unit_price:_nullishCoalesce(_optionalChain([n, 'access', _124 => _124.options, 'optionalAccess', _125 => _125.estimatePrioritizedGasUnitPrice]), () => (!1))},originMethod:"simulateTransaction",contentType:"application/x.endless.signed_transaction+bcs"});return c}async function no(n){let{endlessConfig:e,transaction:t}=n,r=Zi(t),{data:s}=await Le({endlessConfig:e,body:r,path:"transactions/simulate",params:{estimate_gas_unit_price:_nullishCoalesce(_optionalChain([n, 'access', _126 => _126.options, 'optionalAccess', _127 => _127.estimateGasUnitPrice]), () => (!1)),estimate_max_gas_amount:_nullishCoalesce(_optionalChain([n, 'access', _128 => _128.options, 'optionalAccess', _129 => _129.estimateMaxGasAmount]), () => (!1)),estimate_prioritized_gas_unit_price:_nullishCoalesce(_optionalChain([n, 'access', _130 => _130.options, 'optionalAccess', _131 => _131.estimatePrioritizedGasUnitPrice]), () => (!1))},originMethod:"simulateTransaction",contentType:"application/x.endless.signed_transaction+bcs"});return s}async function yn(n){let{endlessConfig:e}=n,t=os({...n}),{data:r}=await Le({endlessConfig:e,body:t,path:"transactions",originMethod:"submitTransaction",contentType:"application/x.endless.signed_transaction+bcs"});return r}async function Wt(n){let{endlessConfig:e,signer:t,transaction:r}=n;(t instanceof pe||t instanceof jn)&&await t.waitForProofFetch();let s=pr({signer:t,transaction:r});return yn({endlessConfig:e,transaction:r,senderAuthenticator:s})}var kc={typeParameters:[],parameters:[C.u8(),new C(C.u8())]};async function ro(n){let{endlessConfig:e,account:t,metadataBytes:r,moduleBytecode:s,options:i}=n,o=s.map(a=>b.U8(a));return A({endlessConfig:e,sender:u.from(t),data:{function:"0x1::code::publish_package_txn",functionArguments:[b.U8(r),new b(o)],abi:kc},options:i})}var Gc={typeParameters:[],parameters:[new we,C.u8(),new we,C.u8(),C.u8(),C.u8()]};async function so(n){let{endlessConfig:e,fromAccount:t,toNewPrivateKey:r}=n,s=await ve({endlessConfig:e,accountAddress:t.accountAddress}),i=Je.fromPrivateKey({privateKey:r,legacy:!0}),a=new Ln({sequenceNumber:BigInt(s.sequence_number),originator:t.accountAddress,currentAuthKey:u.from(s.authentication_key),newPublicKey:i.publicKey}).bcsToBytes(),c=t.sign(a),d=i.sign(a),g=await A({endlessConfig:e,sender:t.accountAddress,data:{function:"0x1::account::rotate_authentication_key",functionArguments:[new q(t.signingScheme),b.U8(t.publicKey.toUint8Array()),new q(i.signingScheme),b.U8(i.publicKey.toUint8Array()),b.U8(c.toUint8Array()),b.U8(d.toUint8Array())],abi:Gc}});return Wt({endlessConfig:e,signer:t,transaction:g})}var Nc={typeParameters:[{constraints:[]}],parameters:[new M,new J,te("0x1::object::Object")]};async function io(n){let{endlessConfig:e,sender:t,fungibleAssetMetadataAddress:r,recipient:s,amount:i,options:o}=n;return A({endlessConfig:e,sender:t,data:{function:"0x1::endless_account::transfer_coins",typeArguments:["0x1::fungible_asset::Metadata"],functionArguments:[s,i,r],abi:Nc},options:o})}async function oo(n,e){let{data:t}=await nn({endlessConfig:n,originMethod:"getCoinData",path:`coins/${e}`});return t}async function ao(n,e){let{data:t}=await It({endlessConfig:n,originMethod:"getCoinListDataById",path:"coins",body:e});return t}var fn=class{constructor(e){this.config=e}async transferCoinTransaction(e){return io({endlessConfig:this.config,...e})}async getCoinData(e){return oo(this.config,e)}async getCoinListDataById(e){return ao(this.config,e)}};var nt={BOOLEAN:"bool",U8:"u8",U16:"u16",U32:"u32",U64:"u64",U128:"u128",U256:"u256",ADDRESS:"address",STRING:"0x1::string::String",ARRAY:"vector<u8>"},ge="0x4::token::Token";async function co(n){let{endlessConfig:e,digitalAssetAddress:t}=n,r={token_data_id:{_eq:u.from(t).toStringLong()}};return(await f({endlessConfig:e,query:{query:mi,variables:{where_condition:r}},originMethod:"getDigitalAssetData"})).current_token_datas_v2[0]}async function uo(n){let{endlessConfig:e,digitalAssetAddress:t}=n,r={token_data_id:{_eq:u.from(t).toStringLong()},amount:{_gt:0}};return(await f({endlessConfig:e,query:{query:qr,variables:{where_condition:r}},originMethod:"getCurrentDigitalAssetOwnership"})).current_token_ownerships_v2[0]}async function lo(n){let{endlessConfig:e,ownerAddress:t,options:r}=n,s={owner_address:{_eq:u.from(t).toStringLong()},amount:{_gt:0}},i={query:qr,variables:{where_condition:s,offset:_optionalChain([r, 'optionalAccess', _132 => _132.offset]),limit:_optionalChain([r, 'optionalAccess', _133 => _133.limit]),order_by:_optionalChain([r, 'optionalAccess', _134 => _134.orderBy])}};return(await f({endlessConfig:e,query:i,originMethod:"getOwnedDigitalAssets"})).current_token_ownerships_v2}async function po(n){let{endlessConfig:e,digitalAssetAddress:t,options:r}=n,s={token_data_id:{_eq:u.from(t).toStringLong()}},i={query:gi,variables:{where_condition:s,offset:_optionalChain([r, 'optionalAccess', _135 => _135.offset]),limit:_optionalChain([r, 'optionalAccess', _136 => _136.limit]),order_by:_optionalChain([r, 'optionalAccess', _137 => _137.orderBy])}};return(await f({endlessConfig:e,query:i,originMethod:"getDigitalAssetActivity"})).token_activities_v2}var Mc={typeParameters:[],parameters:[new y(v()),new Se,new y(v()),new y(v()),new Q,new Q,new Q,new Q,new Q,new Q,new Q,new Q,new Q,new Se,new Se]};async function go(n){let{endlessConfig:e,options:t,creator:r}=n;return A({endlessConfig:e,sender:r.accountAddress,data:{function:"0x4::nft::create_collection",functionArguments:[new x(n.description),new H(_nullishCoalesce(n.maxSupply, () => (it))),new x(n.name),new x(n.uri),new U(_nullishCoalesce(n.mutableDescription, () => (!0))),new U(_nullishCoalesce(n.mutableRoyalty, () => (!0))),new U(_nullishCoalesce(n.mutableURI, () => (!0))),new U(_nullishCoalesce(n.mutableTokenDescription, () => (!0))),new U(_nullishCoalesce(n.mutableTokenName, () => (!0))),new U(_nullishCoalesce(n.mutableTokenProperties, () => (!0))),new U(_nullishCoalesce(n.mutableTokenURI, () => (!0))),new U(_nullishCoalesce(n.tokensBurnableByCreator, () => (!0))),new U(_nullishCoalesce(n.tokensFreezableByCreator, () => (!0))),new H(_nullishCoalesce(n.royaltyNumerator, () => (0))),new H(_nullishCoalesce(n.royaltyDenominator, () => (1)))],abi:Mc},options:t})}async function cs(n){let{endlessConfig:e,creatorAddress:t,collectionName:r,options:s}=n,i=u.from(t),o={collection_name:{_eq:r},creator_address:{_eq:i.toStringLong()}};return _optionalChain([s, 'optionalAccess', _138 => _138.tokenStandard])&&(o.token_standard={_eq:_nullishCoalesce(_optionalChain([s, 'optionalAccess', _139 => _139.tokenStandard]), () => ("v2"))}),(await f({endlessConfig:e,query:{query:Mr,variables:{where_condition:o}},originMethod:"getCollectionData"})).current_collections_v2[0]}async function mo(n){let{endlessConfig:e,collectionId:t}=n,s={collection_id:{_eq:u.from(t).toStringLong()}};return(await f({endlessConfig:e,query:{query:Mr,variables:{where_condition:s}},originMethod:"getCollectionData"})).current_collections_v2[0]}async function yo(n){return(await cs(n)).collection_id}var Oc={typeParameters:[],parameters:[new y(v()),new y(v()),new y(v()),new y(v()),new C(new y(v())),new C(new y(v())),new C(C.u8())]};async function fo(n){let{endlessConfig:e,options:t,creator:r,collection:s,description:i,name:o,uri:a,propertyKeys:c,propertyTypes:d,propertyValues:g}=n,w=_optionalChain([d, 'optionalAccess', _140 => _140.map, 'call', _141 => _141(S=>nt[S])]);return A({endlessConfig:e,sender:r.accountAddress,data:{function:"0x4::nft::mint",functionArguments:[new x(s),new x(i),new x(o),new x(a),b.MoveString(_nullishCoalesce(c, () => ([]))),b.MoveString(_nullishCoalesce(w, () => ([]))),Uo(_nullishCoalesce(g, () => ([])),_nullishCoalesce(w, () => ([])))],abi:Oc},options:t})}var Fc={typeParameters:[{constraints:["key"]}],parameters:[new y(ee(new k(0))),new M]};async function Ao(n){let{endlessConfig:e,sender:t,digitalAssetAddress:r,recipient:s,digitalAssetType:i,options:o}=n;return A({endlessConfig:e,sender:t.accountAddress,data:{function:"0x1::object::transfer",typeArguments:[_nullishCoalesce(i, () => (ge))],functionArguments:[u.from(r),u.from(s)],abi:Fc},options:o})}var qc={typeParameters:[],parameters:[new y(v()),new y(v()),new y(v()),new y(v()),new C(new y(v())),new C(new y(v())),new C(C.u8()),new M]};async function ho(n){let{endlessConfig:e,account:t,collection:r,description:s,name:i,uri:o,recipient:a,propertyKeys:c,propertyTypes:d,propertyValues:g,options:w}=n;if(_optionalChain([c, 'optionalAccess', _142 => _142.length])!==_optionalChain([g, 'optionalAccess', _143 => _143.length]))throw new Error("Property keys and property values counts do not match");if(_optionalChain([d, 'optionalAccess', _144 => _144.length])!==_optionalChain([g, 'optionalAccess', _145 => _145.length]))throw new Error("Property types and property values counts do not match");let S=_optionalChain([d, 'optionalAccess', _146 => _146.map, 'call', _147 => _147(m=>nt[m])]);return A({endlessConfig:e,sender:t.accountAddress,data:{function:"0x4::nft::mint_soul_bound",functionArguments:[r,s,i,o,b.MoveString(_nullishCoalesce(c, () => ([]))),b.MoveString(_nullishCoalesce(S, () => ([]))),Uo(_nullishCoalesce(g, () => ([])),_nullishCoalesce(S, () => ([]))),a],abi:qc},options:w})}var Hc={typeParameters:[{constraints:["key"]}],parameters:[new y(ee(new k(0)))]};async function bo(n){let{endlessConfig:e,creator:t,digitalAssetAddress:r,digitalAssetType:s,options:i}=n;return A({endlessConfig:e,sender:t.accountAddress,data:{function:"0x4::nft::burn",typeArguments:[_nullishCoalesce(s, () => (ge))],functionArguments:[u.from(r)],abi:Hc},options:i})}var Lc={typeParameters:[{constraints:["key"]}],parameters:[new y(ee(new k(0)))]};async function To(n){let{endlessConfig:e,creator:t,digitalAssetAddress:r,digitalAssetType:s,options:i}=n;return A({endlessConfig:e,sender:t.accountAddress,data:{function:"0x4::nft::freeze_transfer",typeArguments:[_nullishCoalesce(s, () => (ge))],functionArguments:[r],abi:Lc},options:i})}var $c={typeParameters:[{constraints:["key"]}],parameters:[new y(ee(new k(0)))]};async function wo(n){let{endlessConfig:e,creator:t,digitalAssetAddress:r,digitalAssetType:s,options:i}=n;return A({endlessConfig:e,sender:t.accountAddress,data:{function:"0x4::nft::unfreeze_transfer",typeArguments:[_nullishCoalesce(s, () => (ge))],functionArguments:[r],abi:$c},options:i})}var Vc={typeParameters:[{constraints:["key"]}],parameters:[new y(ee(new k(0))),new y(v())]};async function So(n){let{endlessConfig:e,creator:t,description:r,digitalAssetAddress:s,digitalAssetType:i,options:o}=n;return A({endlessConfig:e,sender:t.accountAddress,data:{function:"0x4::nft::set_description",typeArguments:[_nullishCoalesce(i, () => (ge))],functionArguments:[u.from(s),new x(r)],abi:Vc},options:o})}var Qc={typeParameters:[{constraints:["key"]}],parameters:[new y(ee(new k(0))),new y(v())]};async function xo(n){let{endlessConfig:e,creator:t,name:r,digitalAssetAddress:s,digitalAssetType:i,options:o}=n;return A({endlessConfig:e,sender:t.accountAddress,data:{function:"0x4::nft::set_name",typeArguments:[_nullishCoalesce(i, () => (ge))],functionArguments:[u.from(s),new x(r)],abi:Qc},options:o})}var Wc={typeParameters:[{constraints:["key"]}],parameters:[new y(ee(new k(0))),new y(v())]};async function _o(n){let{endlessConfig:e,creator:t,uri:r,digitalAssetAddress:s,digitalAssetType:i,options:o}=n;return A({endlessConfig:e,sender:t.accountAddress,data:{function:"0x4::nft::set_uri",typeArguments:[_nullishCoalesce(i, () => (ge))],functionArguments:[u.from(s),new x(r)],abi:Wc},options:o})}var jc={typeParameters:[{constraints:["key"]}],parameters:[new y(ee(new k(0))),new y(v()),new y(v()),C.u8()]};async function Eo(n){let{endlessConfig:e,creator:t,propertyKey:r,propertyType:s,propertyValue:i,digitalAssetAddress:o,digitalAssetType:a,options:c}=n;return A({endlessConfig:e,sender:t.accountAddress,data:{function:"0x4::nft::add_property",typeArguments:[_nullishCoalesce(a, () => (ge))],functionArguments:[u.from(o),new x(r),new x(nt[s]),b.U8(us(i,nt[s]))],abi:jc},options:c})}var Xc={typeParameters:[{constraints:["key"]}],parameters:[new y(ee(new k(0))),new y(v())]};async function vo(n){let{endlessConfig:e,creator:t,propertyKey:r,digitalAssetAddress:s,digitalAssetType:i,options:o}=n;return A({endlessConfig:e,sender:t.accountAddress,data:{function:"0x4::nft::remove_property",typeArguments:[_nullishCoalesce(i, () => (ge))],functionArguments:[u.from(s),new x(r)],abi:Xc},options:o})}var Yc={typeParameters:[{constraints:["key"]}],parameters:[new y(ee(new k(0))),new y(v()),new y(v()),C.u8()]};async function Co(n){let{endlessConfig:e,creator:t,propertyKey:r,propertyType:s,propertyValue:i,digitalAssetAddress:o,digitalAssetType:a,options:c}=n;return A({endlessConfig:e,sender:t.accountAddress,data:{function:"0x4::nft::update_property",typeArguments:[_nullishCoalesce(a, () => (ge))],functionArguments:[u.from(o),new x(r),new x(nt[s]),us(i,nt[s])],abi:Yc},options:c})}var Zc={typeParameters:[{constraints:["key"]},{constraints:[]}],parameters:[new y(ee(new k(0))),new y(v()),new k(1)]};async function Po(n){let{endlessConfig:e,creator:t,propertyKey:r,propertyType:s,propertyValue:i,digitalAssetAddress:o,digitalAssetType:a,options:c}=n;return A({endlessConfig:e,sender:t.accountAddress,data:{function:"0x4::nft::add_typed_property",typeArguments:[_nullishCoalesce(a, () => (ge)),nt[s]],functionArguments:[u.from(o),new x(r),i],abi:Zc},options:c})}var Jc={typeParameters:[{constraints:["key"]},{constraints:[]}],parameters:[new y(ee(new k(0))),new y(v()),new k(1)]};async function Io(n){let{endlessConfig:e,creator:t,propertyKey:r,propertyType:s,propertyValue:i,digitalAssetAddress:o,digitalAssetType:a,options:c}=n;return A({endlessConfig:e,sender:t.accountAddress,data:{function:"0x4::nft::update_typed_property",typeArguments:[_nullishCoalesce(a, () => (ge)),nt[s]],functionArguments:[u.from(o),new x(r),i],abi:Jc},options:c})}function Uo(n,e){let t=new Array;return e.forEach((r,s)=>{t.push(us(n[s],r))}),t}function us(n,e){let t=te(e);return Qt(n,t,0,[]).bcsToBytes()}var An=class{constructor(e){this.config=e}async getCollectionData(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"token_v2_processor"}),cs({endlessConfig:this.config,...e})}async getCollectionDataByCollectionId(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"token_v2_processor"}),mo({endlessConfig:this.config,...e})}async getCollectionId(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"token_v2_processor"}),yo({endlessConfig:this.config,...e})}async getDigitalAssetData(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"token_v2_processor"}),co({endlessConfig:this.config,...e})}async getCurrentDigitalAssetOwnership(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"token_v2_processor"}),uo({endlessConfig:this.config,...e})}async getOwnedDigitalAssets(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"token_v2_processor"}),lo({endlessConfig:this.config,...e})}async getDigitalAssetActivity(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"token_v2_processor"}),po({endlessConfig:this.config,...e})}async createCollectionTransaction(e){return go({endlessConfig:this.config,...e})}async mintDigitalAssetTransaction(e){return fo({endlessConfig:this.config,...e})}async transferDigitalAssetTransaction(e){return Ao({endlessConfig:this.config,...e})}async mintSoulBoundTransaction(e){return ho({endlessConfig:this.config,...e})}async burnDigitalAssetTransaction(e){return bo({endlessConfig:this.config,...e})}async freezeDigitalAssetTransaferTransaction(e){return To({endlessConfig:this.config,...e})}async unfreezeDigitalAssetTransaferTransaction(e){return wo({endlessConfig:this.config,...e})}async setDigitalAssetDescriptionTransaction(e){return So({endlessConfig:this.config,...e})}async setDigitalAssetNameTransaction(e){return xo({endlessConfig:this.config,...e})}async setDigitalAssetURITransaction(e){return _o({endlessConfig:this.config,...e})}async addDigitalAssetPropertyTransaction(e){return Eo({endlessConfig:this.config,...e})}async removeDigitalAssetPropertyTransaction(e){return vo({endlessConfig:this.config,...e})}async updateDigitalAssetPropertyTransaction(e){return Co({endlessConfig:this.config,...e})}async addDigitalAssetTypedPropertyTransaction(e){return Po({endlessConfig:this.config,...e})}async updateDigitalAssetTypedPropertyTransaction(e){return Io({endlessConfig:this.config,...e})}};var Ro=300,eu=n=>{if(n&&n.length>Ro)throw new Error(`Event type length exceeds the maximum length of ${Ro}`)};async function zo(n){let{endlessConfig:e,eventType:t,options:r}=n,i={where:{account_address:{_eq:"0x0000000000000000000000000000000000000000000000000000000000000000"},creation_number:{_eq:"0"},sequence_number:{_eq:"0"},indexed_type:{_eq:t}},pagination:r,orderBy:_optionalChain([r, 'optionalAccess', _148 => _148.orderBy])};return hn({endlessConfig:e,options:i})}async function Ko(n){let{accountAddress:e,endlessConfig:t,creationNumber:r,options:s}=n,a={where:{account_address:{_eq:u.from(e).toStringLong()},creation_number:{_eq:r}},pagination:s,orderBy:_optionalChain([s, 'optionalAccess', _149 => _149.orderBy])};return hn({endlessConfig:t,options:a})}async function Bo(n){let{accountAddress:e,endlessConfig:t,eventType:r,options:s}=n,a={where:{account_address:{_eq:u.from(e).toStringLong()},indexed_type:{_eq:r}},pagination:s,orderBy:_optionalChain([s, 'optionalAccess', _150 => _150.orderBy])};return hn({endlessConfig:t,options:a})}async function hn(n){let{endlessConfig:e,options:t}=n;eu(_optionalChain([t, 'optionalAccess', _151 => _151.where, 'optionalAccess', _152 => _152.indexed_type, 'optionalAccess', _153 => _153._eq]));let r={query:ci,variables:{where_condition:_optionalChain([t, 'optionalAccess', _154 => _154.where]),offset:_optionalChain([t, 'optionalAccess', _155 => _155.offset]),limit:_optionalChain([t, 'optionalAccess', _156 => _156.limit]),order_by:_optionalChain([t, 'optionalAccess', _157 => _157.orderBy])}};return(await f({endlessConfig:e,query:r,originMethod:"getEvents"})).events}var bn=class{constructor(e){this.config=e}async getModuleEventsByEventType(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"events_processor"}),zo({endlessConfig:this.config,...e})}async getAccountEventsByCreationNumber(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"events_processor"}),Ko({endlessConfig:this.config,...e})}async getAccountEventsByEventType(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"events_processor"}),Bo({endlessConfig:this.config,...e})}async getEvents(e){return await h({config:this.config,minimumLedgerVersion:_optionalChain([e, 'optionalAccess', _158 => _158.minimumLedgerVersion]),processorType:"events_processor"}),hn({endlessConfig:this.config,...e})}};var tu={typeParameters:[{constraints:["key"]}],parameters:[te("0x1::object::Object"),new M,new J]};async function ds(n){let{endlessConfig:e,options:t}=n,r={query:di,variables:{where_condition:_optionalChain([t, 'optionalAccess', _159 => _159.where]),limit:_optionalChain([t, 'optionalAccess', _160 => _160.limit]),offset:_optionalChain([t, 'optionalAccess', _161 => _161.offset])}};return(await f({endlessConfig:e,query:r,originMethod:"getFungibleAssetMetadata"})).fungible_asset_metadata}async function Do(n){let{endlessConfig:e,options:t}=n,r={query:ui,variables:{where_condition:_optionalChain([t, 'optionalAccess', _162 => _162.where]),limit:_optionalChain([t, 'optionalAccess', _163 => _163.limit]),offset:_optionalChain([t, 'optionalAccess', _164 => _164.offset])}};return(await f({endlessConfig:e,query:r,originMethod:"getFungibleAssetActivities"})).fungible_asset_activities}async function ko(n){let{endlessConfig:e,options:t}=n,r={query:oi,variables:{where_condition:_optionalChain([t, 'optionalAccess', _165 => _165.where]),limit:_optionalChain([t, 'optionalAccess', _166 => _166.limit]),offset:_optionalChain([t, 'optionalAccess', _167 => _167.offset])}};return(await f({endlessConfig:e,query:r,originMethod:"getCurrentFungibleAssetBalances"})).current_fungible_asset_balances}async function Go(n){let{endlessConfig:e,sender:t,fungibleAssetMetadataAddress:r,recipient:s,amount:i,options:o}=n;return A({endlessConfig:e,sender:t.accountAddress,data:{function:"0x1::primary_fungible_store::transfer",typeArguments:["0x1::fungible_asset::Metadata"],functionArguments:[r,s,i],abi:tu},options:o})}var Tn=class{constructor(e){this.config=e}async getFungibleAssetMetadata(e){return await h({config:this.config,minimumLedgerVersion:_optionalChain([e, 'optionalAccess', _168 => _168.minimumLedgerVersion]),processorType:"fungible_asset_processor"}),ds({endlessConfig:this.config,...e})}async getFungibleAssetMetadataByAssetType(e){return await h({config:this.config,minimumLedgerVersion:_optionalChain([e, 'optionalAccess', _169 => _169.minimumLedgerVersion]),processorType:"fungible_asset_processor"}),(await ds({endlessConfig:this.config,options:{where:{asset_type:{_eq:e.assetType}}}}))[0]}async getFungibleAssetActivities(e){return await h({config:this.config,minimumLedgerVersion:_optionalChain([e, 'optionalAccess', _170 => _170.minimumLedgerVersion]),processorType:"fungible_asset_processor"}),Do({endlessConfig:this.config,...e})}async getCurrentFungibleAssetBalances(e){return await h({config:this.config,minimumLedgerVersion:_optionalChain([e, 'optionalAccess', _171 => _171.minimumLedgerVersion]),processorType:"fungible_asset_processor"}),ko({endlessConfig:this.config,...e})}async transferFungibleAsset(e){return Go({endlessConfig:this.config,...e})}};async function Pe(n){let{endlessConfig:e,payload:t,options:r}=n,s=await Xi({...t,endlessConfig:e}),i=new F;s.serialize(i);let o=i.toUint8Array(),{data:a}=await Le({endlessConfig:e,path:"view",originMethod:"view",contentType:"application/x.endless.view_function+bcs",params:{ledger_version:_optionalChain([r, 'optionalAccess', _172 => _172.ledgerVersion])},body:o});return a}var wn=class{constructor(e){this.config=e}async getLedgerInfo(){return Yn({endlessConfig:this.config})}async getChainId(){return(await this.getLedgerInfo()).chain_id}async getBlockByVersion(e){return Gi({endlessConfig:this.config,...e})}async getBlockByHeight(e){return Ni({endlessConfig:this.config,...e})}async view(e){return Pe({endlessConfig:this.config,...e})}async getChainTopUserTransactions(e){return yi({endlessConfig:this.config,...e})}async queryIndexer(e){return f({endlessConfig:this.config,...e})}async getIndexerLastSuccessVersion(){return Zn({endlessConfig:this.config})}async getProcessorStatus(e){return Jn({endlessConfig:this.config,processorType:e})}};var No=["A name must be between 3 and 63 characters long,","and can only contain lowercase a-z, 0-9, and hyphens.","A name may not start or end with a hyphen."].join(" ");function Mo(n){return!(!n||n.length<3||n.length>63||!/^[a-z\d][a-z\d-]{1,61}[a-z\d]$/.test(n))}function rt(n){let[e,t,...r]=n.replace(/\.apt$/,"").split(".");if(r.length>0)throw new Error(`${n} is invalid. A name can only have two parts, a domain and a subdomain separated by a "."`);if(!Mo(e))throw new Error(`${e} is not valid. ${No}`);if(t&&!Mo(t))throw new Error(`${t} is not valid. ${No}`);return{domainName:t||e,subdomainName:t?e:void 0}}var nu="0x585fc9f0f0c54183b039ffc770ca282ebd87307916c215a3e692f2f8e4305e82",ru={testnet:"0x5f8fd2347449685cf41d4db97926ec3a096eaf381332be4f1318ad4d16a8497c",mainnet:"0x867ed1f6bf916171b1de3ee92849b8978b7d1b9e0a8cc982a3d19d535dfd9c0c",local:nu,custom:null,devnet:null};function Oe(n){let e=ru[n.network];if(!e)throw new Error(`The ANS contract is not deployed to ${n.network}`);return e}var gr=n=>{if(n&&typeof n=="object"&&"vec"in n&&Array.isArray(n.vec))return n.vec[0]};async function Oo(n){let{endlessConfig:e,name:t}=n,r=Oe(e),{domainName:s,subdomainName:i}=rt(t),o=await Pe({endlessConfig:e,payload:{function:`${r}::router::get_owner_addr`,functionArguments:[s,i]}}),a=gr(o[0]);return a?u.from(a):void 0}async function Fo(n){let{endlessConfig:e,expiration:t,name:r,sender:s,targetAddress:i,toAddress:o,options:a,transferable:c}=n,d=Oe(e),{domainName:g,subdomainName:w}=rt(r),S=t.policy==="subdomain:independent"||t.policy==="subdomain:follow-domain";if(w&&!S)throw new Error("Subdomains must have an expiration policy of either 'subdomain:independent' or 'subdomain:follow-domain'");if(S&&!w)throw new Error(`Policy is set to ${t.policy} but no subdomain was provided`);if(t.policy==="domain"){let st=_nullishCoalesce(t.years, () => (1));if(st!==1)throw new Error("For now, names can only be registered for 1 year at a time");let ia=st*31536e3;return await A({endlessConfig:e,sender:s.accountAddress.toString(),data:{function:`${d}::router::register_domain`,functionArguments:[g,ia,i,o]},options:a})}if(!w)throw new Error(`${t.policy} requires a subdomain to be provided.`);let m=await ls({endlessConfig:e,name:g});if(!m)throw new Error("The domain does not exist");let P=t.policy==="subdomain:independent"?t.expirationDate:m;if(P>m)throw new Error("The subdomain expiration time cannot be greater than the domain expiration time");return await A({endlessConfig:e,sender:s.accountAddress.toString(),data:{function:`${d}::router::register_subdomain`,functionArguments:[g,w,Math.round(P/1e3),t.policy==="subdomain:follow-domain"?1:0,!!c,i,o]},options:a})}async function ls(n){let{endlessConfig:e,name:t}=n,r=Oe(e),{domainName:s,subdomainName:i}=rt(t);try{let o=await Pe({endlessConfig:e,payload:{function:`${r}::router::get_expiration`,functionArguments:[s,i]}});return Number(o[0])*1e3}catch (e5){return}}async function qo(n){let{endlessConfig:e,address:t}=n,r=Oe(e),s=await Pe({endlessConfig:e,payload:{function:`${r}::router::get_primary_name`,functionArguments:[u.from(t).toString()]}}),i=gr(s[1]),o=gr(s[0]);if(i)return[o,i].filter(Boolean).join(".")}async function Ho(n){let{endlessConfig:e,sender:t,name:r,options:s}=n,i=Oe(e);if(!r)return await A({endlessConfig:e,sender:t.accountAddress.toString(),data:{function:`${i}::router::clear_primary_name`,functionArguments:[]},options:s});let{domainName:o,subdomainName:a}=rt(r);return await A({endlessConfig:e,sender:t.accountAddress.toString(),data:{function:`${i}::router::set_primary_name`,functionArguments:[o,a]},options:s})}async function Lo(n){let{endlessConfig:e,name:t}=n,r=Oe(e),{domainName:s,subdomainName:i}=rt(t),o=await Pe({endlessConfig:e,payload:{function:`${r}::router::get_target_addr`,functionArguments:[s,i]}}),a=gr(o[0]);return a?u.from(a):void 0}async function $o(n){let{endlessConfig:e,sender:t,name:r,address:s,options:i}=n,o=Oe(e),{domainName:a,subdomainName:c}=rt(r);return await A({endlessConfig:e,sender:t.accountAddress.toString(),data:{function:`${o}::router::set_target_addr`,functionArguments:[a,c,s]},options:i})}async function Vo(n){let{endlessConfig:e,name:t}=n,{domainName:r,subdomainName:s=""}=rt(t),a=(await f({endlessConfig:e,query:{query:Vt,variables:{where_condition:{domain:{_eq:r},subdomain:{_eq:s},is_active:{_eq:!0}},limit:1}},originMethod:"getName"})).current_endless_names[0];return a&&(a=Sn(a)),a}async function Qo(n){let{endlessConfig:e,options:t,accountAddress:r}=n,s=await ps({endlessConfig:e});return(await f({endlessConfig:e,originMethod:"getAccountNames",query:{query:Vt,variables:{limit:_optionalChain([t, 'optionalAccess', _173 => _173.limit]),offset:_optionalChain([t, 'optionalAccess', _174 => _174.offset]),order_by:_optionalChain([t, 'optionalAccess', _175 => _175.orderBy]),where_condition:{..._nullishCoalesce(_optionalChain([n, 'access', _176 => _176.options, 'optionalAccess', _177 => _177.where]), () => ({})),owner_address:{_eq:r.toString()},expiration_timestamp:{_gte:s}}}}})).current_endless_names.map(Sn)}async function Wo(n){let{endlessConfig:e,options:t,accountAddress:r}=n,s=await ps({endlessConfig:e});return(await f({endlessConfig:e,originMethod:"getAccountDomains",query:{query:Vt,variables:{limit:_optionalChain([t, 'optionalAccess', _178 => _178.limit]),offset:_optionalChain([t, 'optionalAccess', _179 => _179.offset]),order_by:_optionalChain([t, 'optionalAccess', _180 => _180.orderBy]),where_condition:{..._nullishCoalesce(_optionalChain([n, 'access', _181 => _181.options, 'optionalAccess', _182 => _182.where]), () => ({})),owner_address:{_eq:r.toString()},expiration_timestamp:{_gte:s},subdomain:{_eq:""}}}}})).current_endless_names.map(Sn)}async function jo(n){let{endlessConfig:e,options:t,accountAddress:r}=n,s=await ps({endlessConfig:e});return(await f({endlessConfig:e,originMethod:"getAccountSubdomains",query:{query:Vt,variables:{limit:_optionalChain([t, 'optionalAccess', _183 => _183.limit]),offset:_optionalChain([t, 'optionalAccess', _184 => _184.offset]),order_by:_optionalChain([t, 'optionalAccess', _185 => _185.orderBy]),where_condition:{..._nullishCoalesce(_optionalChain([n, 'access', _186 => _186.options, 'optionalAccess', _187 => _187.where]), () => ({})),owner_address:{_eq:r.toString()},expiration_timestamp:{_gte:s},subdomain:{_neq:""}}}}})).current_endless_names.map(Sn)}async function Xo(n){let{endlessConfig:e,options:t,domain:r}=n;return(await f({endlessConfig:e,originMethod:"getDomainSubdomains",query:{query:Vt,variables:{limit:_optionalChain([t, 'optionalAccess', _188 => _188.limit]),offset:_optionalChain([t, 'optionalAccess', _189 => _189.offset]),order_by:_optionalChain([t, 'optionalAccess', _190 => _190.orderBy]),where_condition:{..._nullishCoalesce(_optionalChain([n, 'access', _191 => _191.options, 'optionalAccess', _192 => _192.where]), () => ({})),domain:{_eq:r},subdomain:{_neq:""},is_active:{_eq:!0}}}}})).current_endless_names.map(Sn)}async function ps(n){let{endlessConfig:e}=n,t=Oe(e),[r]=await Pe({endlessConfig:e,payload:{function:`${t}::config::reregistration_grace_sec`,functionArguments:[]}}),s=r/60/60/24,i=()=>new Date;return new Date(i().setDate(i().getDate()-s)).toISOString()}async function Yo(n){let{endlessConfig:e,sender:t,name:r,years:s=1,options:i}=n,o=Oe(e),a=s*31536e3,{domainName:c,subdomainName:d}=rt(r);if(d)throw new Error("Subdomains cannot be renewed");if(s!==1)throw new Error("Currently, only 1 year renewals are supported");return await A({endlessConfig:e,sender:t.accountAddress.toString(),data:{function:`${o}::router::renew_domain`,functionArguments:[c,a]},options:i})}function Sn(n){return{...n,expiration_timestamp:new Date(n.expiration_timestamp).getTime()}}var xn=class{constructor(e){this.config=e}async getOwnerAddress(e){return Oo({endlessConfig:this.config,...e})}async getExpiration(e){return ls({endlessConfig:this.config,...e})}async getTargetAddress(e){return Lo({endlessConfig:this.config,...e})}async setTargetAddress(e){return $o({endlessConfig:this.config,...e})}async getPrimaryName(e){return qo({endlessConfig:this.config,...e})}async setPrimaryName(e){return Ho({endlessConfig:this.config,...e})}async registerName(e){return Fo({endlessConfig:this.config,...e})}async renewDomain(e){return Yo({endlessConfig:this.config,...e})}async getName(e){return Vo({endlessConfig:this.config,...e})}async getAccountNames(e){return Qo({endlessConfig:this.config,...e})}async getAccountDomains(e){return Wo({endlessConfig:this.config,...e})}async getAccountSubdomains(e){return jo({endlessConfig:this.config,...e})}async getDomainSubdomains(e){return Xo({endlessConfig:this.config,...e})}};async function Zo(n){let{endlessConfig:e,poolAddress:t}=n,r=u.from(t).toStringLong(),i=await f({endlessConfig:e,query:{query:Or,variables:{where_condition:{pool_address:{_eq:r}}}}});return i.num_active_delegator_per_pool[0]?i.num_active_delegator_per_pool[0].num_active_delegator:0}async function Jo(n){let{endlessConfig:e,options:t}=n,r={query:Or,variables:{order_by:_optionalChain([t, 'optionalAccess', _193 => _193.orderBy])}};return(await f({endlessConfig:e,query:r})).num_active_delegator_per_pool}async function ea(n){let{endlessConfig:e,delegatorAddress:t,poolAddress:r}=n,s={query:ai,variables:{delegatorAddress:u.from(t).toStringLong(),poolAddress:u.from(r).toStringLong()}};return(await f({endlessConfig:e,query:s})).delegated_staking_activities}var _n=class{constructor(e){this.config=e}async getNumberOfDelegators(e){return await h({config:this.config,minimumLedgerVersion:_optionalChain([e, 'optionalAccess', _194 => _194.minimumLedgerVersion]),processorType:"stake_processor"}),Zo({endlessConfig:this.config,...e})}async getNumberOfDelegatorsForAllPools(e){return await h({config:this.config,minimumLedgerVersion:_optionalChain([e, 'optionalAccess', _195 => _195.minimumLedgerVersion]),processorType:"stake_processor"}),Jo({endlessConfig:this.config,...e})}async getDelegatedStakingActivities(e){return await h({config:this.config,minimumLedgerVersion:_optionalChain([e, 'optionalAccess', _196 => _196.minimumLedgerVersion]),processorType:"stake_processor"}),ea({endlessConfig:this.config,...e})}};var mr=class{constructor(e){this.config=e}async simple(e){return A({endlessConfig:this.config,...e})}async multiAgent(e){return A({endlessConfig:this.config,...e})}};function yr(n,e,t){let r=t.value;return t.value=async function(...s){let[i]=s;if(i.transaction.feePayerAddress&&!i.feePayerAuthenticator)throw new Error("You are submitting a Fee Payer transaction but missing the feePayerAuthenticator");return r.apply(this,s)},t}function fr(n,e,t){let r=t.value;return t.value=async function(...s){let[i]=s;if(i.transaction.feePayerAddress&&!i.feePayerPublicKey)throw new Error("You are simulating a Fee Payer transaction but missing the feePayerPublicKey");return r.apply(this,s)},t}var xt=class{constructor(e){this.config=e}async simple(e){return as({endlessConfig:this.config,...e})}async multiAgent(e){return as({endlessConfig:this.config,...e})}async mock(e){return no({endlessConfig:this.config,...e})}};L([fr],xt.prototype,"simple",1),L([fr],xt.prototype,"multiAgent",1),L([fr],xt.prototype,"mock",1);var _t=class{constructor(e){this.config=e}async simple(e){return yn({endlessConfig:this.config,...e})}async multiAgent(e){return yn({endlessConfig:this.config,...e})}async multiAuthKey(e){let{transaction:t,publicKeys:r,signatures:s}=e,i=new Ge(new Qe({publicKeys:r}),new ke({signatures:s}));return yn({endlessConfig:this.config,transaction:t,senderAuthenticator:i})}};L([yr],_t.prototype,"simple",1),L([yr],_t.prototype,"multiAgent",1),L([yr],_t.prototype,"multiAuthKey",1);var Ar=()=>Math.floor(Date.now()/1e3),hr= exports.AccountSequenceNumber =class{constructor(e,t,r,s,i){this.lastUncommintedNumber=null;this.currentNumber=null;this.lock=!1;this.endlessConfig=e,this.account=t,this.maxWaitTime=r,this.maximumInFlight=s,this.sleepTime=i}async nextSequenceNumber(){for(;this.lock;)await et(this.sleepTime);this.lock=!0;let e=BigInt(0);try{if((this.lastUncommintedNumber===null||this.currentNumber===null)&&await this.initialize(),this.currentNumber-this.lastUncommintedNumber>=this.maximumInFlight){await this.update();let t=Ar();for(;this.currentNumber-this.lastUncommintedNumber>=this.maximumInFlight;)await et(this.sleepTime),Ar()-t>this.maxWaitTime?(console.warn(`Waited over 30 seconds for a transaction to commit, resyncing ${this.account.accountAddress.toString()}`),await this.initialize()):await this.update()}e=this.currentNumber,this.currentNumber+=BigInt(1)}catch(t){console.error("error in getting next sequence number for this account",t)}finally{this.lock=!1}return e}async initialize(){let{sequence_number:e}=await ve({endlessConfig:this.endlessConfig,accountAddress:this.account.accountAddress});this.currentNumber=BigInt(e),this.lastUncommintedNumber=BigInt(e)}async update(){let{sequence_number:e}=await ve({endlessConfig:this.endlessConfig,accountAddress:this.account.accountAddress});return this.lastUncommintedNumber=BigInt(e),this.lastUncommintedNumber}async synchronize(){if(this.lastUncommintedNumber!==this.currentNumber){for(;this.lock;)await et(this.sleepTime);this.lock=!0;try{await this.update();let e=Ar();for(;this.lastUncommintedNumber!==this.currentNumber;)Ar()-e>this.maxWaitTime?(console.warn(`Waited over 30 seconds for a transaction to commit, resyncing ${this.account.accountAddress.toString()}`),await this.initialize()):(await et(this.sleepTime),await this.update())}catch(e){console.error("error in synchronizing this account sequence number with the one on chain",e)}finally{this.lock=!1}}}};var jt=class{constructor(){this.queue=[];this.pendingDequeue=[];this.cancelled=!1}enqueue(e){if(this.cancelled=!1,this.pendingDequeue.length>0){_optionalChain([this, 'access', _197 => _197.pendingDequeue, 'access', _198 => _198.shift, 'call', _199 => _199(), 'optionalAccess', _200 => _200.resolve, 'call', _201 => _201(e)]);return}this.queue.push(e)}async dequeue(){return this.queue.length>0?Promise.resolve(this.queue.shift()):new Promise((e,t)=>{this.pendingDequeue.push({resolve:e,reject:t})})}isEmpty(){return this.queue.length===0}cancel(){this.cancelled=!0,this.pendingDequeue.forEach(async({reject:e})=>{e(new Xt("Task cancelled"))}),this.pendingDequeue=[],this.queue.length=0}isCancelled(){return this.cancelled}pendingDequeueLength(){return this.pendingDequeue.length}},Xt=class extends Error{};var ta="fulfilled",na= exports.TransactionWorkerEventsEnum =(i=>(i.TransactionSent="transactionSent",i.TransactionSendFailed="transactionSendFailed",i.TransactionExecuted="transactionExecuted",i.TransactionExecutionFailed="transactionExecutionFailed",i.ExecutionFinish="executionFinish",i))(na||{}),br= exports.TransactionWorker =class extends _eventemitter32.default{constructor(t,r,s=30,i=100,o=10){super();this.taskQueue=new jt;this.transactionsQueue=new jt;this.outstandingTransactions=new jt;this.sentTransactions=[];this.executedTransactions=[];this.endlessConfig=t,this.account=r,this.started=!1,this.accountSequnceNumber=new hr(t,r,s,i,o)}async submitNextTransaction(){try{for(;;){let t=await this.accountSequnceNumber.nextSequenceNumber();if(t===null)return;let r=await this.generateNextTransaction(this.account,t);if(!r)return;let s=Wt({endlessConfig:this.endlessConfig,transaction:r,signer:this.account});await this.outstandingTransactions.enqueue([s,t])}}catch(t){if(t instanceof Xt)return;throw new Error(`Submit transaction failed for ${this.account.accountAddress.toString()} with error ${t}`)}}async processTransactions(){try{for(;;){let t=[],r=[],[s,i]=await this.outstandingTransactions.dequeue();for(t.push(s),r.push(i);!this.outstandingTransactions.isEmpty();)[s,i]=await this.outstandingTransactions.dequeue(),t.push(s),r.push(i);let o=await Promise.allSettled(t);for(let a=0;a<o.length&&a<r.length;a+=1){let c=o[a];i=r[a],c.status===ta?(this.sentTransactions.push([c.value.hash,i,null]),this.emit("transactionSent",{message:`transaction hash ${c.value.hash} has been committed to chain`,transactionHash:c.value.hash}),await this.checkTransaction(c,i)):(this.sentTransactions.push([c.status,i,c.reason]),this.emit("transactionSendFailed",{message:`failed to commit transaction ${this.sentTransactions.length} with error ${c.reason}`,error:c.reason}))}this.emit("executionFinish",{message:`execute ${o.length} transactions finished`})}}catch(t){if(t instanceof Xt)return;throw new Error(`Process execution failed for ${this.account.accountAddress.toString()} with error ${t}`)}}async checkTransaction(t,r){try{let s=[];s.push(sr({endlessConfig:this.endlessConfig,transactionHash:t.value.hash}));let i=await Promise.allSettled(s);for(let o=0;o<i.length;o+=1){let a=i[o];a.status===ta?(this.executedTransactions.push([a.value.hash,r,null]),this.emit("transactionExecuted",{message:`transaction hash ${a.value.hash} has been executed on chain`,transactionHash:t.value.hash})):(this.executedTransactions.push([a.status,r,a.reason]),this.emit("transactionExecutionFailed",{message:`failed to execute transaction ${this.executedTransactions.length} with error ${a.reason}`,error:a.reason}))}}catch(s){throw new Error(`Check transaction failed for ${this.account.accountAddress.toString()} with error ${s}`)}}async push(t,r){this.transactionsQueue.enqueue([t,r])}async generateNextTransaction(t,r){if(this.transactionsQueue.isEmpty())return;let[s,i]=await this.transactionsQueue.dequeue();return A({endlessConfig:this.endlessConfig,sender:t.accountAddress,data:s,options:{...i,accountSequenceNumber:r}})}async run(){try{for(;!this.taskQueue.isCancelled();)await(await this.taskQueue.dequeue())()}catch(t){throw new Error(`Unable to start transaction batching: ${t}`)}}start(){if(this.started)throw new Error("worker has already started");this.started=!0,this.taskQueue.enqueue(()=>this.submitNextTransaction()),this.taskQueue.enqueue(()=>this.processTransactions()),this.run()}stop(){if(this.taskQueue.isCancelled())throw new Error("worker has already stopped");this.started=!1,this.taskQueue.cancel()}};var Tr=class extends _eventemitter32.default{constructor(e){super(),this.config=e}start(e){let{sender:t}=e;this.account=t,this.transactionWorker=new br(this.config,t),this.transactionWorker.start(),this.registerToEvents()}push(e){let{data:t,options:r}=e;for(let s of t)this.transactionWorker.push(s,r)}registerToEvents(){this.transactionWorker.on("transactionSent",async e=>{this.emit("transactionSent",e)}),this.transactionWorker.on("transactionSendFailed",async e=>{this.emit("transactionSendFailed",e)}),this.transactionWorker.on("transactionExecuted",async e=>{this.emit("transactionExecuted",e)}),this.transactionWorker.on("transactionExecutionFailed",async e=>{this.emit("transactionExecutionFailed",e)}),this.transactionWorker.on("executionFinish",async e=>{this.emit("executionFinish",e)})}forSingleAccount(e){try{let{sender:t,data:r,options:s}=e;this.start({sender:t}),this.push({data:r,options:s})}catch(t){throw new Error(`failed to submit transactions with error: ${t}`)}}};var En=class{constructor(e){this.config=e,this.build=new mr(this.config),this.simulate=new xt(this.config),this.submit=new _t(this.config),this.batch=new Tr(this.config)}async getTransactions(e){return Qr({endlessConfig:this.config,...e})}async getTransactionByVersion(e){return Bi({endlessConfig:this.config,...e})}async getTransactionByHash(e){return ln({endlessConfig:this.config,...e})}async isPendingTransaction(e){return Di({endlessConfig:this.config,...e})}async waitForTransaction(e){return sr({endlessConfig:this.config,...e})}async getGasPriceEstimation(){return rr({endlessConfig:this.config})}getSigningMessage(e){return to(e)}async publishPackageTransaction(e){return ro({endlessConfig:this.config,...e})}async rotateAuthKey(e){return so({endlessConfig:this.config,...e})}sign(e){return pr({...e})}signAsFeePayer(e){let{signer:t,transaction:r}=e;if(!r.feePayerAddress)throw new Error(`Transaction ${r} is not a Fee Payer transaction`);return r.feePayerAddress=t.accountAddress,pr({signer:t,transaction:r})}async batchTransactionsForSingleAccount(e){try{let{sender:t,data:r,options:s}=e;this.batch.forSingleAccount({sender:t,data:r,options:s})}catch(t){throw new Error(`failed to submit transactions with error: ${t}`)}}async signAndSubmitTransaction(e){let{signer:t,transaction:r}=e;return Wt({endlessConfig:this.config,signer:t,transaction:r})}async fundAccount(e){let{signer:t,address:r}=e,s={typeParameters:[],parameters:[new M]},i=await this.build.simple({sender:t.accountAddress,data:{function:"0x1::faucet::fund",functionArguments:[r||t.accountAddress],abi:s}});return Wt({endlessConfig:this.config,signer:t,transaction:i})}};var vn=class{constructor(e){this.config=e}async getTableItem(e){return er({endlessConfig:this.config,...e})}async getTableItemsData(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"default_processor"}),fi({endlessConfig:this.config,...e})}async getTableItemsMetadata(e){return await h({config:this.config,minimumLedgerVersion:e.minimumLedgerVersion,processorType:"default_processor"}),Ai({endlessConfig:this.config,...e})}};var ou={typeParameters:[],parameters:[new M,new J]},au={typeParameters:[{constraints:["key"]}],parameters:[new M,new J,te("0x1::object::Object")]};async function ra(n){let{endlessConfig:e,sender:t,recipient:r,amount:s,options:i}=n;return A({endlessConfig:e,sender:t.accountAddress,data:{function:"0x1::endless_account::transfer",functionArguments:[r,s],abi:ou},options:i})}async function sa(n){let{endlessConfig:e,sender:t,fungibleAssetMetadataAddress:r,recipient:s,amount:i,options:o}=n;return A({endlessConfig:e,sender:t.accountAddress,data:{function:"0x1::endless_account::transfer_coins",typeArguments:["0x1::fungible_asset::Metadata"],functionArguments:[s,i,r],abi:au},options:o})}async function gs(n){let{endlessConfig:e,account:t,fungibleAssetMetadataAddress:r}=n,s={function:"0x1::primary_fungible_store::balance",functionArguments:[t.toString(),r.toString()],typeArguments:["0x1::fungible_asset::Metadata"]},i=(await Pe({endlessConfig:e,payload:s}))[0];return BigInt(i)}var Cn=class{constructor(e){this.config=e}async transferEDS(e){return ra({endlessConfig:this.config,...e})}async transferCoin(e){return sa({endlessConfig:this.config,...e})}async viewCoinBalance(e,t){return gs({endlessConfig:this.config,account:e,fungibleAssetMetadataAddress:t})}async viewEDSBalance(e){return gs({endlessConfig:this.config,account:e,fungibleAssetMetadataAddress:u.from("ENDLESSsssssssssssssssssssssssssssssssssssss")})}};var ne=class{constructor(e){this.config=new ir(e),this.account=new pn(this.config),this.ans=new xn(this.config),this.coin=new fn(this.config),this.digitalAsset=new An(this.config),this.endlessAccount=new Cn(this.config),this.event=new bn(this.config),this.fungibleAsset=new Tn(this.config),this.general=new wn(this.config),this.staking=new _n(this.config),this.transaction=new En(this.config),this.table=new vn(this.config)}};function Ae(n,e,t){Object.getOwnPropertyNames(e.prototype).forEach(r=>{let s=Object.getOwnPropertyDescriptor(e.prototype,r);s&&(s.value=function(...i){return this[t][r](...i)},Object.defineProperty(n.prototype,r,s))})}Ae(ne,pn,"account");Ae(ne,xn,"ans");Ae(ne,fn,"coin");Ae(ne,An,"digitalAsset");Ae(ne,Cn,"endlessAccount");Ae(ne,bn,"event");Ae(ne,Tn,"fungibleAsset");Ae(ne,wn,"general");Ae(ne,_n,"staking");Ae(ne,En,"transaction");Ae(ne,vn,"table");async function cu(n){let{endlessConfig:e,jwt:t,ephemeralKeyPair:r,pepper:s,uidKey:i="sub"}=n;if(p.fromHexInput(s).toUint8Array().length!==pe.PEPPER_LENGTH)throw new Error(`Pepper needs to be ${pe.PEPPER_LENGTH} bytes`);let o=await _asyncNullishCoalesce(e.maxExpHorizonSecs, async () => ((await Qs({endlessConfig:e})).maxExpHorizonSecs));if(o<r.expiryDateSecs-Wn())throw Error(`The EphemeralKeyPair is too long lived.  It's lifespan must be less than ${o}`);let a={jwt_b64:t,epk:r.getPublicKey().bcsToHex().toStringWithoutPrefix(),epk_blinder:p.fromHexInput(r.blinder).toStringWithoutPrefix(),exp_date_secs:r.expiryDateSecs,exp_horizon_secs:o,pepper:p.fromHexInput(s).toStringWithoutPrefix(),uid_key:i},{data:c}=await $s({endlessConfig:e,path:"prove",body:a,originMethod:"getProof",overrides:{WITH_CREDENTIALS:!1}}),d=c.proof,g=new Rt({a:d.a,b:d.b,c:d.c}),w=r.sign(g.hash());return new Ke({proof:g,nonMalleabilitySignature:w,trainingWheelsSignature:c.training_wheels_signature?ue.fromHex(c.training_wheels_signature):void 0,expHorizonSecs:o})}async function uu(n){let{jwt:e,uidKey:t,proofFetchCallback:r,pepper:s}=n,i=cu({...n}),o=r?i:await i,c=de.fromJwtAndPepper({jwt:e,pepper:s,uidKey:t}).authKey().derivedAddress();return pe.create({...n,address:c,proof:o,pepper:s,proofFetchCallback:r})}exports.Account = Je; exports.AccountAddress = u; exports.AccountAuthenticator = N; exports.AccountAuthenticatorBls12381 = Gr; exports.AccountAuthenticatorEd25519 = fe; exports.AccountAuthenticatorMock = We; exports.AccountAuthenticatorMultiAuthKey = Ge; exports.AccountAuthenticatorMultiEd25519 = Fn; exports.AccountAuthenticatorMultiKey = ht; exports.AccountAuthenticatorSingleKey = j; exports.AccountAuthenticatorVariant = hs; exports.AccountPublicKey = $; exports.AccountSequenceNumber = hr; exports.AddressInvalidReason = fa; exports.AnyPublicKey = I; exports.AnyPublicKeyVariant = Sr; exports.AnySignature = K; exports.AnySignatureVariant = bs; exports.AuthenticationKey = G; exports.Bls12381PrivateKey = js; exports.Bls12381PublicKey = sn; exports.Bls12381Signature = Dt; exports.Bool = U; exports.CKDPriv = Cs; exports.ChainId = kt; exports.DEFAULT_MAX_GAS_AMOUNT = Ns; exports.DEFAULT_TXN_EXP_SEC_FROM_NOW = Ms; exports.DEFAULT_TXN_TIMEOUT_SEC = Os; exports.DeriveScheme = ma; exports.Deserializer = re; exports.ENDLESS_BIP44_REGEX = wa; exports.ENDLESS_COIN = Pl; exports.ENDLESS_COIN_ID = Fs; exports.ENDLESS_HARDENED_REGEX = Ta; exports.EPK_HORIZON_SECS = Cp; exports.Ed25519Account = Ht; exports.Ed25519PrivateKey = W; exports.Ed25519PublicKey = E; exports.Ed25519Signature = _; exports.Endless = ne; exports.EndlessApiError = he; exports.EndlessApiType = tn; exports.EndlessConfig = ir; exports.EntryFunction = je; exports.EntryFunctionBytes = Rn; exports.EphemeralCertificate = Ut; exports.EphemeralCertificateVariant = _r; exports.EphemeralKeyPair = dn; exports.EphemeralPublicKey = lt; exports.EphemeralPublicKeyVariant = xr; exports.EphemeralSignature = ue; exports.EphemeralSignatureVariant = Ts; exports.FeePayerRawTransaction = Ye; exports.FixedBytes = at; exports.Groth16Zkp = Rt; exports.HARDENED_OFFSET = _s; exports.Hex = p; exports.HexInvalidReason = da; exports.Identifier = B; exports.KeyType = Sa; exports.KeylessAccount = pe; exports.KeylessConfiguration = Dr; exports.KeylessPublicKey = de; exports.KeylessSignature = ze; exports.MAX_AUD_VAL_BYTES = Xa; exports.MAX_COMMITED_EPK_BYTES = Rp; exports.MAX_EXTRA_FIELD_BYTES = Ip; exports.MAX_ISS_VAL_BYTES = Pp; exports.MAX_JWT_HEADER_B64_BYTES = Up; exports.MAX_UID_KEY_BYTES = Ya; exports.MAX_UID_VAL_BYTES = Za; exports.MimeType = zn; exports.ModuleId = on; exports.MoveAbility = Kn; exports.MoveFunctionVisibility = pa; exports.MoveOption = qe; exports.MoveString = x; exports.MoveVector = b; exports.MultiAgentRawTransaction = Xe; exports.MultiAgentTransaction = Vn; exports.MultiAuthKeyAccount = Ys; exports.MultiAuthKeyPublicKey = Qe; exports.MultiAuthKeySignature = ke; exports.MultiEd25519PublicKey = Ct; exports.MultiEd25519Signature = dt; exports.MultiKey = Kt; exports.MultiKeyAccount = jn; exports.MultiKeySignature = ft; exports.MultiSig = cn; exports.MultiSigTransactionPayload = un; exports.Network = Ur; exports.NetworkToChainId = Rr; exports.NetworkToFaucetAPI = El; exports.NetworkToIndexerAPI = Bs; exports.NetworkToIndexerAPIV2 = Ds; exports.NetworkToNetworkName = vl; exports.NetworkToNodeAPI = ks; exports.NetworkToProverAPI = Gs; exports.ParsingError = X; exports.ProcessorType = pt; exports.PublicKey = ct; exports.RAW_TRANSACTION_SALT = qs; exports.RAW_TRANSACTION_WITH_DATA_SALT = zr; exports.RawTransaction = le; exports.RawTransactionWithData = Hn; exports.RoleType = ga; exports.RotationProofChallenge = Ln; exports.Script = Ft; exports.ScriptTransactionArgumentVariants = Zt; exports.Secp256k1PrivateKey = yt; exports.Secp256k1PublicKey = Be; exports.Secp256k1Signature = De; exports.Serializable = l; exports.Serializer = F; exports.Signature = z; exports.SignedTransaction = Ee; exports.SigningScheme = se; exports.SigningSchemeInput = Er; exports.SimpleTransaction = $n; exports.SingleKeyAccount = Lt; exports.StructTag = Ne; exports.TransactionAuthenticator = Me; exports.TransactionAuthenticatorEd25519 = qt; exports.TransactionAuthenticatorFeePayer = wt; exports.TransactionAuthenticatorMultiAgent = Tt; exports.TransactionAuthenticatorMultiEd25519 = Nr; exports.TransactionAuthenticatorSingleSender = St; exports.TransactionAuthenticatorVariant = As; exports.TransactionPayload = bt; exports.TransactionPayloadEntryFunction = _e; exports.TransactionPayloadMultiSig = an; exports.TransactionPayloadScript = xe; exports.TransactionPayloadVariants = ys; exports.TransactionResponseType = ws; exports.TransactionVariants = fs; exports.TransactionWorker = br; exports.TransactionWorkerEventsEnum = na; exports.TypeTag = D; exports.TypeTagAddress = M; exports.TypeTagBool = Q; exports.TypeTagGeneric = k; exports.TypeTagParserError = O; exports.TypeTagParserErrorType = Sc; exports.TypeTagReference = qn; exports.TypeTagSigner = Ot; exports.TypeTagStruct = y; exports.TypeTagU128 = J; exports.TypeTagU16 = Gt; exports.TypeTagU256 = Mt; exports.TypeTagU32 = Nt; exports.TypeTagU64 = Se; exports.TypeTagU8 = we; exports.TypeTagVariants = ms; exports.TypeTagVector = C; exports.U128 = me; exports.U16 = ie; exports.U256 = ye; exports.U32 = oe; exports.U64 = H; exports.U8 = q; exports.ZeroKnowledgeSig = Ke; exports.buildTransaction = is; exports.checkOrConvertArgument = Qt; exports.convertArgument = ss; exports.deriveKey = Cr; exports.deriveKeylessAccount = uu; exports.deriveTransactionType = ic; exports.deserializeFromScriptArgument = rc; exports.endlessCoinStructTag = Sm; exports.endlessRequest = Nn; exports.ensureBoolean = wr; exports.fetchEntryFunctionAbi = Wi; exports.fetchFunctionAbi = Qi; exports.fetchViewFunctionAbi = ji; exports.findFirstNonSignerArg = Vi; exports.generateMockSignedTransactionForSimulation = Zi; exports.generateRawTransaction = Uc; exports.generateSignedTransaction = os; exports.generateSignedTransactionForSimulation = Yi; exports.generateSigningMessage = Qn; exports.generateSigningMessageForSerializable = ky; exports.generateSigningMessageForTransaction = Ze; exports.generateTransactionPayload = lr; exports.generateTransactionPayloadWithABI = Cc; exports.generateUserTransactionHash = Fh; exports.generateViewFunctionPayload = Xi; exports.generateViewFunctionPayloadWithABI = Pc; exports.get = Kr; exports.getAuthenticatorForSimulation = dr; exports.getEndlessFullNode = V; exports.getEndlessIndexer = nn; exports.getFunctionParts = mn; exports.getKeylessConfig = Qs; exports.getPaymentChecksum = fc; exports.hashValues = Ji; exports.isBcsAddress = cr; exports.isBcsBool = jr; exports.isBcsFixedBytes = xc; exports.isBcsString = Xr; exports.isBcsU128 = ts; exports.isBcsU16 = Zr; exports.isBcsU256 = ns; exports.isBcsU32 = Jr; exports.isBcsU64 = es; exports.isBcsU8 = Yr; exports.isBlockEpilogueTransactionResponse = Mu; exports.isBlockMetadataTransactionResponse = ku; exports.isBool = qi; exports.isEd25519Signature = Ou; exports.isEncodedEntryFunctionArgument = Li; exports.isFeePayerSignature = Hu; exports.isGenesisTransactionResponse = Du; exports.isLargeNumber = ar; exports.isMultiAgentSignature = qu; exports.isMultiEd25519Signature = Lu; exports.isNull = Hi; exports.isNumber = or; exports.isPendingTransactionResponse = Ku; exports.isScriptDataInput = $i; exports.isSecp256k1Signature = Fu; exports.isStateCheckpointTransactionResponse = Gu; exports.isString = Ce; exports.isUserTransactionResponse = Bu; exports.isValidBIP44Path = Es; exports.isValidHardenedPath = vs; exports.isValidatorTransactionResponse = Nu; exports.mnemonicToSeed = Bn; exports.normalizeBundle = Hs; exports.objectStructTag = ee; exports.optionStructTag = xm; exports.outOfRangeErrorMessage = la; exports.paginateWithCursor = Pt; exports.parseTypeTag = te; exports.post = rn; exports.postEndlessFaucet = Jl; exports.postEndlessFullNode = Le; exports.postEndlessIndexer = It; exports.postEndlessPepperService = Qa; exports.postEndlessProvingService = $s; exports.promiseFulfilledStatus = ta; exports.request = Va; exports.splitPath = Ps; exports.standardizeTypeTags = ur; exports.stringStructTag = v; exports.throwTypeMismatch = R; exports.validateNumberInRange = Fe;
//# sourceMappingURL=index.js.map