<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDS Genesis Arena | V9.5 Horizon Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        black: '#050505', 
                        surface: '#0f0f11', 
                        border: '#27272a',  
                        accent: '#3b82f6',
                        'neon-buy': '#22c55e',
                        'neon-sell': '#ef4444',
                        'rank-gold': '#fbbf24',
                        'rank-silver': '#e2e8f0',
                        'rank-bronze': '#b45309',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'fade-in-up': 'fadeInUp 0.5s ease-out forwards',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            background-color: #000000 !important;
            color: #ffffff;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            background:
                radial-gradient(circle at 50% 0%, #1a1a2e 0%, #000000 60%),
                url("data:image/svg+xml,%3Csvg width='300' height='300' viewBox='0 0 300 300' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext x='20' y='50' font-family='monospace' font-weight='bold' font-size='12' fill='%23222'%3E0x3f8a...%3C/text%3E%3Ctext x='150' y='100' font-family='monospace' font-size='10' fill='%231a1a1a'%3EEDS_PROTOCOL%3C/text%3E%3Ctext x='50' y='200' font-family='monospace' font-size='14' fill='%231a1a1a'%3EHASH_RATE%3C/text%3E%3Ctext x='220' y='250' font-family='monospace' font-size='10' fill='%23222'%3EGENESIS%3C/text%3E%3C/svg%3E");
            background-attachment: fixed;
        }

        .btn-genesis-active {
            background-color: #ffffff; color: #000000; font-weight: 700; border: 1px solid #ffffff;
        }
        .btn-genesis-outline {
            background-color: transparent; border: 1px solid #333; color: #888;
        }
        .btn-genesis-outline:hover {
            border-color: #666; color: #fff;
        }

        .input-genesis {
            background-color: #0f0f11; border: 1px solid #333; color: white; font-family: 'JetBrains Mono', monospace; transition: all 0.3s;
        }
        .input-genesis:focus {
            border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2); outline: none;
        }

        tr.rank-top-1 { background: linear-gradient(90deg, rgba(251, 191, 36, 0.1), transparent); border-left: 2px solid #fbbf24; }
        tr.rank-top-2 { background: linear-gradient(90deg, rgba(226, 232, 240, 0.05), transparent); border-left: 2px solid #e2e8f0; }
        tr.rank-top-3 { background: linear-gradient(90deg, rgba(180, 83, 9, 0.1), transparent); border-left: 2px solid #b45309; }

        .mascot-float { animation: float 6s ease-in-out infinite; }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .toast {
            visibility: hidden; min-width: 200px; background-color: #333; color: #fff; text-align: center; border-radius: 8px; padding: 10px; position: fixed; z-index: 100; left: 50%; bottom: 30px; transform: translateX(-50%); border: 1px solid #555; font-family: 'JetBrains Mono', monospace; font-size: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); opacity: 0; transition: opacity 0.3s;
        }
        .toast.show { visibility: visible; opacity: 1; }
    </style>
</head>
<body class="antialiased selection:bg-blue-500/30">

    <div id="toast" class="toast">
        <i class="fa-solid fa-check-circle text-neon-buy mr-2"></i> Address Copied!
    </div>

    <header class="border-b border-border bg-black/80 backdrop-blur-md sticky top-0 z-50">
        <div class="max-w-[1440px] mx-auto px-6 h-16 flex items-center justify-between">
            
            <div class="flex items-center gap-6">
                <div class="flex items-center gap-3 opacity-90 hover:opacity-100 transition cursor-pointer">
                    <img src="sliswap.png" alt="SliSwap" class="h-8 w-auto">
                </div>
                <div class="h-4 w-px bg-white/20"></div>
                <div class="flex items-center gap-3 opacity-90 hover:opacity-100 transition cursor-pointer">
                    <img src="endless.png" alt="Endless" class="h-8 w-auto rounded">
                </div>
            </div>

            <div id="connection-status" class="flex items-center gap-2 text-xs font-mono">
                <div class="relative flex h-2 w-2">
                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-neon-buy opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-2 w-2 bg-neon-buy" id="status-dot"></span>
                </div>
                <span class="uppercase tracking-widest text-neon-buy" id="status-text">SYSTEM V9.5 ONLINE</span>
            </div>
        </div>
    </header>

    <main class="max-w-[1280px] mx-auto px-6 mt-12 pb-20">
        
        <script>
        const fmt = (n) => new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(n);
        const fmtInt = (n) => new Intl.NumberFormat('en-US').format(n);

        let currentFilter = 'all';
        let rawData = [];

        async function fetchData() {
            try {
                const now = Date.now();
                
                // ✅ 修复：使用相对路径，自动匹配域名
                let url = '/api/leaderboard';

                if (currentFilter === '7d') url += `?start=${now - 604800000}`;
                if (currentFilter === '24h') url += `?start=${now - 86400000}`;
                if (currentFilter === '1h') url += `?start=${now - 3600000}`;

                const res = await fetch(url);
                if (!res.ok) throw new Error("API Offline");

                const json = await res.json();

                processData(json.top100, json.totalTraders);

                document.getElementById('status-text').innerText = "LIVE FEED CONNECTED";
                document.getElementById('status-dot').className = "relative inline-flex rounded-full h-2 w-2 bg-neon-buy";

            } catch (e) {
                document.getElementById('status-text').innerText = "DEMO / OFFLINE";
                document.getElementById('status-text').className = "uppercase tracking-widest text-yellow-500";
                document.getElementById('status-dot').className = "relative inline-flex rounded-full h-2 w-2 bg-yellow-500";

                processData(generateMockData(), 1245);
            } finally {
                document.getElementById('table-loading').classList.add('hidden');
            }
        }

        function processData(traders, totalCount) {
            rawData = traders || [];
            const totalVol = rawData.reduce((a, b) => a + (b.totalVolume || 0), 0);
            const totalBuy = rawData.reduce((a, b) => a + (b.buyVolume || 0), 0);
            const totalSell = rawData.reduce((a, b) => a + (b.sellVolume || 0), 0);

            document.getElementById('total-vol').innerText = fmt(totalVol);
            document.getElementById('total-buy').innerText = fmt(totalBuy);
            document.getElementById('total-sell').innerText = fmt(totalSell);
            document.getElementById('total-users').innerText = fmtInt(totalCount);

            renderTable();
        }

        function renderTable() {
            const tbody = document.getElementById('leaderboard-body');
            const emptyState = document.getElementById('empty-state');
            const searchVal = document.getElementById('search-input').value.toLowerCase();
            const filtered = rawData.filter(u => (u.address || '').toLowerCase().includes(searchVal));

            if (filtered.length === 0) {
                tbody.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            emptyState.classList.add('hidden');

            tbody.innerHTML = filtered.map((user, idx) => {
                const shortAddr = user.address.substring(0, 6) + '...' + user.address.slice(-4);

                return `
                <tr class="border-b border-border/50">
                    <td class="py-4 pl-6">#${idx + 1}</td>
                    <td class="py-4">${shortAddr}</td>
                    <td class="py-4 text-right text-neon-buy">+${fmt(user.buyVolume)}</td>
                    <td class="py-4 text-right text-neon-sell">-${fmt(user.sellVolume)}</td>
                    <td class="py-4 text-right pr-6 font-bold">${fmt(user.totalVolume)}</td>
                </tr>`;
            }).join('');
        }

        function generateMockData() {
            return Array.from({ length: 15 }, (_, i) => {
                const vol = Math.random() * 50000 * (15 - i);
                return {
                    address: '0x' + Math.random().toString(16).substr(2, 40),
                    buyVolume: vol * (0.3 + Math.random() * 0.4),
                    sellVolume: vol * (0.3 + Math.random() * 0.4),
                    totalVolume: vol
                };
            }).sort((a, b) => b.totalVolume - a.totalVolume);
        }

        fetchData();
        setInterval(fetchData, 3000);
        </script>

    </main>
</body>
</html>
